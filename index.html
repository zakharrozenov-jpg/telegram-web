<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<title>Case Hunters ‚Äî CS:GO Style</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet">
<style>
/* --- –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ --- */
:root{
  --bg:#0b0f14;
  --card:#111827;
  --accent:#facc15;
  --muted:#9ca3af;
  --green:#10b981;
}
*{box-sizing:border-box}
body{margin:0;font-family:Arial,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue";background:var(--bg);color:#fff;padding-top:180px}
#dailyBonusBox{position:fixed;top:0;left:0;right:0;display:flex;justify-content:center;align-items:center;background:rgba(20,20,24,0.96);padding:10px 0 8px 0;z-index:5;gap:15px;flex-direction:column;box-shadow:0 6px 28px rgba(0,0,0,.25);max-height:70px}
#topBar{position:fixed;top:70px;left:0;right:0;background:#020617;padding:14px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 4px 20px rgba(0,0,0,.6);z-index:20}
#logo{font-family:'Russo One',sans-serif;font-size:22px;color:var(--accent)}
#balanceBox{padding:8px 14px;border-radius:14px;background:linear-gradient(135deg,var(--accent),#eab308);color:#020617;font-weight:bold;box-shadow:0 0 15px rgba(250,204,21,.6)}
.small{font-size:12px;opacity:.85;color:#d1d5db}
.section{background:var(--card);border-radius:16px;padding:14px;margin:12px auto;width:min(96vw,760px)}
.case,.item{display:flex;justify-content:space-between;align-items:center;background:#1f2937;border-radius:12px;padding:10px;margin:8px 0;cursor:pointer}
.case:hover{background:#374151}
.case .left, .item .left{display:flex;gap:12px;align-items:center}
.case .meta, .item .meta{display:flex;flex-direction:column}
.case .meta .title, .item .meta .title{font-weight:bold}
.case .meta .sub, .item .meta .sub{font-size:12px;color:var(--muted)}
.smallBtn{background:#111827;border:1px solid #2b3440;color:#fff;padding:8px 12px;border-radius:10px;cursor:pointer}
.openBtn{background:var(--green);border:none;padding:12px 18px;border-radius:12px;color:#fff;font-weight:bold;font-size:16px;cursor:pointer}
.openBtn:disabled{opacity:.5;cursor:not-allowed}

/* --- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ä—É–∂–∏—è --- */
.weapon-img{width:64px;height:64px;border-radius:8px;object-fit:cover;box-shadow:0 0 8px #0008;background:#0b0f14;display:block}

/* --- –°—Ç–∏–ª—å –¥–ª—è "–∫–µ–π—Å–∞" (–∂—ë–ª—Ç—ã–π, —Å –Ω–∞–¥–ø–∏—Å—å—é) --- */
.case-badge{
  width:64px;height:64px;border-radius:8px;display:flex;align-items:center;justify-content:center;
  background:linear-gradient(135deg,#facc15,#eab308);color:#0b0f14;font-weight:900;font-family:'Russo One',sans-serif;
  box-shadow:0 6px 18px rgba(250,204,21,.18);font-size:14px;letter-spacing:1px;
  position:relative;
}
.case-badge .label{transform:translateY(1px);}

/* --- –†—É–ª–µ—Ç–∫–∞ (–ª–∏–Ω–µ–π–Ω–∞—è) --- */
.roulette{overflow:hidden;position:relative;border:2px solid var(--accent);border-radius:14px;height:100px;margin:13px 0;background:linear-gradient(180deg,#071018, #071018)}
.track{display:flex;transform:translateX(0);will-change:transform}
.roulette-item{width:90px;flex-shrink:0;text-align:center;font-size:11px;padding:6px}
.roulette-item img{width:60px;height:60px;display:block;margin:0 auto 4px;border-radius:8px;box-shadow:0 0 7px #000b}

/* --- –ú–æ–¥–∞–ª–∫–∏ --- */
#overlay{position:fixed;inset:0;background:rgba(0,0,0,.9);display:none;align-items:center;justify-content:center;z-index:90}
#modal{background:#020617;border-radius:18px;padding:16px 0 14px 0;width:min(95vw,720px)}
#winResultBox{margin-top:20px;padding:20px;background:#1a3a3a;border-radius:14px;border:2px solid var(--accent);text-align:center;display:none;animation:winPulse 0.6s ease-in-out}
@keyframes winPulse{0%{transform:scale(.8);opacity:0}50%{transform:scale(1.05)}100%{transform:scale(1);opacity:1}}
#winResultBox img{width:80px;height:80px;border-radius:10px;margin:0 auto 10px;box-shadow:0 0 20px var(--accent)}
#winResultBox .winTitle{font-size:20px;font-weight:bold;color:var(--accent);margin-bottom:5px}
#winResultBox .winPrice{font-size:16px;color:#4ecdc4}

/* --- –ö—Ä—É–≥–ª–∞—è —Ä—É–ª–µ—Ç–∫–∞ –¥–ª—è –∞–ø–≥—Ä–µ–π–¥–∞ --- */
.upgrade-wheel{
  width:320px;height:320px;border-radius:50%;position:relative;margin:12px auto;background:conic-gradient(#0b1220 0 25%, #071018 25% 50%, #0b1220 50% 75%, #071018 75% 100%);box-shadow:0 8px 40px rgba(0,0,0,.6);
  display:flex;align-items:center;justify-content:center;overflow:hidden;
}
.upgrade-wheel .pointer{position:absolute;top:8px;left:50%;transform:translateX(-50%);width:0;height:0;border-left:12px solid transparent;border-right:12px solid transparent;border-bottom:18px solid var(--accent);z-index:20}
.upgrade-wheel .inner{width:70%;height:70%;border-radius:50%;background:rgba(2,6,11,.8);display:flex;align-items:center;justify-content:center;flex-direction:column;color:#cbd5e1}
.spin-btn{background:var(--accent);border:none;padding:10px 14px;border-radius:10px;color:#020617;font-weight:bold;cursor:pointer}
.upgrade-result{margin-top:10px;font-weight:bold}

/* --- –ü—Ä–æ—á–µ–µ --- */
.footerNote{font-size:12px;color:var(--muted);text-align:center;margin:18px 0}
.row{display:flex;gap:8px;align-items:center}
.label{font-size:13px;color:#cbd5e1;margin-bottom:6px}
.rtpInfo{font-size:12px;color:var(--muted);margin-top:6px}
</style>
</head>
<body>
<div id="dailyBonusBox">
  <button type="button" id="bonusBtn">üéÅ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å 100 000 ‚ÇΩ</button>
  <div id="bonusMsg"></div>
</div>

<div id="topBar">
  <div id="logo">CASE HUNTERS</div>
  <div style="display:flex;align-items:center;">
    <div id="balanceBox"><span style="font-size:23px;">üíµ</span> <span id="balance">1250</span> ‚ÇΩ</div>
    <button id="bankBtn" class="smallBtn" style="margin-left:12px">üíº</button>
  </div>
</div>

<div style="padding:20px 12px 120px;">
  <div class="section" id="casesSection">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <div style="font-weight:bold">–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–µ–π—Å—ã</div>
      <div class="small">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–µ–π—Å, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å</div>
    </div>
    <div id="casesList"></div>
  </div>

  <div class="section" id="openSection">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <div style="font-weight:bold">–û—Ç–∫—Ä—ã—Ç—å –∫–µ–π—Å</div>
      <div class="small">–ë–∞–ª–∞–Ω—Å: <span id="balanceSmall">1250</span> ‚ÇΩ</div>
    </div>

    <div id="selectedCaseBox" style="margin-top:12px;display:flex;gap:12px;align-items:center;">
      <div id="selectedCaseInfo" style="flex:1"><div class="small">–í—ã–±–µ—Ä–∏—Ç–µ –∫–µ–π—Å —Å–ª–µ–≤–∞</div></div>
      <div style="display:flex;flex-direction:column;align-items:flex-end;">
        <div style="margin-bottom:8px"><button id="openOnce" class="openBtn" disabled>–û—Ç–∫—Ä—ã—Ç—å 1</button></div>
        <div><button id="openTen" class="openBtn" disabled>–û—Ç–∫—Ä—ã—Ç—å 10</button></div>
      </div>
    </div>

    <div class="roulette" id="roulette" style="margin-top:16px;">
      <div class="track" id="track"></div>
      <div class="roulette-marker"></div>
    </div>

    <div id="openLog" style="margin-top:12px;font-size:13px;opacity:.9"></div>
  </div>

  <div class="section" id="inventorySection">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <div style="font-weight:bold">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</div>
      <div class="small">–í–∞—à–∏ –ø—Ä–µ–¥–º–µ—Ç—ã</div>
    </div>
    <div id="inventoryList" style="margin-top:12px"></div>
  </div>

  <div class="footerNote">–î–µ–º–æ-—Å—Ç—Ä–∞–Ω–∏—Ü–∞: –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ä—É–∂–∏—è –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞—é—Ç—Å—è –∏–∑ –∏–≥—Ä—ã (–Ω—É–∂–Ω—ã —Ä–µ–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ –ø–∞–ø–∫–µ <code>/assets/cs/</code> –∏–ª–∏ –≤–Ω–µ—à–Ω–∏–µ —Å—Å—ã–ª–∫–∏).</div>
</div>

<!-- –ë–∞–Ω–∫ / –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ / –≤—ã–≤–æ–¥ / RTP -->
<div id="bankOverlay" style="display:none;position:fixed;inset:0;z-index:40;justify-content:flex-end;align-items:flex-start;">
  <div id="bankModal" style="margin:110px 30px 0 0;background:#181d27;border-radius:13px;box-shadow:0 4px 32px #000b;padding:22px 32px;display:flex;flex-direction:column;align-items:center;">
    <div style="font-weight:bold;font-size:18px;margin-bottom:8px">–ë–∞–Ω–∫</div>
    <div style="margin-bottom:10px;color:#9ca3af">–ü–æ–ø–æ–ª–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å –∏–ª–∏ –≤—ã–≤–µ–¥–∏—Ç–µ —Å—Ä–µ–¥—Å—Ç–≤–∞. –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å RTP (–æ–∂–∏–¥–∞–µ–º—ã–π –≤–æ–∑–≤—Ä–∞—Ç) –¥–ª—è –∫–µ–π—Å–æ–≤.</div>
    <div style="display:flex;gap:8px;margin-bottom:12px;align-items:center">
      <input id="amountInput" type="number" min="1" step="50" value="500" />
      <button id="depositBtn" class="smallBtn">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
      <button id="withdrawBtn" class="smallBtn">–í—ã–≤–µ—Å—Ç–∏</button>
    </div>

    <div style="width:100%;margin-top:8px;border-top:1px solid #222;padding-top:10px">
      <div class="label">–ì–ª–æ–±–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ RTP (—Ü–µ–ª–µ–≤–æ–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –≤–æ–∑–≤—Ä–∞—Ç–∞):</div>
      <div class="row" style="margin-bottom:8px">
        <input id="rtpInput" type="number" min="0.1" max="5" step="0.01" value="1.00" style="width:100px">
        <button id="applyRtpBtn" class="smallBtn">–ü—Ä–∏–º–µ–Ω–∏—Ç—å RTP</button>
        <div style="margin-left:8px;color:#9ca3af;font-size:13px">–¢–µ–∫—É—â–∏–π RTP: <span id="currentRtp">1.00</span></div>
      </div>
      <div class="rtpInfo">RTP –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —à–∞–Ω—Å–æ–≤ –≤–Ω—É—Ç—Ä–∏ –∫–µ–π—Å–æ–≤ ‚Äî —á–µ–º –≤—ã—à–µ RTP, —Ç–µ–º –≤—ã—à–µ —Å—Ä–µ–¥–Ω–∏–π –≤—ã–∏–≥—Ä—ã—à –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ü–µ–Ω—ã –∫–µ–π—Å–∞.</div>
    </div>

    <button id="closeBank" style="background:#111827;color:#fff;border-radius:10px;padding:8px 16px;border:none;cursor:pointer;margin-top:12px">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>

<!-- –û–≤–µ—Ä–ª–µ–π –º–æ–¥–∞–ª–∫–∏ -->
<div id="overlay">
  <div id="modal">
    <div style="padding:12px 18px;">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div style="font-weight:bold">–†–µ–∑—É–ª—å—Ç–∞—Ç</div>
        <button id="closeModal" class="smallBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>

      <div id="winResultBox">
        <img id="winImg" src="" alt="win">
        <div class="winTitle" id="winTitle">–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏</div>
        <div class="winPrice" id="winPrice">0 ‚ÇΩ</div>
      </div>

      <div id="modalContent" style="margin-top:12px;padding:8px 6px;text-align:center;color:#cbd5e1"></div>
    </div>
  </div>
</div>

<!-- –°–∫—Ä–∏–ø—Ç—ã -->
<script>
/*
  –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥:
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –æ—Ä—É–∂–∏—è (CS:GO-—Å—Ç–∏–ª—å).
  - –î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è "—Ä–µ–∞–ª—å–Ω—ã—Ö" –∫–∞—Ä—Ç–∏–Ω–æ–∫ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–æ–≤ –≤ /assets/cs/
    –∏–ª–∏ –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–Ω–µ—à–Ω–∏–µ CDN —Å –ø—Ä–∞–≤–∞–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.
  - –ö–µ–π—Å—ã —Ç–µ–ø–µ—Ä—å –≤–∏–∑—É–∞–ª—å–Ω–æ ‚Äî –∂—ë–ª—Ç—ã–µ –±–µ–π–¥–∂–∏ —Å –Ω–∞–¥–ø–∏—Å—å—é "–ö–ï–ô–°".
  - –î–æ–±–∞–≤–ª–µ–Ω—ã 2 –Ω–æ–≤—ã—Ö –∫–µ–π—Å–∞: 50 ‚ÇΩ –∏ 200 ‚ÇΩ.
  - –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ö–∞–Ω–∏–∑–º –∞–ø–≥—Ä–µ–π–¥–∞: –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∞ "–ê–ø–≥—Ä–µ–π–¥".
    –ê–ø–≥—Ä–µ–π–¥ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∫—Ä—É–≥–æ–≤—É—é —Ä—É–ª–µ—Ç–∫—É; –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–ª–∞—Ç–∏—Ç –Ω–µ–±–æ–ª—å—à—É—é –∫–æ–º–∏—Å—Å–∏—é –∏ –º–æ–∂–µ—Ç –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è
    —É–º–Ω–æ–∂–∏—Ç—å —Ü–µ–Ω—É –ø—Ä–µ–¥–º–µ—Ç–∞ –Ω–∞ 2x –∏–ª–∏ 3x. –£—Å–ø–µ—Ö –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—è–º–∏.
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–±—ç–∫–µ–Ω–¥ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç ‚Äî –≤—Å—ë –≤ –ø–∞–º—è—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
*/

/* --- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π ---
   –ó–¥–µ—Å—å —É–∫–∞–∑–∞–Ω—ã –ø—É—Ç–∏ –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º –æ—Ä—É–∂–∏—è. –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ URL/–ø—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º –∏–≥—Ä—ã.
   –ü—Ä–∏–º–µ—Ä: '/assets/cs/awp_asiimov.png' –∏–ª–∏ 'https://your.cdn/awp_asiimov.png'
*/
const IMAGE_BASE = '/assets/cs/'; // –ø—Ä–∏ –¥–µ–ø–ª–æ–µ –ø–æ–ª–æ–∂–∏—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ —ç—Ç—É –ø–∞–ø–∫—É –∏–ª–∏ –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ CDN

function imgPath(name){
  // –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø—É—Ç—å: –µ—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –ø—Ä–æ–∫—Å–∏-—Å–∫—Ä–∏–ø—Ç/–±—Ä–∞—É–∑–µ—Ä –ø–æ–∫–∞–∂–µ—Ç –∑–∞–≥–ª—É—à–∫—É
  return IMAGE_BASE + name;
}

/* --- –ö–µ–π—Å—ã –∏ –ø—Ä–µ–¥–º–µ—Ç—ã (–Ω–∞–∑–≤–∞–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –∫–∞—Ä—Ç–∏–Ω–∫–∞–º) --- */
const BASE_CASES = [
  // –Ω–æ–≤—ã–π –¥–µ—à—ë–≤—ã–π –∫–µ–π—Å 50 ‚ÇΩ
  { id:'case0', name:'Starter Case', price:50, imgBadge:true, baseItems:[
    { id:'s1', name:'P250 | Sand Dune', price:40, img: imgPath('p250_sanddune.png'), baseChance:60 },
    { id:'s2', name:'USP-S | Torque', price:120, img: imgPath('usp_torque.png'), baseChance:30 },
    { id:'s3', name:'Nova | Ranger', price:400, img: imgPath('nova_ranger.png'), baseChance:10 }
  ]},

  // —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–µ–π—Å—ã (–æ–±–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞–∑–≤–∞–Ω–∏—è/–∫–∞—Ä—Ç–∏–Ω–∫–∏)
  { id:'case1', name:'Dust II Case', price:100, imgBadge:true, baseItems:[
    { id:'g1', name:'AK-47 | Redline', price:120, img: imgPath('ak_redline.png'), baseChance:40 },
    { id:'g2', name:'M4A1-S | Guardian', price:300, img: imgPath('m4_guardian.png'), baseChance:30 },
    { id:'g3', name:'AWP | Asiimov', price:2500, img: imgPath('awp_asiimov.png'), baseChance:5 },
    { id:'g4', name:'Desert Eagle | Blaze', price:800, img: imgPath('deagle_blaze.png'), baseChance:25 }
  ]},

  // –Ω–æ–≤—ã–π –∫–µ–π—Å 200 ‚ÇΩ
  { id:'case1b', name:'Classic Case', price:200, imgBadge:true, baseItems:[
    { id:'c1', name:'AK-47 | Vulcan', price:1200, img: imgPath('ak_vulcan.png'), baseChance:45 },
    { id:'c2', name:'M4A4 | Howl', price:8000, img: imgPath('m4_howl.png'), baseChance:10 },
    { id:'c3', name:'AWP | Asiimov (StatTrak)', price:3000, img: imgPath('awp_asiimov_st.png'), baseChance:5 },
    { id:'c4', name:'Glock-18 | Fade', price:1500, img: imgPath('glock_fade.png'), baseChance:40 }
  ]},

  { id:'case2', name:'Inferno Case', price:500, imgBadge:true, baseItems:[
    { id:'p1', name:'AK-47 | Vulcan', price:1200, img: imgPath('ak_vulcan.png'), baseChance:35 },
    { id:'p2', name:'M4A4 | Howl', price:8000, img: imgPath('m4_howl.png'), baseChance:10 },
    { id:'p3', name:'AWP | Dragon Lore', price:50000, img: imgPath('awp_dragonlore.png'), baseChance:1 },
    { id:'p4', name:'Glock-18 | Fade', price:1500, img: imgPath('glock_fade.png'), baseChance:54 }
  ]},

  { id:'case3', name:'Mirage Case', price:2000, imgBadge:true, baseItems:[
    { id:'l1', name:'AK-47 | Fire Serpent', price:20000, img: imgPath('ak_serpent.png'), baseChance:30 },
    { id:'l2', name:'M4A1-S | Hot Rod', price:12000, img: imgPath('m4_hotrod.png'), baseChance:50 },
    { id:'l3', name:'AWP | Medusa', price:90000, img: imgPath('awp_medusa.png'), baseChance:20 }
  ]}
];

/* --- –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–∞–±–æ—á–∏—Ö –∫–µ–π—Å–æ–≤ (–∫–æ–ø–∏–∏) --- */
const WORK_CASES = BASE_CASES.map(c => {
  const items = c.baseItems.map(it => ({ ...it, chance: it.baseChance }));
  return { ...c, items, baseTotalChance: items.reduce((s,i)=>s+i.baseChance,0) };
});

/* --- –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è --- */
let state = {
  balance: 1250,
  selectedCase: null,
  inventory: [], // { id, name, price, img, upgraded: {multiplier, times}, uid }
  bonusTaken: false,
  currentRtp: 1.00
};

/* --- DOM —ç–ª–µ–º–µ–Ω—Ç—ã --- */
const balanceEl = document.getElementById('balance');
const balanceSmallEl = document.getElementById('balanceSmall');
const casesListEl = document.getElementById('casesList');
const selectedCaseInfoEl = document.getElementById('selectedCaseInfo');
const openOnceBtn = document.getElementById('openOnce');
const openTenBtn = document.getElementById('openTen');
const rouletteTrack = document.getElementById('track');
const rouletteEl = document.getElementById('roulette');
const openLogEl = document.getElementById('openLog');
const inventoryListEl = document.getElementById('inventoryList');
const bankBtn = document.getElementById('bankBtn');
const bankOverlay = document.getElementById('bankOverlay');
const closeBank = document.getElementById('closeBank');
const depositBtn = document.getElementById('depositBtn');
const withdrawBtn = document.getElementById('withdrawBtn');
const amountInput = document.getElementById('amountInput');
const overlay = document.getElementById('overlay');
const winResultBox = document.getElementById('winResultBox');
const winImg = document.getElementById('winImg');
const winTitle = document.getElementById('winTitle');
const winPrice = document.getElementById('winPrice');
const closeModal = document.getElementById('closeModal');
const bonusBtn = document.getElementById('bonusBtn');
const bonusMsg = document.getElementById('bonusMsg');
const rtpInput = document.getElementById('rtpInput');
const applyRtpBtn = document.getElementById('applyRtpBtn');
const currentRtpEl = document.getElementById('currentRtp');

/* --- –£—Ç–∏–ª–∏—Ç—ã --- */
function uid(prefix='id'){ return prefix + '_' + Math.random().toString(36).slice(2,9); }
function updateBalanceUI(){ balanceEl.textContent = state.balance; balanceSmallEl.textContent = state.balance; }

/* --- –†–µ–Ω–¥–µ—Ä –∫–µ–π—Å–æ–≤ --- */
function renderCases(){
  casesListEl.innerHTML = '';
  WORK_CASES.forEach(c => {
    const ev = computeCaseEV(c);
    const rtp = (ev / c.price).toFixed(3);
    const el = document.createElement('div');
    el.className = 'case';
    el.dataset.id = c.id;

    // –ª–µ–≤—ã–π –±–ª–æ–∫: –±–µ–π–¥–∂ –∫–µ–π—Å–∞ (–∂—ë–ª—Ç—ã–π) –∏–ª–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∞
    const left = document.createElement('div'); left.className = 'left';
    const badge = document.createElement('div');
    badge.className = 'case-badge';
    badge.innerHTML = `<div class="label">–ö–ï–ô–°</div>`;
    left.appendChild(badge);

    const meta = document.createElement('div'); meta.className = 'meta';
    meta.innerHTML = `<div class="title">${c.name}</div><div class="sub">–¶–µ–Ω–∞: ${c.price} ‚ÇΩ ‚Ä¢ EV: ${Math.round(ev)} ‚ÇΩ ‚Ä¢ RTP: ${rtp}</div>`;
    left.appendChild(meta);

    const right = document.createElement('div');
    right.style.display = 'flex'; right.style.flexDirection = 'column'; right.style.alignItems = 'flex-end';
    right.innerHTML = `<div class="small">–ü—Ä–µ–¥–º–µ—Ç–æ–≤: ${c.items.length}</div><div style="margin-top:6px"><button class="smallBtn" data-open="${c.id}">–û—Ç–∫—Ä—ã—Ç—å</button></div>`;

    el.appendChild(left); el.appendChild(right);

    el.addEventListener('click', (e)=>{
      if(e.target && e.target.dataset && e.target.dataset.open) return;
      selectCase(c.id);
    });
    const openBtn = el.querySelector('button[data-open]');
    openBtn.addEventListener('click',(ev)=>{
      ev.stopPropagation();
      selectCase(c.id);
      openCase(1);
    });

    casesListEl.appendChild(el);
  });
}

/* --- –í—ã–±–æ—Ä –∫–µ–π—Å–∞ --- */
function selectCase(caseId){
  const c = WORK_CASES.find(x=>x.id===caseId);
  state.selectedCase = c;
  document.querySelectorAll('.case').forEach(el=> el.classList.toggle('selected', el.dataset.id === caseId));
  const ev = computeCaseEV(c);
  const rtp = (ev / c.price).toFixed(3);
  selectedCaseInfoEl.innerHTML = `
    <div style="display:flex;gap:12px;align-items:center">
      <div class="case-badge" style="width:64px;height:64px"><div class="label">–ö–ï–ô–°</div></div>
      <div>
        <div style="font-weight:bold">${c.name}</div>
        <div class="small">–¶–µ–Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è: ${c.price} ‚ÇΩ</div>
        <div class="small">–ü—Ä–µ–¥–º–µ—Ç–æ–≤: ${c.items.length}</div>
        <div class="small">EV: ${Math.round(ev)} ‚ÇΩ ‚Ä¢ RTP: ${rtp}</div>
      </div>
    </div>
  `;
  openOnceBtn.disabled = false;
  openTenBtn.disabled = false;
  prepareRoulette(c);
}

/* --- –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ª–∏–Ω–µ–π–Ω–æ–π —Ä—É–ª–µ—Ç–∫–∏ --- */
function prepareRoulette(c){
  rouletteTrack.innerHTML = '';
  const items = [];
  for(let i=0;i<30;i++) c.items.forEach(it => items.push(it));
  items.forEach(it=>{
    const el = document.createElement('div'); el.className = 'roulette-item';
    const img = document.createElement('img'); img.className='weapon-img';
    img.src = it.img; img.alt = it.name;
    el.appendChild(img);
    const name = document.createElement('div'); name.style.fontSize='11px'; name.style.marginTop='4px'; name.textContent = it.name;
    const price = document.createElement('div'); price.className='small'; price.textContent = it.price + ' ‚ÇΩ';
    el.appendChild(name); el.appendChild(price);
    rouletteTrack.appendChild(el);
  });
  rouletteTrack.style.transform = 'translateX(0)';
}

/* --- –û—Ç–∫—Ä—ã—Ç–∏–µ –∫–µ–π—Å–∞ --- */
function openCase(count=1){
  if(!state.selectedCase) return;
  const totalCost = state.selectedCase.price * count;
  if(state.balance < totalCost){ showModal(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤. –ù—É–∂–Ω–æ ${totalCost} ‚ÇΩ`, false); return; }
  state.balance -= totalCost; updateBalanceUI();

  const results = [];
  let seq = Promise.resolve();
  for(let i=0;i<count;i++){
    seq = seq.then(()=> new Promise(res=>{
      const win = pickRandomItem(state.selectedCase.items);
      results.push(win);
      animateRouletteTo(win).then(()=> {
        // –¥–æ–±–∞–≤–ª—è–µ–º –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å: —Å–æ–∑–¥–∞—ë–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç
        const inv = { uid: uid('it'), id: win.id, name: win.name, price: win.price, img: win.img, upgraded: null };
        state.inventory.push(inv);
        showWin(inv);
        res();
      });
    }));
  }
  seq.then(()=>{ renderInventory(); logOpen(results); });
}

/* --- –í—ã–±–æ—Ä –ø—Ä–µ–¥–º–µ—Ç–∞ –ø–æ —à–∞–Ω—Å–∞–º --- */
function pickRandomItem(items){
  const total = items.reduce((s,it)=>s + (it.chance || 1),0);
  let r = Math.random()*total;
  for(const it of items){
    r -= (it.chance || 1);
    if(r <= 0) return JSON.parse(JSON.stringify(it));
  }
  return JSON.parse(JSON.stringify(items[items.length-1]));
}

/* --- –ê–Ω–∏–º–∞—Ü–∏—è –ª–∏–Ω–µ–π–Ω–æ–π —Ä—É–ª–µ—Ç–∫–∏ --- */
function animateRouletteTo(item){
  return new Promise(res=>{
    const nodes = Array.from(rouletteTrack.children);
    let targetIndex = nodes.findIndex(n => n.textContent.includes(item.name));
    if(targetIndex === -1) targetIndex = Math.floor(nodes.length/2);
    const itemWidth = nodes[0].offsetWidth || 90;
    const visibleWidth = rouletteEl.offsetWidth || 300;
    const centerOffset = Math.floor(visibleWidth/2);
    const targetCenter = targetIndex * itemWidth + itemWidth/2;
    const translateX = centerOffset - targetCenter;
    const duration = 1600 + Math.random()*800;
    rouletteTrack.style.transition = `transform ${duration}ms cubic-bezier(.2,.9,.2,1)`;
    requestAnimationFrame(()=> rouletteTrack.style.transform = `translateX(${translateX}px)`);
    setTimeout(()=>{ rouletteTrack.style.transition = ''; res(); }, duration + 50);
  });
}

/* --- –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ --- */
function showWin(inv){
  winImg.src = inv.img;
  winTitle.textContent = inv.name;
  winPrice.textContent = `${inv.price} ‚ÇΩ`;
  winResultBox.style.display = 'block';
  overlay.style.display = 'flex';
  setTimeout(()=> { winResultBox.style.display = 'none'; }, 2500);
}

/* --- –õ–æ–≥ –æ—Ç–∫—Ä—ã—Ç–∏—è --- */
function logOpen(results){
  const lines = results.map(r=>`–í—ã –ø–æ–ª—É—á–∏–ª–∏: <b>${r.name}</b> ‚Äî ${r.price} ‚ÇΩ`).join('<br>');
  openLogEl.innerHTML = lines;
}

/* --- –†–µ–Ω–¥–µ—Ä –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è (—Å –∞–ø–≥—Ä–µ–π–¥–æ–º) --- */
function renderInventory(){
  inventoryListEl.innerHTML = '';
  if(state.inventory.length === 0){ inventoryListEl.innerHTML = '<div class="small">–ü—É—Å—Ç–æ</div>'; return; }
  state.inventory.slice().reverse().forEach(it=>{
    const el = document.createElement('div'); el.className = 'item';
    const left = document.createElement('div'); left.className='left';
    const img = document.createElement('img'); img.className='weapon-img'; img.src = it.img; img.alt = it.name;
    const meta = document.createElement('div'); meta.className='meta';
    const title = document.createElement('div'); title.className='title'; title.textContent = it.name + (it.upgraded ? ` ‚Ä¢ ${it.upgraded.multiplier}x` : '');
    const sub = document.createElement('div'); sub.className='sub'; sub.textContent = `${it.price} ‚ÇΩ`;
    meta.appendChild(title); meta.appendChild(sub);
    left.appendChild(img); left.appendChild(meta);

    const right = document.createElement('div'); right.style.display='flex'; right.style.flexDirection='column'; right.style.alignItems='flex-end';
    const sellBtn = document.createElement('button'); sellBtn.className='smallBtn'; sellBtn.textContent='–ü—Ä–æ–¥–∞—Ç—å';
    sellBtn.addEventListener('click', ()=>{
      state.balance += it.price;
      const idx = state.inventory.findIndex(x=>x.uid === it.uid);
      if(idx !== -1) state.inventory.splice(idx,1);
      updateBalanceUI(); renderInventory();
    });

    const upgBtn = document.createElement('button'); upgBtn.className='smallBtn'; upgBtn.style.marginTop='8px'; upgBtn.textContent='–ê–ø–≥—Ä–µ–π–¥';
    upgBtn.addEventListener('click', ()=> openUpgradeModal(it));

    right.appendChild(sellBtn); right.appendChild(upgBtn);

    el.appendChild(left); el.appendChild(right);
    inventoryListEl.appendChild(el);
  });
}

/* --- –ú–æ–¥–∞–ª –∞–ø–≥—Ä–µ–π–¥–∞ --- */
function openUpgradeModal(item){
  // –°–æ–∑–¥–∞—ë–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–æ–¥–∞–ª–∫–∏ —Å –∫—Ä—É–≥–ª–æ–π —Ä—É–ª–µ—Ç–∫–æ–π
  const modalContent = document.getElementById('modalContent');
  modalContent.innerHTML = '';
  const title = document.createElement('div'); title.style.fontWeight='700'; title.style.marginBottom='8px'; title.textContent = `–ê–ø–≥—Ä–µ–π–¥: ${item.name}`;
  modalContent.appendChild(title);

  const wheelWrap = document.createElement('div'); wheelWrap.style.textAlign='center';
  const wheel = document.createElement('div'); wheel.className='upgrade-wheel'; wheel.id='upgradeWheel';
  const pointer = document.createElement('div'); pointer.className='pointer';
  const inner = document.createElement('div'); inner.className='inner';
  inner.innerHTML = `<div style="font-weight:bold">${item.name}</div><div class="small">–¶–µ–Ω–∞: ${item.price} ‚ÇΩ</div>`;
  wheel.appendChild(pointer); wheel.appendChild(inner);
  wheelWrap.appendChild(wheel);

  // –û–ø—Ü–∏–∏: 2x –∏ 3x
  const controls = document.createElement('div'); controls.style.marginTop='12px'; controls.style.display='flex'; controls.style.justifyContent='center'; controls.style.gap='12px';
  const spin2 = document.createElement('button'); spin2.className='spin-btn'; spin2.textContent='–ü–æ–ø—ã—Ç–∫–∞ 2x';
  const spin3 = document.createElement('button'); spin3.className='spin-btn'; spin3.textContent='–ü–æ–ø—ã—Ç–∫–∞ 3x';
  controls.appendChild(spin2); controls.appendChild(spin3);

  const info = document.createElement('div'); info.className='upgrade-result'; info.style.marginTop='10px';
  modalContent.appendChild(wheelWrap); modalContent.appendChild(controls); modalContent.appendChild(info);

  // –°—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–ø—ã—Ç–∫–∏: –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç —Ü–µ–Ω—ã –ø—Ä–µ–¥–º–µ—Ç–∞
  const cost2 = Math.max(1, Math.round(item.price * 0.18)); // 18%
  const cost3 = Math.max(1, Math.round(item.price * 0.35)); // 35%

  // –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —É—Å–ø–µ—Ö–∞ (–º–æ–∂–Ω–æ —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞—Ç—å)
  const prob2 = 0.65; // 65% —à–∞–Ω—Å –ø–æ–ª—É—á–∏—Ç—å 2x
  const prob3 = 0.35; // 35% —à–∞–Ω—Å –ø–æ–ª—É—á–∏—Ç—å 3x

  let spinning = false;

  function spinWheel(multiplier){
    if(spinning) return;
    const cost = multiplier === 2 ? cost2 : cost3;
    if(state.balance < cost){ showModal('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –ø–æ–ø—ã—Ç–∫–∏', false); return; }
    state.balance -= cost; updateBalanceUI();
    spinning = true;
    info.textContent = '–ö—Ä—É—Ç–∏–º...';
    // –ê–Ω–∏–º–∞—Ü–∏—è: –≤—Ä–∞—â–∞–µ–º wheel –Ω–∞ —Å–ª—É—á–∞–π–Ω—ã–π —É–≥–æ–ª, –Ω–æ —Å —Ñ–∏–Ω–∞–ª–æ–º, –∑–∞–≤–∏—Å—è—â–∏–º –æ—Ç —É—Å–ø–µ—Ö–∞
    const success = Math.random() < (multiplier === 2 ? prob2 : prob3);
    // –í—ã—á–∏—Å–ª–∏–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —É–≥–æ–ª: –µ—Å–ª–∏ —É—Å–ø–µ—Ö ‚Äî –ø–æ–ø–∞–¥—ë–º –≤ —Å–µ–∫—Ç–æ—Ä "—É—Å–ø–µ—Ö", –∏–Ω–∞—á–µ ‚Äî –≤ —Å–µ–∫—Ç–æ—Ä "–ø—Ä–æ–≤–∞–ª"
    // –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã: —É—Å–ø–µ—Ö ‚Äî —É–≥–æ–ª –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ [0, 60), –ø—Ä–æ–≤–∞–ª ‚Äî [120, 300)
    const baseSpins = 4 + Math.floor(Math.random()*3); // –ø–æ–ª–Ω—ã—Ö –æ–±–æ—Ä–æ—Ç–æ–≤
    let finalAngle;
    if(success){
      finalAngle = 360 * baseSpins + (Math.random()*50 + 5); // –Ω–µ–±–æ–ª—å—à–æ–π —Å–µ–∫—Ç–æ—Ä —É—Å–ø–µ—Ö–∞
    } else {
      finalAngle = 360 * baseSpins + (Math.random()*180 + 120);
    }
    wheel.style.transition = 'transform 2200ms cubic-bezier(.2,.9,.2,1)';
    wheel.style.transform = `rotate(${finalAngle}deg)`;
    setTimeout(()=>{
      wheel.style.transition = '';
      wheel.style.transform = `rotate(${finalAngle % 360}deg)`; // –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º
      spinning = false;
      if(success){
        // –£—Å–ø–µ—Ö: —É–º–Ω–æ–∂–∞–µ–º —Ü–µ–Ω—É –ø—Ä–µ–¥–º–µ—Ç–∞ –∏ –ø–æ–º–µ—á–∞–µ–º –∞–ø–≥—Ä–µ–π–¥
        item.price = Math.round(item.price * multiplier);
        item.upgraded = item.upgraded || { times:0, multiplier:1 };
        item.upgraded.times += 1;
        item.upgraded.multiplier *= multiplier;
        info.textContent = `–£—Å–ø–µ—Ö! –ü—Ä–µ–¥–º–µ—Ç —É–º–Ω–æ–∂–µ–Ω –Ω–∞ ${multiplier}x. –ù–æ–≤–∞—è —Ü–µ–Ω–∞: ${item.price} ‚ÇΩ`;
      } else {
        // –ü—Ä–æ–≤–∞–ª: –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏–ª–∏ —É–º–µ–Ω—å—à–∏—Ç—å —Ü–µ–Ω—É ‚Äî –æ—Å—Ç–∞–≤–∏–º –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
        info.textContent = `–ù–µ—É–¥–∞—á–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞ –∏–ª–∏ –ø—Ä–æ–¥–∞–π—Ç–µ –ø—Ä–µ–¥–º–µ—Ç.`;
      }
      renderInventory();
    }, 2300);
  }

  spin2.addEventListener('click', ()=> spinWheel(2));
  spin3.addEventListener('click', ()=> spinWheel(3));

  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É
  winResultBox.style.display = 'none';
  overlay.style.display = 'flex';
}

/* --- RTP: –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ (–∫–∞–∫ —Ä–∞–Ω—å—à–µ) --- */
function computeCaseEV(caseObj){
  const total = caseObj.items.reduce((s,it)=>s + (it.chance || 0),0);
  if(total <= 0) return 0;
  return caseObj.items.reduce((s,it)=> s + it.price * ((it.chance || 0)/total), 0);
}

function applyGlobalRtp(targetRtp){
  WORK_CASES.forEach(c => adjustCaseRtp(c, targetRtp));
  state.currentRtp = targetRtp;
  currentRtpEl.textContent = targetRtp.toFixed(2);
  renderCases();
  if(state.selectedCase) selectCase(state.selectedCase.id);
}

function adjustCaseRtp(caseObj, targetRtp){
  const items = caseObj.items;
  const avgPrice = items.reduce((s,i)=>s+i.price,0)/items.length;
  const baseChances = items.map(i => i.baseChance || 1);
  function evForK(k){
    const newChances = items.map((it, idx) => {
      const val = (baseChances[idx] * (1 + k * (it.price / avgPrice - 1)));
      return Math.max(val, 0.01);
    });
    const total = newChances.reduce((s,v)=>s+v,0);
    return items.reduce((s,it,idx)=> s + it.price * (newChances[idx]/total), 0);
  }
  const targetEV = caseObj.price * targetRtp;
  let low = -0.99, high = 10, mid;
  let evHigh = evForK(high);
  if(evHigh < targetEV){ mid = high; } else {
    for(let iter=0; iter<40; iter++){
      mid = (low + high)/2;
      const evMid = evForK(mid);
      if(evMid < targetEV) low = mid; else high = mid;
    }
  }
  const k = mid;
  const newChances = items.map((it, idx) => {
    const val = (baseChances[idx] * (1 + k * (it.price / avgPrice - 1)));
    return Math.max(val, 0.01);
  });
  items.forEach((it, idx) => it.chance = newChances[idx]);
}

/* --- –°–æ–±—ã—Ç–∏—è UI --- */
bankBtn.addEventListener('click', ()=> bankOverlay.style.display = 'flex');
closeBank.addEventListener('click', ()=> bankOverlay.style.display = 'none');
depositBtn.addEventListener('click', ()=> {
  const val = Number(amountInput.value) || 0;
  if(val <= 0) return;
  state.balance += val; updateBalanceUI(); bankOverlay.style.display = 'none';
});
withdrawBtn.addEventListener('click', ()=> {
  const val = Number(amountInput.value) || 0;
  if(val <= 0) return showModal('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –¥–ª—è –≤—ã–≤–æ–¥–∞', false);
  if(val > state.balance) return showModal('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –≤—ã–≤–æ–¥–∞', false);
  state.balance -= val; updateBalanceUI(); bankOverlay.style.display = 'none'; showModal(`–í—ã–≤–µ–¥–µ–Ω–æ ${val} ‚ÇΩ`, false);
});
applyRtpBtn.addEventListener('click', ()=> {
  const val = Number(rtpInput.value) || 1.0;
  if(val <= 0) return showModal('RTP –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º', false);
  applyGlobalRtp(val);
  showModal(`RTP –ø—Ä–∏–º–µ–Ω—ë–Ω: ${val.toFixed(2)}`, false);
});

openOnceBtn.addEventListener('click', ()=> openCase(1));
openTenBtn.addEventListener('click', ()=> openCase(10));
closeModal.addEventListener('click', ()=> overlay.style.display = 'none');

bonusBtn.addEventListener('click', ()=>{
  if(state.bonusTaken){ bonusMsg.textContent = '–ë–æ–Ω—É—Å —É–∂–µ –ø–æ–ª—É—á–µ–Ω —Å–µ–≥–æ–¥–Ω—è'; return; }
  state.balance += 100000; state.bonusTaken = true; updateBalanceUI(); bonusMsg.textContent = '–ë–æ–Ω—É—Å –∑–∞—á–∏—Å–ª–µ–Ω!';
  setTimeout(()=> bonusMsg.textContent = '', 3000);
});

/* --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è --- */
function init(){
  // —Å–∫–æ–ø–∏—Ä—É–µ–º –±–∞–∑–æ–≤—ã–µ —à–∞–Ω—Å—ã –≤ —Ä–∞–±–æ—á–∏–µ items (–µ—Å–ª–∏ –µ—â—ë –Ω–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã)
  WORK_CASES.forEach(c => {
    if(!c.items || c.items.length === 0){
      c.items = c.baseItems.map(it => ({ ...it, chance: it.baseChance }));
    }
  });
  renderCases(); updateBalanceUI(); renderInventory();
  currentRtpEl.textContent = state.currentRtp.toFixed(2);
  // Telegram WebApp integration (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–∞)
  try { if(window.TelegramWebApp && window.TelegramWebApp.MainButton) window.TelegramWebApp.MainButton.hide(); } catch(e){}
}
init();

/* --- –ú–æ–¥–∞–ª–∫–∏ –∏ —É—Ç–∏–ª–∏—Ç—ã --- */
function showModal(text, showWinBox=true){
  document.getElementById('modalContent').innerHTML = text;
  if(showWinBox) winResultBox.style.display = 'none';
  overlay.style.display = 'flex';
}
overlay.addEventListener('click', (e)=> { if(e.target === overlay) overlay.style.display = 'none'; });

/* --- –ö–ª–∞–≤–∏—à–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è --- */
document.addEventListener('keydown', (e)=>{
  if(e.key === 'b') bonusBtn.click();
  if(e.key === 'o' && !openOnceBtn.disabled) openOnceBtn.click();
  if(e.key === '1') selectCase(WORK_CASES[0].id);
});
</script>
</body>
</html>