<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Case Hunters</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body{margin:0;font-family:Arial;background:#0d1117;color:#fff;text-align:center;padding-top:90px}
#top{position:fixed;top:10px;left:10px;right:10px;display:flex;justify-content:space-between}
button{background:#f39c12;border:none;border-radius:10px;padding:8px 14px;font-weight:bold;cursor:pointer}
.section{background:#161b22;border-radius:16px;padding:14px;margin:12px auto;width:min(95vw,540px)}
.case,.item,.drop{display:flex;justify-content:space-between;align-items:center;background:#1f2630;border-radius:12px;padding:10px;margin:8px 0;cursor:pointer}
.case img,.item img,.drop img{width:48px}
.selected{outline:2px solid #f39c12}
.small{font-size:.75em;opacity:.7}
.roulette{overflow:hidden;border:2px solid #f39c12;border-radius:12px;height:90px}
.track{display:flex;position:relative;left:0;transition:left 2.8s cubic-bezier(.1,.8,0,1)}
.track div{min-width:90px;margin:0 4px}
#overlay{position:fixed;inset:0;background:rgba(0,0,0,.9);display:none;align-items:center;justify-content:center}
#modal{background:#161b22;border-radius:18px;padding:16px;width:min(95vw,520px)}
.disabled{opacity:.4}
</style>
</head>

<body>

<div id="top">
  <div id="balance">–ë–∞–ª–∞–Ω—Å: 0 üí∞</div>
  <button onclick="openWithdraw()">üí∏</button>
</div>

<h2>Case Hunters</h2>

<div class="section">
  <h3>üì¶ –ö–µ–π—Å—ã</h3>
  <div id="cases"></div>
</div>

<div class="section">
  <h3>üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h3>
  <div id="inventory"></div>
  <button onclick="sellItem()">–ü—Ä–æ–¥–∞—Ç—å</button>
</div>

<div class="section">
  <h3>‚¨ÜÔ∏è –ê–ø–≥—Ä–µ–π–¥</h3>
  <div id="upgradeText" class="small">–í—ã–±–µ—Ä–∏ –ø—Ä–µ–¥–º–µ—Ç</div>
  <button onclick="upgrade()">–ê–ø–≥—Ä–µ–π–¥</button>
</div>

<div class="section">
  <h3>üìú –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥—Ä–æ–ø—ã</h3>
  <div id="drops"></div>
</div>

<!-- CASE MODAL -->
<div id="overlay">
  <div id="modal">
    <h3 id="caseTitle"></h3>
    <div class="roulette">
      <div id="track" class="track"></div>
    </div>
    <button onclick="spin()">üé∞ –û—Ç–∫—Ä—ã—Ç—å</button>
    <button onclick="overlay.style.display='none'">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>

<!-- WITHDRAW -->
<div id="withdraw" class="section" style="display:none">
  <h3>üí∏ –í—ã–≤–æ–¥</h3>
  <div class="section">üîÑ –ü—Ä–æ–¥–∞—Ç—å ‚Üí –±–∞–ª–∞–Ω—Å</div>
  <div class="section">
    üí∞ CryptoBot (—Ä—É—á–Ω–æ–π)<br>
    <input id="wAmt" placeholder="–°—É–º–º–∞ üí∞"><br><br>
    <button onclick="withdraw()">–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É</button>
  </div>
  <div class="section disabled">üéÆ Steam ‚Äî —Å–∫–æ—Ä–æ</div>
  <button onclick="withdraw.style.display='none'">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>

<script>
const tg=Telegram.WebApp;tg.ready();tg.expand();

/* BALANCE */
let balance=Number(localStorage.bal)||1500;
let vip=localStorage.vip==="1";
function upd(){balanceEl.textContent=`–ë–∞–ª–∞–Ω—Å: ${balance} üí∞${vip?' üíé':''}`;localStorage.bal=balance}
const balanceEl=document.getElementById('balance');upd();

/* REF */
const ref=new URLSearchParams(location.search).get('start');
if(ref&&!localStorage.ref)localStorage.ref=ref;

/* DATA */
const items=[
 {name:'AK-47 | Redline',img:'https://i.imgur.com/HZp7QpB.png',price:200},
 {name:'AWP | Asiimov',img:'https://i.imgur.com/UhU5M1O.png',price:400},
 {name:'Glock | Fade',img:'https://i.imgur.com/yTkZJ9K.png',price:150}
];
const cases=[
 {name:'Low Case',price:50,rtp:.75},
 {name:'Mid Case',price:150,rtp:.6},
 {name:'High Case',price:300,rtp:.45}
];

let inventory=[],selected=null,drops=[];
const casesEl=document.getElementById('cases');
const invEl=document.getElementById('inventory');
const dropsEl=document.getElementById('drops');

/* RENDER */
cases.forEach(c=>{
 let d=document.createElement('div');
 d.className='case';
 d.innerHTML=`<div>${c.name}<div class="small">RTP ${c.rtp*100}%</div></div><div>${c.price} üí∞</div>`;
 d.onclick=()=>openCase(c);
 casesEl.appendChild(d);
});
function drawInv(){
 invEl.innerHTML='';
 inventory.forEach((i,idx)=>{
  let d=document.createElement('div');
  d.className='item'+(selected===idx?' selected':'');
  d.innerHTML=`<img src="${i.img}">${i.name}<div>${i.price} üí∞</div>`;
  d.onclick=()=>{selected=idx;upgradeText.textContent=i.name;drawInv()};
  invEl.appendChild(d);
 });
}
function drawDrops(){
 dropsEl.innerHTML='';
 drops.slice(-5).reverse().forEach(d=>{
  dropsEl.innerHTML+=`<div class="drop"><img src="${d.img}">${d.name}</div>`;
 });
}

/* CASE */
let curCase,winItem;
function openCase(c){
 curCase=c;
 caseTitle.textContent=c.name;
 track.innerHTML='';
 winItem=Math.random()<c.rtp?items[Math.floor(Math.random()*items.length)]:null;
 for(let i=0;i<20;i++){
  let it=items[Math.floor(Math.random()*items.length)];
  track.innerHTML+=`<div><img src="${it.img}" width="60"></div>`;
 }
 overlay.style.display='flex';
}
function spin(){
 if(balance<curCase.price){tg.showAlert('–ù–µ—Ç —Å—Ä–µ–¥—Å—Ç–≤');return}
 balance-=curCase.price;
 if(localStorage.ref) console.log('30% —É—Ö–æ–¥–∏—Ç —Ä–µ—Ñ–µ—Ä—É');
 upd();
 track.style.left='-620px';
 setTimeout(()=>{
  if(winItem){
   inventory.push(winItem);
   drops.push(winItem);
  }
  drawInv();drawDrops();
  overlay.style.display='none';
  track.style.left='0';
 },2800);
}

/* INVENTORY ACTIONS */
function sellItem(){
 if(selected==null)return;
 balance+=inventory[selected].price;
 inventory.splice(selected,1);
 selected=null;
 upgradeText.textContent='–í—ã–±–µ—Ä–∏ –ø—Ä–µ–¥–º–µ—Ç';
 upd();drawInv();
}

/* UPGRADE */
function upgrade(){
 if(selected==null)return;
 let item=inventory[selected];
 let chance=item.price/600;
 if(Math.random()<chance){
  inventory[selected]=items[1];
 }else{
  inventory.splice(selected,1);
 }
 selected=null;
 upgradeText.textContent='–í—ã–±–µ—Ä–∏ –ø—Ä–µ–¥–º–µ—Ç';
 drawInv();
}

/* WITHDRAW */
function openWithdraw(){withdraw.style.display='block'}
function withdraw(){
 let a=+wAmt.value;
 if(a<500||a>balance)return;
 balance-=a;upd();
 tg.showAlert('–ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞ (—Ä—É—á–Ω–∞—è –≤—ã–ø–ª–∞—Ç–∞)');
}
</script>

</body>
</html>