<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<title>Case Hunters ‚Äî Demo</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet">
<style>
/* –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π CSS —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—ã */
:root{
  --bg:#0b0f14;
  --card:#111827;
  --accent:#facc15;
  --muted:#9ca3af;
  --green:#10b981;
  --yellow-line:#facc15;
  --glow: rgba(250,204,21,0.18);
}
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;
  background:var(--bg);
  color:#fff;
  -webkit-tap-highlight-color:transparent;
  -webkit-font-smoothing:antialiased;
}

/* Top Bar - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è Telegram Web */
#topBar{
  position:sticky;
  top:0;
  left:0;
  right:0;
  background:#020617;
  padding:12px 16px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  box-shadow:0 2px 10px rgba(0,0,0,.8);
  z-index:1000;
  backdrop-filter:blur(10px);
}
#logo{
  font-family:'Russo One',sans-serif;
  font-size:20px;
  color:var(--accent);
  letter-spacing:0.5px;
}
#balanceBox{
  padding:8px 14px;
  border-radius:12px;
  background:linear-gradient(135deg,var(--accent),#eab308);
  color:#020617;
  font-weight:700;
  font-size:15px;
  box-shadow:0 0 12px rgba(250,204,21,.5);
  white-space:nowrap;
}

/* Container - –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
.container{
  max-width:100%;
  margin:0 auto;
  padding:16px 12px 140px;
}
.section{
  background:var(--card);
  border-radius:14px;
  padding:16px;
  margin:12px 0;
  border:1px solid rgba(255,255,255,0.05);
}

/* Case Cards - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è —Ç–∞–ø–æ–≤ */
.case{
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:linear-gradient(135deg,#1a2233,#111827);
  border-radius:12px;
  padding:14px;
  margin:10px 0;
  cursor:pointer;
  border:1px solid rgba(255,255,255,0.05);
  transition:transform 0.2s, border-color 0.2s;
  touch-action:manipulation;
}
.case:active{
  transform:scale(0.98);
}
.case:hover{
  border-color:rgba(250,204,21,0.2);
}
.case .left{
  display:flex;
  gap:14px;
  align-items:center;
}
.case-badge{
  width:64px;
  height:64px;
  border-radius:10px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:linear-gradient(135deg,#facc15,#eab308);
  color:#000;
  font-weight:900;
  font-family:'Russo One',sans-serif;
  box-shadow:0 6px 18px var(--glow);
  font-size:14px;
  letter-spacing:1px;
  flex-shrink:0;
}

/* Buttons - —É–ª—É—á—à–µ–Ω—ã –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
.smallBtn{
  background:linear-gradient(135deg,#1a2233,#111827);
  border:1px solid rgba(255,255,255,0.1);
  color:#fff;
  padding:10px 16px;
  border-radius:10px;
  cursor:pointer;
  font-size:14px;
  font-weight:500;
  transition:all 0.2s;
  touch-action:manipulation;
  user-select:none;
}
.smallBtn:active{
  transform:scale(0.95);
}
.openBtn{
  background:linear-gradient(135deg,var(--green),#0da271);
  border:none;
  padding:12px 20px;
  border-radius:12px;
  color:#fff;
  font-weight:600;
  font-size:14px;
  cursor:pointer;
  min-width:100px;
  transition:all 0.2s;
  touch-action:manipulation;
}
.openBtn:active{
  transform:scale(0.95);
}

/* Roulette - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –∞–Ω–∏–º–∞—Ü–∏—è */
.roulette{
  width:100%;
  overflow:hidden;
  position:relative;
  border-radius:14px;
  height:130px;
  margin:12px 0;
  background:#071018;
  border:2px solid rgba(250,204,21,0.1);
  -webkit-overflow-scrolling:touch;
}
.track{
  display:flex;
  height:100%;
  will-change:transform;
  backface-visibility:hidden;
  transform:translate3d(0,0,0);
}
.roulette-item{
  width:130px;
  flex-shrink:0;
  text-align:center;
  font-size:12px;
  padding:10px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
}
.roulette-item img{
  width:90px;
  height:90px;
  display:block;
  margin:0 auto 8px;
  border-radius:10px;
  box-shadow:0 6px 18px rgba(0,0,0,.6);
  object-fit:cover;
  background:#0b0f14;
}
.roulette-center-line{
  position:absolute;
  left:50%;
  top:0;
  transform:translateX(-50%);
  width:4px;
  height:100%;
  background:linear-gradient(180deg,var(--yellow-line),rgba(250,204,21,0.6));
  box-shadow:0 0 20px rgba(250,204,21,0.3);
  pointer-events:none;
  z-index:10;
}

/* Win Modal - –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ Telegram */
#overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.95);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:2000;
  padding:20px;
  animation:fadeIn 0.3s ease;
}
#winResultBox{
  width:100%;
  max-width:420px;
  padding:28px;
  background:linear-gradient(135deg,#071018,#08121a);
  border-radius:18px;
  border:3px solid var(--accent);
  text-align:center;
  animation:slideUp 0.4s ease;
}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes slideUp{from{transform:translateY(30px);opacity:0}to{transform:translateY(0);opacity:1}}
#winResultBox img{
  width:180px;
  height:180px;
  border-radius:12px;
  margin:0 auto 20px;
  box-shadow:0 0 40px rgba(250,204,21,.2);
  object-fit:cover;
}
#winResultBox .winTitle{
  font-size:24px;
  font-weight:800;
  color:var(--accent);
  margin-bottom:10px;
  line-height:1.2;
}

/* Inventory Items */
.item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:linear-gradient(135deg,#1a2233,#111827);
  border-radius:12px;
  padding:14px;
  margin:10px 0;
  border:1px solid rgba(255,255,255,0.05);
}
.weapon-img{
  width:64px;
  height:64px;
  border-radius:10px;
  object-fit:cover;
  box-shadow:0 4px 12px rgba(0,0,0,.5);
  background:#0b0f14;
  flex-shrink:0;
}

/* Chat –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
.chatBox{
  width:100%;
  max-height:360px;
  background:#0b1220;
  border-radius:12px;
  padding:12px;
  overflow-y:auto;
  border:1px solid #16202a;
  -webkit-overflow-scrolling:touch;
}
.chatMessage{
  padding:10px;
  border-radius:10px;
  margin-bottom:10px;
  background:linear-gradient(135deg,#071018,#08121a);
  font-size:14px;
  line-height:1.4;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
@media (max-width:768px){
  .container{
    padding:12px 10px 120px;
  }
  .section{
    padding:14px;
    margin:10px 0;
  }
  .case{
    padding:12px;
    flex-wrap:wrap;
  }
  .case .left{
    width:100%;
    margin-bottom:12px;
  }
  .openBtn{
    width:100%;
    margin-top:8px;
  }
  .roulette{
    height:120px;
  }
  .roulette-item{
    width:120px;
  }
  .roulette-item img{
    width:80px;
    height:80px;
  }
  #winResultBox{
    padding:24px 20px;
    margin:20px;
  }
  #winResultBox img{
    width:150px;
    height:150px;
  }
}

@media (max-width:480px){
  #topBar{
    padding:10px 12px;
  }
  #logo{
    font-size:18px;
  }
  #balanceBox{
    padding:6px 12px;
    font-size:14px;
  }
  .case-badge{
    width:56px;
    height:56px;
    font-size:12px;
  }
}
</style>
</head>
<body>

<!-- –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É HTML -->
<div id="topBar">
  <div id="logo">CASE HUNTERS</div>
  <div style="display:flex;align-items:center;gap:10px">
    <div id="balanceBox"><span style="font-size:16px;">üíµ</span> <span id="balance">0</span> ‚ÇΩ</div>
    <button id="bankBtn" class="smallBtn">üíº</button>
    <button id="adminToggle" class="smallBtn" title="–ê–¥–º–∏–Ω–∫–∞">Admin</button>
  </div>
</div>

<div class="daily-bonus" style="background:#111827;padding:12px 16px;text-align:center;border-bottom:1px solid #222">
  <button id="dailyBonusBtnTop" class="smallBtn">üéÅ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å +10 ‚ÇΩ</button>
</div>

<div class="container">
  <div style="display:flex;flex-direction:column;gap:12px">
    <div>
      <div class="section">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
          <div style="font-weight:bold;font-size:16px">–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–µ–π—Å—ã</div>
          <div style="font-size:12px;color:var(--muted)">–ù–∞–∂–º–∏—Ç–µ "–û—Ç–∫—Ä—ã—Ç—å" –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ä—É–ª–µ—Ç–∫–∏</div>
        </div>
        <div id="casesList"></div>
      </div>

      <div class="section">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
          <div style="font-weight:bold;font-size:16px">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</div>
          <div style="font-size:12px;color:var(--muted)">–í–∞—à–∏ –ø—Ä–µ–¥–º–µ—Ç—ã</div>
        </div>
        <div id="inventoryList" style="margin-top:12px"></div>
      </div>

      <div class="section">
        <div style="font-weight:bold;font-size:16px;margin-bottom:12px">–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞</div>
        <div style="font-size:13px;color:var(--muted);margin-bottom:8px">–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:</div>
        <input id="myRefLink" style="width:100%;padding:10px;border-radius:10px;border:1px solid #2b3440;background:#071018;color:#fff;font-size:14px" readonly>
        
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
          <div style="font-size:13px">
            –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: <b id="refEarnings">0</b> ‚ÇΩ
          </div>
          <button id="claimRefBtn" class="smallBtn">–ó–∞—á–∏—Å–ª–∏—Ç—å</button>
        </div>
        
        <div style="display:flex;gap:8px;margin-top:16px">
          <button id="dailyBonusBtn" class="smallBtn" style="flex:1">üéÅ –ë–æ–Ω—É—Å 10 ‚ÇΩ</button>
          <button id="extraBonusBtn" class="smallBtn" style="flex:1">‚ú® +10 ‚ÇΩ</button>
        </div>
      </div>
    </div>

    <div>
      <div style="background:#071018;border-radius:12px;padding:16px;margin-bottom:12px">
        <div style="font-weight:bold;font-size:14px;margin-bottom:6px">–û–Ω–ª–∞–π–Ω</div>
        <div style="font-size:32px;font-weight:800" id="fakeOnline">0</div>
        <div style="font-size:12px;color:var(--muted);margin-top:4px">–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–µ–π—á–∞—Å</div>
      </div>

      <div class="chatBox" id="chatBox" aria-live="polite"></div>
    </div>
  </div>
</div>

<!-- –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
<div id="adminPanel" style="position:fixed;right:16px;top:100px;background:#0b1220;border:1px solid #1f2937;padding:16px;border-radius:12px;z-index:1000;min-width:280px;display:none">
  <!-- ... (–∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ... -->
</div>

<div id="bankOverlay" style="display:none;position:fixed;inset:0;z-index:1500;align-items:center;justify-content:center;background:rgba(0,0,0,0.9)">
  <!-- ... (–±–∞–Ω–∫ –º–æ–¥–∞–ª–∫–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ... -->
</div>

<div id="overlay">
  <div id="modal">
    <div id="winResultBox" style="display:none">
      <img id="winImg" src="" alt="win">
      <div class="winTitle" id="winTitle">–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏</div>
      <div class="winPrice" id="winPrice">0 ‚ÇΩ</div>
      <div class="winNote" id="winNote">–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –ü—Ä–µ–¥–º–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å.</div>
      <div style="margin-top:20px"><button id="closeModal" class="smallBtn">–ó–∞–∫—Ä—ã—Ç—å</button></div>
    </div>
  </div>
</div>

<script>
// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
const CONFIG = {
  STORAGE_PREFIX: 'ch_',
  DEFAULT_RTP: 0.65,
  DEMO_PASSWORD: '!125125Cc',
  IMAGE_BASE: '/assets/cs/',
  SPIN_DURATION: 6000,
  CHAT_UPDATE_INTERVAL: 7000
};

// –î–∞–Ω–Ω—ã–µ –∫–µ–π—Å–æ–≤ (—Å–æ–∫—Ä–∞—â–µ–Ω–æ –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞)
const CASES = [
  {
    id: 'case0',
    name: 'Starter Case',
    price: 120,
    items: [
      { id: 's1', name: 'P250 | Sand Dune', price: 220, baseChance: 55 },
      { id: 's2', name: 'USP-S | Torque', price: 480, baseChance: 30 },
      { id: 's4', name: 'CZ75-Auto | Tigris', price: 900, baseChance: 10 },
      { id: 's3', name: 'Nova | Ranger', price: 1500, baseChance: 5 }
    ]
  },
  {
    id: 'case1',
    name: 'Dust II Case',
    price: 220,
    items: [
      { id: 'g1', name: 'AK-47 | Redline', price: 900, baseChance: 40 },
      { id: 'g2', name: 'M4A1-S | Guardian', price: 1800, baseChance: 30 },
      { id: 'g5', name: 'P90 | Asiimov', price: 2600, baseChance: 10 },
      { id: 'g3', name: 'Desert Eagle | Blaze', price: 5200, baseChance: 20 }
    ]
  }
];

// –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
class CaseHuntersApp {
  constructor() {
    this.state = {
      balance: 0,
      inventory: [],
      currentRtp: CONFIG.DEFAULT_RTP,
      adminLogged: false
    };
    
    this.userId = this.getUserId();
    this.cases = this.prepareCases();
    this.init();
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  init() {
    this.loadState();
    this.setupReferrer();
    this.bindEvents();
    this.renderCases();
    this.renderInventory();
    this.updateUI();
    this.initChat();
    this.initOnlineCounter();
  }

  // –ü–æ–ª—É—á–µ–Ω–∏–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  getUserId() {
    const key = CONFIG.STORAGE_PREFIX + 'userid';
    let id = localStorage.getItem(key);
    if (!id) {
      id = 'user_' + Math.random().toString(36).slice(2, 9);
      localStorage.setItem(key, id);
    }
    return id;
  }

  // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
  loadState() {
    try {
      const balanceKey = CONFIG.STORAGE_PREFIX + 'balance_' + this.userId;
      const balance = localStorage.getItem(balanceKey);
      this.state.balance = balance ? parseInt(balance) : 0;

      const inventoryKey = CONFIG.STORAGE_PREFIX + 'inventory_' + this.userId;
      const inventory = localStorage.getItem(inventoryKey);
      this.state.inventory = inventory ? JSON.parse(inventory) : [];
    } catch (error) {
      console.error('Error loading state:', error);
    }
  }

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
  saveState() {
    try {
      const balanceKey = CONFIG.STORAGE_PREFIX + 'balance_' + this.userId;
      localStorage.setItem(balanceKey, this.state.balance.toString());

      const inventoryKey = CONFIG.STORAGE_PREFIX + 'inventory_' + this.userId;
      localStorage.setItem(inventoryKey, JSON.stringify(this.state.inventory));
    } catch (error) {
      console.error('Error saving state:', error);
    }
  }

  // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–µ–π—Å–æ–≤
  prepareCases() {
    return CASES.map(c => ({
      ...c,
      items: c.items.map(it => ({ ...it, chance: it.baseChance })),
      baseTotalChance: c.items.reduce((s, i) => s + i.baseChance, 0)
    }));
  }

  // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª–∞
  setupReferrer() {
    try {
      const urlParams = new URLSearchParams(window.location.search);
      const referrer = urlParams.get('ref');
      
      if (referrer && referrer !== this.userId) {
        const referrerKey = CONFIG.STORAGE_PREFIX + 'referrer_' + this.userId;
        localStorage.setItem(referrerKey, referrer);
      }
    } catch (error) {
      console.error('Error setting up referrer:', error);
    }
  }

  // –ü—Ä–∏–≤—è–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π
  bindEvents() {
    // –ë–∞–Ω–∫
    document.getElementById('bankBtn')?.addEventListener('click', () => {
      document.getElementById('bankOverlay').style.display = 'flex';
    });
    
    document.getElementById('closeBank')?.addEventListener('click', () => {
      document.getElementById('bankOverlay').style.display = 'none';
    });

    // –ê–¥–º–∏–Ω–∫–∞
    document.getElementById('adminToggle')?.addEventListener('click', () => {
      const panel = document.getElementById('adminPanel');
      panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
    });

    // –ë–æ–Ω—É—Å—ã
    document.getElementById('dailyBonusBtn')?.addEventListener('click', () => this.claimBonus('daily'));
    document.getElementById('dailyBonusBtnTop')?.addEventListener('click', () => this.claimBonus('daily'));
    document.getElementById('extraBonusBtn')?.addEventListener('click', () => this.claimBonus('extra'));

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–æ–∫
    document.getElementById('closeModal')?.addEventListener('click', () => {
      document.getElementById('overlay').style.display = 'none';
    });
  }

  // –†–µ–Ω–¥–µ—Ä –∫–µ–π—Å–æ–≤
  renderCases() {
    const container = document.getElementById('casesList');
    if (!container) return;

    container.innerHTML = '';

    this.cases.forEach(caseItem => {
      const caseElement = document.createElement('div');
      caseElement.className = 'case';
      caseElement.dataset.id = caseItem.id;

      caseElement.innerHTML = `
        <div class="left">
          <div class="case-badge">
            <div style="transform:translateY(1px)">–ö–ï–ô–°</div>
          </div>
          <div class="meta">
            <div style="font-weight:bold;font-size:15px">${caseItem.name}</div>
            <div style="font-size:13px;color:var(--muted)">–¶–µ–Ω–∞: ${caseItem.price} ‚ÇΩ</div>
          </div>
        </div>
        <div>
          <button class="openBtn" data-case="${caseItem.id}">–û—Ç–∫—Ä—ã—Ç—å</button>
        </div>
      `;

      // –î–æ–±–∞–≤–ª—è–µ–º —Ä—É–ª–µ—Ç–∫—É
      const rouletteWrapper = document.createElement('div');
      rouletteWrapper.className = 'roulette';
      rouletteWrapper.style.display = 'none';
      rouletteWrapper.innerHTML = `
        <div class="track" data-case="${caseItem.id}"></div>
        <div class="roulette-center-line"></div>
      `;
      
      caseElement.appendChild(rouletteWrapper);
      container.appendChild(caseElement);

      // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º —Ä—É–ª–µ—Ç–∫—É
      this.prepareRoulette(caseItem, rouletteWrapper.querySelector('.track'));

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
      const openBtn = caseElement.querySelector('.openBtn');
      openBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        this.openCase(caseItem.id);
      });

      caseElement.addEventListener('click', (e) => {
        if (e.target !== openBtn && !e.target.closest('.openBtn')) {
          this.toggleRoulette(caseItem.id);
        }
      });
    });
  }

  // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä—É–ª–µ—Ç–∫–∏
  prepareRoulette(caseItem, trackElement) {
    if (!trackElement) return;

    // –î—É–±–ª–∏—Ä—É–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç–∏
    const itemsToShow = 20;
    trackElement.innerHTML = '';

    for (let i = 0; i < itemsToShow; i++) {
      caseItem.items.forEach(item => {
        const itemElement = document.createElement('div');
        itemElement.className = 'roulette-item';
        
        const img = document.createElement('img');
        img.className = 'weapon-img';
        img.src = this.getImageUrl(item);
        img.alt = item.name;
        img.onerror = () => {
          img.src = this.createPlaceholder(item.name);
        };

        itemElement.appendChild(img);
        itemElement.innerHTML += `
          <div style="font-size:12px;margin-top:4px">${item.name}</div>
          <div style="font-size:11px;color:var(--muted)">${item.price} ‚ÇΩ</div>
        `;

        trackElement.appendChild(itemElement);
      });
    }
  }

  // –û—Ç–∫—Ä—ã—Ç–∏–µ –∫–µ–π—Å–∞
  async openCase(caseId) {
    const caseItem = this.cases.find(c => c.id === caseId);
    if (!caseItem) return;

    if (!this.state.adminLogged && this.state.balance < caseItem.price) {
      this.showMessage(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤. –ù—É–∂–Ω–æ ${caseItem.price} ‚ÇΩ`);
      return;
    }

    // –°–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤
    if (!this.state.adminLogged) {
      this.updateBalance(-caseItem.price);
    }

    // –í—ã–±–æ—Ä –ø—Ä–µ–¥–º–µ—Ç–∞
    const winItem = this.selectRandomItem(caseItem.items);
    
    // –ó–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏
    await this.animateRoulette(caseId, winItem);
    
    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
    this.addToInventory(winItem);
    
    // –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    this.showWinResult(winItem);
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
    this.renderInventory();
    this.updateUI();
  }

  // –ê–Ω–∏–º–∞—Ü–∏—è —Ä—É–ª–µ—Ç–∫–∏
  animateRoulette(caseId, winItem) {
    return new Promise((resolve) => {
      const track = document.querySelector(`.track[data-case="${caseId}"]`);
      if (!track) {
        resolve();
        return;
      }

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä—É–ª–µ—Ç–∫—É
      const roulette = track.closest('.roulette');
      if (roulette) {
        roulette.style.display = 'block';
      }

      // –ê–Ω–∏–º–∞—Ü–∏—è
      const duration = CONFIG.SPIN_DURATION;
      const items = track.querySelectorAll('.roulette-item');
      const itemWidth = items[0]?.offsetWidth || 130;
      
      // –ù–∞—Ö–æ–¥–∏–º –∏–Ω–¥–µ–∫—Å –≤—ã–∏–≥—Ä–∞–Ω–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞
      let winIndex = 0;
      for (let i = 0; i < items.length; i++) {
        if (items[i].textContent.includes(winItem.name)) {
          winIndex = i;
          break;
        }
      }

      // –í—ã—á–∏—Å–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é
      const targetPosition = -(winIndex * itemWidth);
      const extraSpins = 5; // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–±–æ—Ä–æ—Ç—ã
      const finalPosition = targetPosition - (extraSpins * items.length * itemWidth);

      // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
      track.style.transition = `transform ${duration}ms cubic-bezier(0.2, 0.9, 0.2, 1)`;
      track.style.transform = `translateX(${finalPosition}px)`;

      setTimeout(() => {
        track.style.transition = 'none';
        resolve();
      }, duration + 100);
    });
  }

  // –í—ã–±–æ—Ä —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞
  selectRandomItem(items) {
    const totalChance = items.reduce((sum, item) => sum + (item.chance || 1), 0);
    let random = Math.random() * totalChance;
    
    for (const item of items) {
      random -= item.chance || 1;
      if (random <= 0) {
        return { ...item };
      }
    }
    
    return { ...items[items.length - 1] };
  }

  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
  addToInventory(item) {
    const inventoryItem = {
      id: item.id,
      name: item.name,
      price: item.price,
      img: this.getImageUrl(item),
      uid: 'item_' + Date.now() + '_' + Math.random().toString(36).slice(2)
    };
    
    this.state.inventory.push(inventoryItem);
    this.saveState();
  }

  // –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤—ã–∏–≥—Ä—ã—à–∞
  showWinResult(item) {
    const winImg = document.getElementById('winImg');
    const winTitle = document.getElementById('winTitle');
    const winPrice = document.getElementById('winPrice');
    const winNote = document.getElementById('winNote');
    
    winImg.src = this.getImageUrl(item);
    winImg.onerror = () => {
      winImg.src = this.createPlaceholder(item.name);
    };
    
    winTitle.textContent = item.name;
    winPrice.textContent = `${item.price} ‚ÇΩ`;
    winNote.textContent = '–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –ü—Ä–µ–¥–º–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å.';
    
    document.getElementById('winResultBox').style.display = 'block';
    document.getElementById('overlay').style.display = 'flex';
  }

  // –†–µ–Ω–¥–µ—Ä –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
  renderInventory() {
    const container = document.getElementById('inventoryList');
    if (!container) return;

    if (this.state.inventory.length === 0) {
      container.innerHTML = '<div style="text-align:center;color:var(--muted);padding:20px">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç</div>';
      return;
    }

    container.innerHTML = '';
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã –ø–µ—Ä–≤—ã–º–∏
    [...this.state.inventory].reverse().forEach(item => {
      const itemElement = document.createElement('div');
      itemElement.className = 'item';
      
      itemElement.innerHTML = `
        <div class="left">
          <img src="${item.img}" alt="${item.name}" class="weapon-img" 
               onerror="this.src='${this.createPlaceholder(item.name)}'">
          <div class="meta">
            <div style="font-weight:bold;font-size:14px">${item.name}</div>
            <div style="font-size:12px;color:var(--muted)">${item.price} ‚ÇΩ</div>
          </div>
        </div>
        <div>
          <button class="smallBtn" data-sell="${item.uid}" style="margin-bottom:8px">–ü—Ä–æ–¥–∞—Ç—å</button>
        </div>
      `;

      container.appendChild(itemElement);

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–æ–¥–∞–∂–∏
      const sellBtn = itemElement.querySelector('[data-sell]');
      sellBtn.addEventListener('click', () => {
        this.sellItem(item.uid);
      });
    });
  }

  // –ü—Ä–æ–¥–∞–∂–∞ –ø—Ä–µ–¥–º–µ—Ç–∞
  sellItem(itemUid) {
    const itemIndex = this.state.inventory.findIndex(item => item.uid === itemUid);
    if (itemIndex === -1) return;

    const item = this.state.inventory[itemIndex];
    this.updateBalance(item.price);
    this.state.inventory.splice(itemIndex, 1);
    
    this.saveState();
    this.renderInventory();
    this.showMessage(`–ü—Ä–µ–¥–º–µ—Ç –ø—Ä–æ–¥–∞–Ω –∑–∞ ${item.price} ‚ÇΩ`);
  }

  // –ü–æ–ª—É—á–µ–Ω–∏–µ –±–æ–Ω—É—Å–∞
  claimBonus(type) {
    const today = new Date().toISOString().split('T')[0];
    const storageKey = type === 'daily' 
      ? CONFIG.STORAGE_PREFIX + 'lastBonus_' + this.userId
      : CONFIG.STORAGE_PREFIX + 'lastExtraBonus_' + this.userId;

    const lastClaim = localStorage.getItem(storageKey);
    const amount = type === 'daily' ? 10 : 10;

    if (lastClaim === today) {
      this.showMessage(`–ë–æ–Ω—É—Å —É–∂–µ –ø–æ–ª—É—á–µ–Ω —Å–µ–≥–æ–¥–Ω—è`);
      return;
    }

    this.updateBalance(amount);
    localStorage.setItem(storageKey, today);
    
    const message = type === 'daily' 
      ? `–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å ${amount} ‚ÇΩ –∑–∞—á–∏—Å–ª–µ–Ω`
      : `–ë–æ–Ω—É—Å ${amount} ‚ÇΩ –∑–∞—á–∏—Å–ª–µ–Ω`;
    
    this.showMessage(message);
    this.addChatMessage(`–ò–≥—Ä–æ–∫ –ø–æ–ª—É—á–∏–ª –±–æ–Ω—É—Å ${amount} ‚ÇΩ`);
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
  updateBalance(amount) {
    this.state.balance += amount;
    if (this.state.balance < 0) this.state.balance = 0;
    
    this.saveState();
    this.updateUI();
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
  updateUI() {
    const balanceElement = document.getElementById('balance');
    if (balanceElement) {
      balanceElement.textContent = this.state.adminLogged ? '‚àû' : this.state.balance;
    }

    const refEarningsElement = document.getElementById('refEarnings');
    if (refEarningsElement) {
      refEarningsElement.textContent = this.getReferralEarnings();
    }

    const refLinkElement = document.getElementById('myRefLink');
    if (refLinkElement) {
      refLinkElement.value = `${window.location.origin}${window.location.pathname}?ref=${this.userId}`;
    }
  }

  // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã
  getImageUrl(item) {
    return CONFIG.IMAGE_BASE + item.id + '.png';
  }

  createPlaceholder(text) {
    const canvas = document.createElement('canvas');
    canvas.width = 100;
    canvas.height = 100;
    const ctx = canvas.getContext('2d');
    
    // –§–æ–Ω
    ctx.fillStyle = '#0b0f14';
    ctx.fillRect(0, 0, 100, 100);
    
    // –¢–µ–∫—Å—Ç
    ctx.fillStyle = '#facc15';
    ctx.font = '12px Arial';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(text.substring(0, 10), 50, 50);
    
    return canvas.toDataURL();
  }

  getReferralEarnings() {
    const key = CONFIG.STORAGE_PREFIX + 'refearn_' + this.userId;
    return parseInt(localStorage.getItem(key) || '0');
  }

  showMessage(text) {
    alert(text); // –í Telegram –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ showAlert
  }

  // –ß–∞—Ç
  initChat() {
    this.addChatMessage('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Case Hunters!');
    
    // –ò–º–∏—Ç–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —á–∞—Ç–∞
    setInterval(() => {
      const messages = [
        '–ò–≥—Ä–æ–∫ –æ—Ç–∫—Ä—ã–ª –∫–µ–π—Å –∏ –ø–æ–ª—É—á–∏–ª AK-47 | Redline',
        '–ö—Ç–æ-—Ç–æ –≤—ã–≤–µ–ª 500 ‚ÇΩ',
        '–ù–æ–≤—ã–π —Ä–µ–∫–æ—Ä–¥: 1000 ‚ÇΩ –∑–∞ –æ–¥–∏–Ω —Å–ø–∏–Ω!',
        '–ò–≥—Ä–æ–∫ –ø—Ä–æ–¥–∞–ª –ø—Ä–µ–¥–º–µ—Ç –∑–∞ 750 ‚ÇΩ'
      ];
      
      const randomMessage = messages[Math.floor(Math.random() * messages.length)];
      this.addChatMessage(randomMessage);
    }, CONFIG.CHAT_UPDATE_INTERVAL);
  }

  addChatMessage(text) {
    const chatBox = document.getElementById('chatBox');
    if (!chatBox) return;

    const messageElement = document.createElement('div');
    messageElement.className = 'chatMessage';
    
    const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    
    messageElement.innerHTML = `
      <div style="display:flex;justify-content:space-between;font-size:11px;color:var(--muted);margin-bottom:4px">
        <span>–ò–≥—Ä–æ–∫</span>
        <span>${time}</span>
      </div>
      <div style="font-size:13px">${text}</div>
    `;

    chatBox.appendChild(messageElement);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  // –°—á–µ—Ç—á–∏–∫ –æ–Ω–ª–∞–π–Ω
  initOnlineCounter() {
    let onlineCount = 120 + Math.floor(Math.random() * 80);
    const update = () => {
      onlineCount += Math.floor(Math.random() * 7) - 3;
      if (onlineCount < 50) onlineCount = 50;
      
      const onlineElement = document.getElementById('fakeOnline');
      if (onlineElement) {
        onlineElement.textContent = onlineCount;
      }
    };

    update();
    setInterval(update, 5000);
  }

  // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä—É–ª–µ—Ç–∫–∏
  toggleRoulette(caseId) {
    const caseElement = document.querySelector(`.case[data-id="${caseId}"]`);
    if (!caseElement) return;

    const roulette = caseElement.querySelector('.roulette');
    if (!roulette) return;

    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ä—É–ª–µ—Ç–∫–∏
    document.querySelectorAll('.case .roulette').forEach(r => {
      if (r !== roulette) r.style.display = 'none';
    });

    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ç–µ–∫—É—â—É—é
    roulette.style.display = roulette.style.display === 'none' ? 'block' : 'none';
  }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
let app;

document.addEventListener('DOMContentLoaded', () => {
  try {
    app = new CaseHuntersApp();
    
    // –≠–∫—Å–ø–æ—Ä—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
    window.CaseHunters = app;
    
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
    alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
  }
});

// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π
function handleWithdraw() {
  const amountInput = document.getElementById('amountInput');
  if (!amountInput) return;

  const amount = parseInt(amountInput.value) || 0;
  if (amount < 500) {
    alert('–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤—ã–≤–æ–¥–∞ ‚Äî 500 ‚ÇΩ');
    return;
  }

  app?.updateBalance(-amount);
  document.getElementById('bankOverlay').style.display = 'none';
  app?.showMessage(`–í—ã–≤–µ–¥–µ–Ω–æ ${amount} ‚ÇΩ`);
  app?.addChatMessage(`–ò–≥—Ä–æ–∫ –≤—ã–≤–µ–ª ${amount} ‚ÇΩ`);
}

function adminLoginHandler() {
  const passwordInput = document.getElementById('adminPass');
  if (!passwordInput) return;

  if (passwordInput.value === CONFIG.DEMO_PASSWORD) {
    app.state.adminLogged = true;
    app.updateUI();
    app.showMessage('–ê–¥–º–∏–Ω-—Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω');
  } else {
    app.showMessage('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å');
  }
}
</script>
</body>
</html>