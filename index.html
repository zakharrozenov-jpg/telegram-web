<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<title>Case Hunters</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet">
<style>
/* –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π CSS –¥–ª—è Telegram Web */
:root{
  --bg:#0b0f14;
  --card:#111827;
  --accent:#facc15;
  --muted:#9ca3af;
  --green:#10b981;
  --red:#ef4444;
  --blue:#3b82f6;
  --purple:#8b5cf6;
  --yellow-line:#facc15;
  --glow: rgba(250,204,21,0.18);
  --shadow: 0 4px 20px rgba(0,0,0,.6);
}
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;
  background:var(--bg);
  color:#fff;
  -webkit-tap-highlight-color:transparent;
  -webkit-font-smoothing:antialiased;
  overflow-x:hidden;
}

/* Top Bar - –ò–°–ü–†–ê–í–õ–ï–ù–û –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
#topBar{
  position:sticky;
  top:0;
  left:0;
  right:0;
  background:#020617;
  padding:10px 12px;
  display:flex;
  flex-direction:column;
  gap:8px;
  box-shadow:var(--shadow);
  z-index:1000;
  backdrop-filter:blur(10px);
}
#logo{
  font-family:'Russo One',sans-serif;
  font-size:18px;
  color:var(--accent);
  letter-spacing:0.5px;
  text-align:center;
  width:100%;
  padding-bottom:8px;
  border-bottom:1px solid rgba(255,255,255,0.1);
}
.top-controls{
  display:flex;
  width:100%;
  gap:8px;
  align-items:center;
}
#balanceBox{
  padding:8px 12px;
  border-radius:10px;
  background:linear-gradient(135deg,var(--accent),#eab308);
  color:#020617;
  font-weight:700;
  font-size:14px;
  box-shadow:0 0 10px rgba(250,204,21,.5);
  white-space:nowrap;
  flex:1;
  text-align:center;
}
.top-buttons{
  display:flex;
  gap:6px;
  align-items:center;
}
.top-buttons .smallBtn{
  min-width:50px;
  text-align:center;
  padding:8px 10px;
  font-size:13px;
}
#soundToggle{
  width:32px;
  height:32px;
  border-radius:50%;
  background:linear-gradient(135deg, #3b82f6, #2563eb);
  border:none;
  color:white;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:16px;
  transition:all 0.3s ease;
  flex-shrink:0;
}
#soundToggle:hover{
  transform:scale(1.1);
}
#soundToggle.muted{
  background:linear-gradient(135deg, #6b7280, #4b5563);
}

/* Container */
.container{
  max-width:100%;
  margin:0 auto;
  padding:16px 10px 180px;
}
.section{
  background:var(--card);
  border-radius:14px;
  padding:16px;
  margin:12px 0;
  border:1px solid rgba(255,255,255,0.05);
  box-shadow:0 4px 12px rgba(0,0,0,.3);
}

/* Case Cards */
.case{
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:linear-gradient(135deg,#1a2233,#111827);
  border-radius:12px;
  padding:14px;
  margin:10px 0;
  cursor:pointer;
  border:1px solid rgba(255,255,255,0.05);
  transition:all 0.3s ease;
  touch-action:manipulation;
  position:relative;
  overflow:hidden;
}
.case::before{
  content:'';
  position:absolute;
  top:0;
  left:-100%;
  width:100%;
  height:100%;
  background:linear-gradient(90deg, transparent, rgba(250,204,21,0.1), transparent);
  transition:left 0.7s ease;
}
.case:hover::before{
  left:100%;
}
.case:active{
  transform:scale(0.98);
}
.case:hover{
  border-color:rgba(250,204,21,0.3);
  box-shadow:0 0 20px rgba(250,204,21,0.2);
}
.case .left{
  display:flex;
  gap:12px;
  align-items:center;
  flex:1;
}
.case-badge{
  width:60px;
  height:60px;
  border-radius:10px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:linear-gradient(135deg,#facc15,#eab308);
  color:#000;
  font-weight:900;
  font-family:'Russo One',sans-serif;
  box-shadow:0 6px 20px var(--glow);
  font-size:12px;
  letter-spacing:1px;
  flex-shrink:0;
  transition:all 0.3s ease;
}
.case:hover .case-badge{
  transform:rotate(5deg) scale(1.05);
  box-shadow:0 8px 25px rgba(250,204,21,0.4);
}
.case .meta{
  flex:1;
}
.case .meta .title{
  font-weight:bold;
  font-size:15px;
  margin-bottom:4px;
}
.case .meta .sub{
  font-size:12px;
  color:var(--muted);
}
.case .right{
  display:flex;
  flex-direction:column;
  align-items:flex-end;
  gap:6px;
}

/* Buttons */
.smallBtn{
  background:linear-gradient(135deg,#1a2233,#111827);
  border:1px solid rgba(255,255,255,0.1);
  color:#fff;
  padding:8px 14px;
  border-radius:8px;
  cursor:pointer;
  font-size:13px;
  font-weight:500;
  transition:all 0.2s;
  touch-action:manipulation;
  user-select:none;
  min-width:70px;
  position:relative;
  overflow:hidden;
}
.smallBtn::after{
  content:'';
  position:absolute;
  top:50%;
  left:50%;
  width:5px;
  height:5px;
  background:rgba(255,255,255,0.5);
  opacity:0;
  border-radius:100%;
  transform:scale(1,1) translate(-50%);
  transform-origin:50% 50%;
}
.smallBtn:focus:not(:active)::after{
  animation:ripple 1s ease-out;
}
@keyframes ripple{
  0%{transform:scale(0,0); opacity:0.5;}
  20%{transform:scale(25,25); opacity:0.3;}
  100%{transform:scale(40,40); opacity:0;}
}
.smallBtn:active{
  transform:scale(0.95);
}
.openBtn{
  background:linear-gradient(135deg,var(--green),#0da271);
  border:none;
  padding:10px 16px;
  border-radius:10px;
  color:#fff;
  font-weight:600;
  font-size:13px;
  cursor:pointer;
  min-width:90px;
  transition:all 0.2s;
  touch-action:manipulation;
  box-shadow:0 4px 12px rgba(16,185,129,0.3);
  position:relative;
  overflow:hidden;
}
.openBtn::before{
  content:'';
  position:absolute;
  top:0;
  left:-100%;
  width:100%;
  height:100%;
  background:linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
  transition:left 0.5s;
}
.openBtn:hover::before{
  left:100%;
}
.openBtn:active{
  transform:scale(0.95);
}
.openBtn:disabled{
  opacity:0.5;
  cursor:not-allowed;
  transform:none;
}

/* –ö–Ω–æ–ø–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª–∫–∏ */
.copy-btn{
  background:linear-gradient(135deg, #3b82f6, #2563eb);
  border:none;
  color:white;
  padding:8px 14px;
  border-radius:8px;
  cursor:pointer;
  font-size:13px;
  transition:all 0.2s;
  display:flex;
  align-items:center;
  gap:5px;
  touch-action:manipulation;
  position:relative;
  overflow:hidden;
}
.copy-btn::before{
  content:'';
  position:absolute;
  top:0;
  left:-100%;
  width:100%;
  height:100%;
  background:linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
  transition:left 0.5s;
}
.copy-btn:hover::before{
  left:100%;
}
.copy-btn:active{
  transform:scale(0.95);
}
.copy-btn.copied{
  background:linear-gradient(135deg, var(--green), #0da271);
  animation:pulse 0.5s ease-in-out;
}
@keyframes pulse{
  0%{transform:scale(1);}
  50%{transform:scale(1.05);}
  100%{transform:scale(1);}
}

/* Roulette - –ë–ï–°–ö–û–ù–ï–ß–ù–ê–Ø —Ä—É–ª–µ—Ç–∫–∞ –±–µ–∑ –∏—Å—á–µ–∑–∞—é—â–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
.roulette{
  width:100%;
  overflow:hidden;
  position:relative;
  border-radius:12px;
  height:130px;
  margin:12px 0;
  background:#071018;
  border:2px solid rgba(250,204,21,0.1);
  -webkit-overflow-scrolling:touch;
}
.track{
  display:flex;
  height:100%;
  will-change:transform;
  transform:translate3d(0,0,0);
}
.roulette-item{
  width:120px;
  flex-shrink:0;
  text-align:center;
  padding:10px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  transition:all 0.3s ease;
}
.roulette-item img{
  width:80px;
  height:80px;
  display:block;
  margin:0 auto 6px;
  border-radius:10px;
  box-shadow:0 6px 20px rgba(0,0,0,.7);
  object-fit:cover;
  background:#0b0f14;
}
.roulette-item.active{
  animation:itemHighlight 0.8s ease-in-out;
  border:2px solid var(--accent);
  border-radius:10px;
  box-shadow:0 0 30px rgba(250,204,21,0.7);
  transform:scale(1.05);
}
@keyframes itemHighlight{
  0%,100%{transform:scale(1.05); box-shadow:0 0 30px rgba(250,204,21,0.7);}
  50%{transform:scale(1.08); box-shadow:0 0 40px rgba(250,204,21,0.9);}
}
.roulette-center-line{
  position:absolute;
  left:50%;
  top:0;
  transform:translateX(-50%);
  width:4px;
  height:100%;
  background:linear-gradient(180deg,var(--yellow-line),rgba(250,204,21,0.6));
  box-shadow:0 0 25px rgba(250,204,21,0.4);
  pointer-events:none;
  z-index:10;
}
.roulette-glow{
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  width:200px;
  height:200px;
  border-radius:50%;
  background:radial-gradient(circle, rgba(250,204,21,0.08), transparent 40%);
  pointer-events:none;
}

/* Win Modal */
#overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.95);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:2000;
  padding:16px;
  animation:fadeIn 0.3s ease;
}
#winResultBox{
  width:100%;
  max-width:400px;
  padding:24px;
  background:linear-gradient(135deg,#071018,#08121a);
  border-radius:18px;
  border:3px solid var(--accent);
  text-align:center;
  animation:slideUp 0.4s ease;
  box-shadow:0 20px 40px rgba(0,0,0,0.5);
}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes slideUp{from{transform:translateY(30px);opacity:0}to{transform:translateY(0);opacity:1}}
@keyframes winPulse{0%{transform:scale(.8);opacity:0}50%{transform:scale(1.06)}100%{transform:scale(1);opacity:1}}
#winResultBox img{
  width:160px;
  height:160px;
  border-radius:12px;
  margin:0 auto 16px;
  box-shadow:0 0 50px rgba(250,204,21,.3);
  object-fit:cover;
  border:2px solid rgba(250,204,21,0.3);
  animation:float 3s ease-in-out infinite;
}
@keyframes float{
  0%,100%{transform:translateY(0px);}
  50%{transform:translateY(-10px);}
}
#winResultBox .winTitle{
  font-size:22px;
  font-weight:800;
  color:var(--accent);
  margin-bottom:10px;
  line-height:1.2;
}
#winResultBox .winPrice{
  font-size:18px;
  color:#4ecdc4;
  margin-bottom:8px;
  font-weight:600;
}
#winResultBox .winNote{
  font-size:14px;
  color:#cbd5e1;
  margin-bottom:20px;
}

/* Inventory */
.item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:linear-gradient(135deg,#1a2233,#111827);
  border-radius:10px;
  padding:14px;
  margin:8px 0;
  border:1px solid rgba(255,255,255,0.05);
  transition:all 0.3s ease;
  position:relative;
  overflow:hidden;
}
.item::before{
  content:'';
  position:absolute;
  top:0;
  left:-100%;
  width:100%;
  height:100%;
  background:linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
  transition:left 0.7s ease;
}
.item:hover::before{
  left:100%;
}
.item.fade-out{
  animation:fadeOutItem 0.5s ease forwards;
}
@keyframes fadeOutItem{
  0%{opacity:1;transform:scale(1)}
  50%{opacity:0.5;transform:scale(0.95)}
  100%{opacity:0;transform:scale(0.9);height:0;margin:0;padding:0}
}
.weapon-img{
  width:60px;
  height:60px;
  border-radius:8px;
  object-fit:cover;
  box-shadow:0 4px 12px rgba(0,0,0,.5);
  background:#0b0f14;
  flex-shrink:0;
  border:1px solid rgba(255,255,255,0.1);
  transition:all 0.3s ease;
}
.item:hover .weapon-img{
  transform:rotate(5deg) scale(1.05);
  box-shadow:0 8px 20px rgba(0,0,0,0.7);
}

/* Chat */
.chatBox{
  width:100%;
  max-height:320px;
  background:#0b1220;
  border-radius:10px;
  padding:12px;
  overflow-y:auto;
  border:1px solid #16202a;
  -webkit-overflow-scrolling:touch;
}
.chatMessage{
  padding:10px;
  border-radius:8px;
  margin-bottom:10px;
  background:linear-gradient(135deg,#071018,#08121a);
  font-size:13px;
  line-height:1.4;
  border:1px solid rgba(255,255,255,0.05);
  transition:all 0.3s ease;
}
.chatMessage:hover{
  transform:translateX(5px);
  border-color:rgba(250,204,21,0.2);
}
.chatMessage .meta{
  font-size:11px;
  color:var(--muted);
  margin-bottom:6px;
  display:flex;
  justify-content:space-between;
}

/* Admin Panel */
#adminPanel{
  position:fixed;
  right:12px;
  top:100px;
  background:#0b1220;
  border:1px solid #1f2937;
  padding:16px;
  border-radius:12px;
  z-index:1000;
  min-width:280px;
  display:none;
  box-shadow:var(--shadow);
  backdrop-filter:blur(10px);
  animation:slideInRight 0.3s ease;
}
@keyframes slideInRight{
  from{transform:translateX(100%); opacity:0;}
  to{transform:translateX(0); opacity:1;}
}
#adminPanel h4{
  margin:0 0 10px 0;
  color:var(--accent);
  font-size:16px;
}
.adminRow{
  display:flex;
  gap:8px;
  align-items:center;
  margin-bottom:10px;
}
.adminRow input, .adminRow select{
  padding:8px;
  border-radius:6px;
  border:1px solid #2b3440;
  background:#071018;
  color:#fff;
  font-size:13px;
  flex:1;
  transition:all 0.3s ease;
}
.adminRow input:focus, .adminRow select:focus{
  outline:none;
  border-color:var(--accent);
  box-shadow:0 0 0 2px rgba(250,204,21,0.1);
}
.adminBtn{
  background:linear-gradient(135deg,#1a2233,#111827);
  border:1px solid #2b3440;
  color:#fff;
  padding:8px 12px;
  border-radius:8px;
  cursor:pointer;
  font-size:13px;
  transition:all 0.2s;
}
.adminBtn:active{
  transform:scale(0.95);
}

/* Bank Modal */
#bankOverlay{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.9);
  z-index:1500;
  align-items:center;
  justify-content:center;
  padding:16px;
  animation:fadeIn 0.3s ease;
}
#bankModal{
  background:#181d27;
  border-radius:14px;
  box-shadow:0 20px 40px rgba(0,0,0,0.5);
  padding:24px;
  max-width:400px;
  width:90%;
  border:2px solid rgba(250,204,21,0.2);
  animation:scaleUp 0.4s ease;
}
@keyframes scaleUp{
  from{transform:scale(0.9); opacity:0;}
  to{transform:scale(1); opacity:1;}
}
#amountInput{
  padding:10px;
  border-radius:8px;
  border:1px solid #2b3440;
  background:#0b1220;
  color:#fff;
  font-size:15px;
  text-align:center;
  width:100%;
  margin-bottom:14px;
  transition:all 0.3s ease;
}
#amountInput:focus{
  outline:none;
  border-color:var(--accent);
  box-shadow:0 0 0 2px rgba(250,204,21,0.1);
}

/* Upgrade Panel */
#upgradePanel{
  position:relative;
  background:linear-gradient(135deg,#071018,#0a1524);
  border-radius:14px;
  padding:18px;
  margin:14px 0;
  border:2px solid rgba(250,204,21,0.2);
  overflow:hidden;
  scroll-margin-top:80px;
}
#upgradePanel::before{
  content:'';
  position:absolute;
  top:0;
  left:0;
  right:0;
  height:4px;
  background:linear-gradient(90deg, #facc15, #eab308, #facc15);
  background-size:200% 100%;
  animation:shimmer 2s infinite linear;
}
@keyframes shimmer{
  0%{background-position:200% 0}
  100%{background-position:-200% 0}
}
.upgrade-wheel{
  width:100px;
  height:100px;
  border-radius:50%;
  border:3px solid var(--accent);
  position:relative;
  display:flex;
  align-items:center;
  justify-content:center;
  background:radial-gradient(circle,#111827,#020617);
  box-shadow:0 0 30px rgba(250,204,21,0.3);
  transition:transform 3s cubic-bezier(0.2,0.9,0.2,1);
}
.upgrade-wheel::before{
  content:'';
  position:absolute;
  width:110px;
  height:110px;
  border-radius:50%;
  background:conic-gradient(transparent, var(--accent), transparent);
  animation:spin 4s linear infinite;
  opacity:0.3;
}
@keyframes spin{
  100%{transform:rotate(360deg);}
}
.upgrade-wheel .inner{
  color:#e5e7eb;
  font-size:13px;
  text-align:center;
  position:relative;
  z-index:2;
  background:rgba(11,15,20,0.8);
  padding:8px;
  border-radius:6px;
}

/* Upgrade Animations */
@keyframes upgradeSuccess{
  0%{transform:scale(1);box-shadow:0 0 20px rgba(250,204,21,0.3)}
  50%{transform:scale(1.15);box-shadow:0 0 60px rgba(250,204,21,0.8)}
  100%{transform:scale(1);box-shadow:0 0 20px rgba(250,204,21,0.3)}
}
@keyframes upgradeFail{
  0%{transform:scale(1);filter:brightness(1)}
  25%{transform:scale(1.05);filter:brightness(1.2)}
  50%{transform:scale(0.95);filter:brightness(1.5)}
  75%{transform:scale(1.02);filter:brightness(1.8)}
  100%{transform:scale(1);filter:brightness(1)}
}
@keyframes itemBurn{
  0%{transform:scale(1);filter:brightness(1)}
  25%{transform:scale(1.1);filter:brightness(1.5)}
  50%{transform:scale(1);filter:brightness(2)}
  75%{transform:scale(0.9);filter:brightness(2.5)}
  100%{transform:scale(0);filter:brightness(3);opacity:0}
}
.upgrade-success{
  animation:upgradeSuccess 0.8s ease-in-out;
}
.upgrade-fail{
  animation:upgradeFail 0.8s ease-in-out;
}
.item-burn{
  animation:itemBurn 1s ease-in-out forwards;
}

/* Online & Chat Widgets */
.online-chat-container{
  position:sticky;
  top:100px;
  z-index:10;
}
.online-widget{
  background:linear-gradient(135deg,#071018,#08121a);
  border-radius:12px;
  padding:16px;
  margin-bottom:14px;
  border:1px solid rgba(255,255,255,0.05);
  position:relative;
  overflow:hidden;
}
.online-widget::before{
  content:'';
  position:absolute;
  top:0;
  left:0;
  right:0;
  height:3px;
  background:linear-gradient(90deg, var(--blue), var(--purple));
}
.online-count{
  font-size:32px;
  font-weight:800;
  color:var(--accent);
  margin:6px 0;
  text-shadow:0 0 10px rgba(250,204,21,0.3);
  transition:all 0.5s ease;
}

/* Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
.toast{
  position:fixed;
  top:16px;
  right:16px;
  padding:12px 16px;
  background:linear-gradient(135deg, #071018, #08121a);
  border-left:4px solid var(--accent);
  border-radius:6px;
  color:white;
  font-size:13px;
  box-shadow:0 4px 15px rgba(0,0,0,0.3);
  z-index:9999;
  transform:translateX(120%);
  transition:transform 0.3s ease;
  max-width:280px;
}
.toast.show{
  transform:translateX(0);
}
.toast.success{border-left-color:var(--green);}
.toast.error{border-left-color:var(--red);}
.toast.info{border-left-color:var(--blue);}
.toast.warning{border-left-color:var(--accent);}

/* –≠—Ñ—Ñ–µ–∫—Ç—ã —á–∞—Å—Ç–∏—Ü */
.particle{
  position:absolute;
  pointer-events:none;
  z-index:100;
  opacity:0;
}
@keyframes particleFly{
  0%{transform:translate(0,0) rotate(0deg); opacity:1;}
  100%{transform:translate(var(--tx), var(--ty)) rotate(360deg); opacity:0;}
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–∞ */
@keyframes balanceIncrease{
  0%{transform:scale(1);}
  50%{transform:scale(1.1);}
  100%{transform:scale(1);}
}
.balance-increase{
  animation:balanceIncrease 0.5s ease-in-out;
}

/* –ê–Ω–∏–º–∞—Ü–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –±–æ–Ω—É—Å–∞ */
@keyframes refBonus{
  0%{transform:translateY(0) scale(1); opacity:1;}
  100%{transform:translateY(-40px) scale(1.5); opacity:0;}
}
.ref-bonus{
  position:absolute;
  color:var(--accent);
  font-weight:bold;
  font-size:16px;
  pointer-events:none;
  z-index:100;
  animation:refBonus 1s ease-out forwards;
}

@media(min-width:481px){
  #topBar{
    flex-direction:row;
    align-items:center;
    padding:12px 16px;
  }
  #logo{
    text-align:left;
    width:auto;
    padding-bottom:0;
    border-bottom:none;
    flex:1;
  }
  .top-controls{
    width:auto;
    flex:2;
  }
  #balanceBox{
    flex:none;
  }
}
</style>
</head>
<body>

<!-- Top Bar - –ò–°–ü–†–ê–í–õ–ï–ù–û -->
<div id="topBar">
  <div id="logo">CASE HUNTERS</div>
  <div class="top-controls">
    <div id="balanceBox">–ë–∞–ª–∞–Ω—Å: <span id="balance">0</span> ‚ÇΩ</div>
    <div class="top-buttons">
      <button id="bankBtn" class="smallBtn" title="–ë–∞–Ω–∫">üíº –ë–∞–Ω–∫</button>
      <button id="soundToggle" title="–ó–≤—É–∫">üîä</button>
      <button id="adminToggle" class="smallBtn" title="–ê–¥–º–∏–Ω–∫–∞">Admin</button>
    </div>
  </div>
</div>

<!-- Daily Bonus Top -->
<div style="background:#111827;padding:10px 12px;text-align:center;border-bottom:1px solid #222">
  <button id="dailyBonusBtnTop" class="smallBtn">üéÅ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å +10 ‚ÇΩ</button>
</div>

<!-- Main Container -->
<div class="container">
  <div style="display:flex;flex-direction:column;gap:14px">
    <div>
      <!-- Cases Section -->
      <div class="section">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px">
          <div style="font-weight:bold;font-size:17px">–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–µ–π—Å—ã</div>
          <div style="font-size:11px;color:var(--muted)">–ù–∞–∂–º–∏—Ç–µ "–û—Ç–∫—Ä—ã—Ç—å" –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ä—É–ª–µ—Ç–∫–∏</div>
        </div>
        <div id="casesList"></div>
      </div>

      <!-- Inventory Section -->
      <div class="section">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px">
          <div style="font-weight:bold;font-size:17px">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</div>
          <div style="font-size:11px;color:var(--muted)">–í–∞—à–∏ –ø—Ä–µ–¥–º–µ—Ç—ã</div>
        </div>
        <div id="inventoryList" style="margin-top:10px"></div>
      </div>

      <!-- Upgrade Panel -->
      <div id="upgradePanel">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:14px;flex-wrap:wrap">
          <div style="display:flex;gap:10px;align-items:center;flex:1">
            <div id="upgradeSelectedPreview" style="width:60px;height:60px;border-radius:8px;background:#0b0f14;display:flex;align-items:center;justify-content:center;color:#cbd5e1;border:1px solid rgba(255,255,255,0.1)">‚Äî</div>
            <div style="flex:1">
              <div id="upgradeSelectedName" style="font-weight:bold;font-size:15px">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç –¥–ª—è –∞–ø–≥—Ä–µ–π–¥–∞</div>
              <div id="upgradeSelectedPrice" style="font-size:12px;color:var(--muted)">‚Äî</div>
            </div>
          </div>

          <div style="display:flex;gap:14px;align-items:center">
            <div class="upgrade-wheel" id="upgradeWheelSmall">
              <div style="position:absolute;top:5px;left:50%;transform:translateX(-50%);width:0;height:0;border-left:6px solid transparent;border-right:6px solid transparent;border-bottom:10px solid var(--accent);z-index:3"></div>
              <div class="inner" id="upgradeInnerSmall">–ê–ø–≥—Ä–µ–π–¥</div>
            </div>
            <div style="display:flex;flex-direction:column;gap:8px;align-items:flex-end">
              <div style="display:flex;gap:8px">
                <button id="upgrade2xBtn" class="smallBtn" style="background:linear-gradient(135deg,#3b82f6,#2563eb)">–ü–æ–ø—ã—Ç–∫–∞ 2x</button>
                <button id="upgrade3xBtn" class="smallBtn" style="background:linear-gradient(135deg,#8b5cf6,#7c3aed)">–ü–æ–ø—ã—Ç–∫–∞ 3x</button>
              </div>
              <div id="upgradeResultSmall" style="font-size:12px;color:var(--muted);min-width:180px;text-align:right"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Referral Section -->
      <div class="section">
        <div style="font-weight:bold;font-size:17px;margin-bottom:10px">–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞</div>
        <div style="font-size:12px;color:var(--muted);margin-bottom:6px">–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:</div>
        <div style="display:flex;gap:8px;margin-bottom:14px">
          <input id="myRefLink" style="flex:1;padding:10px;border-radius:8px;border:1px solid #2b3440;background:#071018;color:#fff;font-size:13px;" readonly>
          <button id="copyRefBtn" class="copy-btn" title="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É">
            <span id="copyText">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</span>
          </button>
        </div>
        
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px">
          <div style="font-size:13px">
            –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: <b id="refEarnings" style="color:var(--accent)">0</b> ‚ÇΩ
          </div>
          <button id="claimRefBtn" class="smallBtn" style="background:linear-gradient(135deg,var(--green),#0da271)">–ó–∞—á–∏—Å–ª–∏—Ç—å</button>
        </div>
        
        <div style="font-size:12px;color:var(--muted);margin-bottom:14px;padding:10px;background:rgba(250,204,21,0.1);border-radius:8px">
          <strong>üéØ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:</strong><br>
          ‚Ä¢ –ü—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π –ø–æ —Å–≤–æ–µ–π —Å—Å—ã–ª–∫–µ<br>
          ‚Ä¢ –ü–æ–ª—É—á–∞–π—Ç–µ <strong>30%</strong> –æ—Ç –∏—Ö –ø—Ä–æ–∏–≥—Ä—ã—à–µ–π<br>
          ‚Ä¢ –ù–∞—á–∏—Å–ª–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∫ –≤–∞—à–µ–º—É –±–∞–ª–∞–Ω—Å—É
        </div>
        
        <div style="display:flex;gap:8px;margin-top:16px">
          <button id="dailyBonusBtn" class="smallBtn" style="flex:1">üéÅ –ë–æ–Ω—É—Å 10 ‚ÇΩ</button>
          <button id="extraBonusBtn" class="smallBtn" style="flex:1">‚ú® +10 ‚ÇΩ</button>
        </div>
      </div>
    </div>

    <!-- Online & Chat -->
    <div class="online-chat-container">
      <!-- Online Widget -->
      <div class="online-widget">
        <div style="font-weight:bold;font-size:15px;margin-bottom:6px">–û–Ω–ª–∞–π–Ω</div>
        <div class="online-count" id="fakeOnline">0</div>
        <div style="font-size:12px;color:var(--muted);margin-top:4px">–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–µ–π—á–∞—Å</div>
      </div>

      <!-- Chat Box -->
      <div class="chatBox" id="chatBox"></div>
    </div>
  </div>
</div>

<!-- Admin Panel -->
<div id="adminPanel">
  <h4>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h4>
  <div class="adminRow">
    <input id="adminPass" placeholder="–ü–∞—Ä–æ–ª—å" type="password" />
    <button id="adminLogin" class="adminBtn">–í–æ–π—Ç–∏</button>
  </div>
  <div id="adminControls" style="display:none">
    <div class="adminRow">
      <input id="adminAddAmount" type="number" placeholder="–°—É–º–º–∞ +–±–∞–ª–∞–Ω—Å" />
      <button id="adminAddBtn" class="adminBtn">–î–æ–±–∞–≤–∏—Ç—å</button>
    </div>
    <div class="adminRow">
      <input id="adminSetRtp" type="number" step="0.01" placeholder="RTP (0.1-0.95)" />
      <button id="adminSetRtpBtn" class="adminBtn">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å RTP</button>
    </div>
    <div class="adminRow">
      <select id="adminForceCase" style="flex:1"></select>
      <select id="adminForceItem" style="flex:1"></select>
    </div>
    <div class="adminRow">
      <button id="adminForceWin" class="adminBtn" style="width:100%">–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à</button>
    </div>
    <div class="adminRow">
      <button id="adminClearRef" class="adminBtn" style="width:100%;background:linear-gradient(135deg,#ef4444,#dc2626)">–°–±—Ä–æ—Å–∏—Ç—å —Ä–µ—Ñ. –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è</button>
    </div>
    <div style="font-size:12px;color:var(--muted);margin-top:12px;text-align:center">–ü–∞—Ä–æ–ª—å: <b>!125125Cc</b></div>
  </div>
</div>

<!-- Bank Modal -->
<div id="bankOverlay">
  <div id="bankModal">
    <div style="font-weight:bold;font-size:20px;margin-bottom:12px;text-align:center">–ë–∞–Ω–∫ (–î–µ–º–æ)</div>
    <div style="margin-bottom:16px;color:var(--muted);text-align:center;font-size:14px">
      –í –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ –≤—ã–≤–æ–¥ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
    </div>
    
    <div style="display:flex;gap:10px;margin-bottom:20px;align-items:center">
      <input id="amountInput" type="number" min="100" step="50" value="500" />
    </div>
    
    <div style="display:flex;gap:10px;margin-bottom:20px">
      <button id="depositBtn" class="smallBtn" style="flex:1;background:linear-gradient(135deg,var(--green),#0da271);opacity:0.7">–ü–æ–ø–æ–ª–Ω–∏—Ç—å (–¥–µ–º–æ)</button>
      <button id="withdrawBtn" class="smallBtn" style="flex:1;background:linear-gradient(135deg,#3b82f6,#2563eb);opacity:0.7">–í—ã–≤–µ—Å—Ç–∏ (–¥–µ–º–æ)</button>
    </div>
    
    <div style="width:100%;border-top:1px solid rgba(255,255,255,0.1);padding-top:16px">
      <div style="text-align:center;color:var(--muted);font-size:13px">–í —Ä–µ–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏:<br>–ú–∏–Ω–∏–º—É–º: 100 ‚ÇΩ | –í—ã–≤–æ–¥: –æ—Ç 500 ‚ÇΩ</div>
    </div>
    
    <button id="closeBank" class="smallBtn" style="width:100%;margin-top:16px">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>

<!-- Win Overlay -->
<div id="overlay">
  <div id="modal">
    <div id="winResultBox">
      <img id="winImg" src="" alt="win">
      <div class="winTitle" id="winTitle">–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏</div>
      <div class="winPrice" id="winPrice">0 ‚ÇΩ</div>
      <div class="winNote" id="winNote">–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –ü—Ä–µ–¥–º–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å.</div>
      <div style="margin-top:24px"><button id="closeModal" class="smallBtn" style="min-width:120px">–ó–∞–∫—Ä—ã—Ç—å</button></div>
    </div>
  </div>
</div>

<!-- –ó–≤—É–∫–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã (—Å–∫—Ä—ã—Ç—ã–µ) -->
<audio id="soundOpenCase" preload="auto">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-slot-machine-coin-win-1998.mp3" type="audio/mpeg">
</audio>
<audio id="soundWin" preload="auto">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" type="audio/mpeg">
</audio>
<audio id="soundUpgradeSuccess" preload="auto">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-achievement-bell-600.mp3" type="audio/mpeg">
</audio>
<audio id="soundUpgradeFail" preload="auto">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-game-explosion-2759.mp3" type="audio/mpeg">
</audio>
<audio id="soundSell" preload="auto">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-cash-register-purchase-875.mp3" type="audio/mpeg">
</audio>
<audio id="soundClick" preload="auto">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-select-click-1109.mp3" type="audio/mpeg">
</audio>
<audio id="soundBonus" preload="auto">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" type="audio/mpeg">
</audio>
<audio id="soundRouletteSpin" preload="auto">
  <source src="https://assets.mixkit.co/sfx/preview/mixkit-casino-slot-machine-1998.mp3" type="audio/mpeg">
</audio>

<script>
// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è - –ò–°–ü–†–ê–í–õ–ï–ù–û RTP –Ω–∞ 40%
const CONFIG = {
  STORAGE_PREFIX: 'ch_',
  DEMO_PASSWORD: '!125125Cc',
  DEFAULT_RTP: 0.40, // –†–ï–ê–õ–¨–ù–û–ï RTP 40%
  IMAGE_BASE: 'https://via.placeholder.com/100x100/0b0f14/facc15?text=',
  SPIN_DURATION: 9000,
  CHAT_UPDATE_INTERVAL: 7000,
  REFERRAL_PERCENT: 0.30,
  MIN_WITHDRAWAL: 500,
  MIN_DEPOSIT: 100,
  BOT_USERNAME: 'casehunter_bot'
};

// –í—Å–µ –∫–µ–π—Å—ã —Å –°–ù–ò–ñ–ï–ù–ù–´–ú–ò –¶–ï–ù–ê–ú–ò –Ω–∞ –æ—Ä—É–∂–∏–µ (–ø—Ä–∏–º–µ—Ä–Ω–æ –Ω–∞ 30-40%)
const CASES = [
  {
    id: 'case1',
    name: '–ë–∞–∑–æ–≤—ã–π –ö–µ–π—Å',
    price: 50,
    baseItems: [
      { id: 's1', name: 'P250 | Sand Dune', price: 50, baseChance: 50, img: 'P250' },
      { id: 's2', name: 'USP-S | Torque', price: 80, baseChance: 30, img: 'USP-S' },
      { id: 's3', name: 'CZ75-Auto | Tigris', price: 120, baseChance: 15, img: 'CZ75' },
      { id: 's4', name: 'Nova | Ranger', price: 200, baseChance: 5, img: 'Nova' }
    ]
  },
  {
    id: 'case2',
    name: '–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ö–µ–π—Å',
    price: 100,
    baseItems: [
      { id: 'g1', name: 'AK-47 | Redline', price: 120, baseChance: 40, img: 'AK-47' },
      { id: 'g2', name: 'M4A1-S | Guardian', price: 160, baseChance: 35, img: 'M4A1-S' },
      { id: 'g3', name: 'P90 | Asiimov', price: 250, baseChance: 20, img: 'P90' },
      { id: 'g4', name: 'Desert Eagle | Blaze', price: 350, baseChance: 5, img: 'Deagle' }
    ]
  },
  {
    id: 'case3',
    name: '–ü—Ä–µ–º–∏—É–º –ö–µ–π—Å',
    price: 150,
    baseItems: [
      { id: 'p1', name: 'AWP | Asiimov', price: 200, baseChance: 35, img: 'AWP' },
      { id: 'p2', name: 'AK-47 | Vulcan', price: 300, baseChance: 30, img: 'AK-Vulcan' },
      { id: 'p3', name: 'M4A4 | Howl', price: 500, baseChance: 20, img: 'M4-Howl' },
      { id: 'p4', name: 'Glock-18 | Fade', price: 800, baseChance: 15, img: 'Glock-Fade' }
    ]
  },
  {
    id: 'case4',
    name: '–≠–ª–∏—Ç–Ω—ã–π –ö–µ–π—Å',
    price: 200,
    baseItems: [
      { id: 'e1', name: 'AWP | Dragon Lore', price: 300, baseChance: 30, img: 'AWP-Dragon' },
      { id: 'e2', name: 'AK-47 | Fire Serpent', price: 500, baseChance: 25, img: 'AK-Serpent' },
      { id: 'e3', name: 'M4A1-S | Hot Rod', price: 800, baseChance: 25, img: 'M4-HotRod' },
      { id: 'e4', name: 'Karambit | Fade', price: 1200, baseChance: 20, img: 'Karambit' }
    ]
  },
  {
    id: 'case5',
    name: '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –ö–µ–π—Å',
    price: 250,
    baseItems: [
      { id: 'l1', name: 'AWP | Medusa', price: 500, baseChance: 25, img: 'AWP-Medusa' },
      { id: 'l2', name: 'AK-47 | Fire Serpent ST', price: 900, baseChance: 25, img: 'AK-ST' },
      { id: 'l3', name: 'M4A4 | Howl ST', price: 1500, baseChance: 25, img: 'M4-Howl-ST' },
      { id: 'l4', name: 'Sport Gloves | Pandora', price: 2400, baseChance: 25, img: 'Gloves' }
    ]
  }
];

// –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
class CaseHuntersGame {
  constructor() {
    this.state = {
      balance: 0,
      inventory: [],
      currentRtp: CONFIG.DEFAULT_RTP,
      adminLogged: false,
      upgradeSelectedItem: null,
      soundEnabled: true
    };
    
    this.userId = this.getUserId();
    this.cases = this.prepareCases();
    this.audioElements = {};
    this.init();
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  init() {
    this.loadState();
    this.setupReferrer();
    this.initAudio();
    this.bindEvents();
    this.renderCases();
    this.renderInventory();
    this.updateUI();
    this.initChat();
    this.initOnlineCounter();
    this.populateAdminSelects();
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞—É–¥–∏–æ
  initAudio() {
    this.audioElements = {
      openCase: document.getElementById('soundOpenCase'),
      win: document.getElementById('soundWin'),
      upgradeSuccess: document.getElementById('soundUpgradeSuccess'),
      upgradeFail: document.getElementById('soundUpgradeFail'),
      sell: document.getElementById('soundSell'),
      click: document.getElementById('soundClick'),
      bonus: document.getElementById('soundBonus'),
      rouletteSpin: document.getElementById('soundRouletteSpin')
    };
    
    Object.values(this.audioElements).forEach(audio => {
      if (audio) audio.volume = 0.3;
    });
  }

  // –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–≤—É–∫–∞
  playSound(soundName) {
    if (!this.state.soundEnabled) return;
    
    const audio = this.audioElements[soundName];
    if (!audio) return;
    
    try {
      audio.currentTime = 0;
      audio.play().catch(e => console.log('Audio play failed:', e));
    } catch (error) {
      console.error('Error playing sound:', error);
    }
  }

  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∑–≤—É–∫–∞
  toggleSound() {
    this.state.soundEnabled = !this.state.soundEnabled;
    const soundBtn = document.getElementById('soundToggle');
    if (soundBtn) {
      soundBtn.textContent = this.state.soundEnabled ? 'üîä' : 'üîá';
      soundBtn.classList.toggle('muted', !this.state.soundEnabled);
    }
    
    if (this.state.soundEnabled) {
      this.playSound('click');
    }
    
    this.showToast(this.state.soundEnabled ? '–ó–≤—É–∫ –≤–∫–ª—é—á–µ–Ω' : '–ó–≤—É–∫ –≤—ã–∫–ª—é—á–µ–Ω', 'info');
    this.saveState();
  }

  // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
  showToast(message, type = 'info') {
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => {
      toast.classList.add('show');
    }, 10);
    
    setTimeout(() => {
      toast.classList.remove('show');
      setTimeout(() => {
        if (toast.parentNode) {
          document.body.removeChild(toast);
        }
      }, 300);
    }, 3000);
  }

  // –°–æ–∑–¥–∞–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∞ —á–∞—Å—Ç–∏—Ü
  createParticles(x, y, count = 10, color = '#facc15') {
    for (let i = 0; i < count; i++) {
      const particle = document.createElement('div');
      particle.className = 'particle';
      particle.style.cssText = `
        width: 4px;
        height: 4px;
        background: ${color};
        border-radius: 50%;
        left: ${x}px;
        top: ${y}px;
        --tx: ${(Math.random() - 0.5) * 200}px;
        --ty: ${(Math.random() - 0.5) * 200}px;
      `;
      
      document.body.appendChild(particle);
      
      particle.animate([
        { transform: 'translate(0, 0) rotate(0deg)', opacity: 1 },
        { transform: 'translate(var(--tx), var(--ty)) rotate(360deg)', opacity: 0 }
      ], {
        duration: 1000 + Math.random() * 500,
        easing: 'cubic-bezier(0.1, 0.7, 0.2, 1)'
      }).onfinish = () => {
        if (particle.parentNode) {
          document.body.removeChild(particle);
        }
      };
    }
  }

  // –ê–Ω–∏–º–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
  animateBalanceChange(amount) {
    const balanceBox = document.getElementById('balanceBox');
    if (balanceBox) {
      balanceBox.classList.add('balance-increase');
      setTimeout(() => {
        balanceBox.classList.remove('balance-increase');
      }, 500);
    }
    
    if (amount > 0) {
      const rect = balanceBox?.getBoundingClientRect();
      if (rect) {
        this.createParticles(
          rect.left + rect.width / 2,
          rect.top + rect.height / 2,
          15,
          '#facc15'
        );
      }
    }
  }

  // –ê–Ω–∏–º–∞—Ü–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–≥–æ –±–æ–Ω—É—Å–∞
  animateRefBonus(amount) {
    const refEarnings = document.getElementById('refEarnings');
    if (!refEarnings) return;
    
    const bonus = document.createElement('div');
    bonus.className = 'ref-bonus';
    bonus.textContent = `+${amount} ‚ÇΩ`;
    bonus.style.left = `${refEarnings.getBoundingClientRect().left}px`;
    bonus.style.top = `${refEarnings.getBoundingClientRect().top}px`;
    document.body.appendChild(bonus);
    
    setTimeout(() => {
      if (bonus.parentNode) {
        document.body.removeChild(bonus);
      }
    }, 1000);
  }

  // –ü–æ–ª—É—á–µ–Ω–∏–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  getUserId() {
    const key = CONFIG.STORAGE_PREFIX + 'userid';
    let id = localStorage.getItem(key);
    if (!id) {
      id = 'user_' + Date.now() + '_' + Math.random().toString(36).slice(2, 9);
      localStorage.setItem(key, id);
    }
    return id;
  }

  // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏
  getReferralLink() {
    return `https://t.me/${CONFIG.BOT_USERNAME}?start=${this.userId}`;
  }

  // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
  loadState() {
    try {
      const balanceKey = CONFIG.STORAGE_PREFIX + 'balance_' + this.userId;
      const balance = localStorage.getItem(balanceKey);
      this.state.balance = balance ? parseInt(balance) : 0;

      const inventoryKey = CONFIG.STORAGE_PREFIX + 'inventory_' + this.userId;
      const inventory = localStorage.getItem(inventoryKey);
      this.state.inventory = inventory ? JSON.parse(inventory) : [];
      
      const soundKey = CONFIG.STORAGE_PREFIX + 'sound_' + this.userId;
      const sound = localStorage.getItem(soundKey);
      this.state.soundEnabled = sound !== null ? sound === 'true' : true;
    } catch (error) {
      console.error('Error loading state:', error);
      this.state.balance = 0;
      this.state.inventory = [];
      this.state.soundEnabled = true;
    }
  }

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
  saveState() {
    try {
      const balanceKey = CONFIG.STORAGE_PREFIX + 'balance_' + this.userId;
      localStorage.setItem(balanceKey, this.state.balance.toString());

      const inventoryKey = CONFIG.STORAGE_PREFIX + 'inventory_' + this.userId;
      localStorage.setItem(inventoryKey, JSON.stringify(this.state.inventory));
      
      const soundKey = CONFIG.STORAGE_PREFIX + 'sound_' + this.userId;
      localStorage.setItem(soundKey, this.state.soundEnabled.toString());
    } catch (error) {
      console.error('Error saving state:', error);
    }
  }

  // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–µ–π—Å–æ–≤ —Å –†–ï–ê–õ–¨–ù–´–ú RTP 40%
  prepareCases() {
    return CASES.map(c => ({
      ...c,
      items: c.baseItems.map(it => ({ 
        ...it, 
        chance: this.calculateRealChance(it, c.baseItems, CONFIG.DEFAULT_RTP),
        img: this.getImageUrl(it.img || it.name)
      })),
      baseTotalChance: c.baseItems.reduce((s, i) => s + i.baseChance, 0)
    }));
  }

  // –†–∞—Å—á–µ—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö —à–∞–Ω—Å–æ–≤ —Å RTP 40%
  calculateRealChance(item, allItems, targetRtp) {
    const totalPrice = allItems.reduce((sum, i) => sum + i.price, 0);
    const avgPrice = totalPrice / allItems.length;
    const itemValueRatio = item.price / avgPrice;
    
    // –§–æ—Ä–º—É–ª–∞ –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —à–∞–Ω—Å–æ–≤ —Å —É—á–µ—Ç–æ–º RTP 40%
    // –ë–æ–ª–µ–µ –¥–µ—à–µ–≤—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã –∏–º–µ—é—Ç –±–æ–ª—å—à–∏–π —à–∞–Ω—Å
    const baseChance = (1 / itemValueRatio) * 100;
    
    // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –ø–æ–¥ —Ü–µ–ª–µ–≤–æ–π RTP
    const adjustedChance = baseChance * (targetRtp / 0.5); // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º
    
    return Math.max(adjustedChance, 1); // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —à–∞–Ω—Å 1%
  }

  // –ü–æ–ª—É—á–µ–Ω–∏–µ URL –∫–∞—Ä—Ç–∏–Ω–∫–∏
  getImageUrl(name) {
    const encodedName = encodeURIComponent(name.substring(0, 20));
    return `${CONFIG.IMAGE_BASE}${encodedName}`;
  }

  // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª–∞
  setupReferrer() {
    try {
      const urlParams = new URLSearchParams(window.location.search);
      const referrer = urlParams.get('ref') || urlParams.get('start');
      
      if (referrer && referrer !== this.userId) {
        const referrerKey = CONFIG.STORAGE_PREFIX + 'referrer_' + this.userId;
        localStorage.setItem(referrerKey, referrer);
      }
    } catch (error) {
      console.error('Error setting up referrer:', error);
    }
  }

  // –ü—Ä–∏–≤—è–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π
  bindEvents() {
    // –ë–∞–Ω–∫
    document.getElementById('bankBtn')?.addEventListener('click', () => {
      this.playSound('click');
      this.showBankModal();
    });
    document.getElementById('closeBank')?.addEventListener('click', () => {
      this.playSound('click');
      this.hideBankModal();
    });
    document.getElementById('depositBtn')?.addEventListener('click', () => {
      this.playSound('click');
      this.deposit();
    });
    document.getElementById('withdrawBtn')?.addEventListener('click', () => {
      this.playSound('click');
      this.withdraw();
    });

    // –ê–¥–º–∏–Ω–∫–∞
    document.getElementById('adminToggle')?.addEventListener('click', () => {
      this.playSound('click');
      this.toggleAdminPanel();
    });
    document.getElementById('adminLogin')?.addEventListener('click', () => {
      this.playSound('click');
      this.adminLogin();
    });
    document.getElementById('adminAddBtn')?.addEventListener('click', () => {
      this.playSound('click');
      this.adminAddBalance();
    });
    document.getElementById('adminSetRtpBtn')?.addEventListener('click', () => {
      this.playSound('click');
      this.adminSetRtp();
    });
    document.getElementById('adminForceWin')?.addEventListener('click', () => {
      this.playSound('click');
      this.adminForceWin();
    });
    document.getElementById('adminClearRef')?.addEventListener('click', () => {
      this.playSound('click');
      this.adminClearRef();
    });

    // –ë–æ–Ω—É—Å—ã
    document.getElementById('dailyBonusBtn')?.addEventListener('click', () => {
      this.playSound('click');
      this.claimBonus('daily');
    });
    document.getElementById('dailyBonusBtnTop')?.addEventListener('click', () => {
      this.playSound('click');
      this.claimBonus('daily');
    });
    document.getElementById('extraBonusBtn')?.addEventListener('click', () => {
      this.playSound('click');
      this.claimBonus('extra');
    });
    document.getElementById('claimRefBtn')?.addEventListener('click', () => {
      this.playSound('click');
      this.claimReferralEarnings();
    });

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–æ–∫
    document.getElementById('closeModal')?.addEventListener('click', () => {
      this.playSound('click');
      document.getElementById('overlay').style.display = 'none';
    });

    // –ê–ø–≥—Ä–µ–π–¥
    document.getElementById('upgrade2xBtn')?.addEventListener('click', () => {
      this.playSound('click');
      this.performUpgrade(2);
    });
    document.getElementById('upgrade3xBtn')?.addEventListener('click', () => {
      this.playSound('click');
      this.performUpgrade(3);
    });

    // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏
    document.getElementById('copyRefBtn')?.addEventListener('click', () => {
      this.playSound('click');
      this.copyReferralLink();
    });

    // –ó–≤—É–∫
    document.getElementById('soundToggle')?.addEventListener('click', () => {
      this.toggleSound();
    });

    // –ö–ª–∏–∫–∏ –ø–æ –≤—Å–µ–º –∫–Ω–æ–ø–∫–∞–º
    document.addEventListener('click', (e) => {
      if (e.target.tagName === 'BUTTON' || e.target.closest('button')) {
        this.playSound('click');
      }
    }, true);
  }

  // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏
  copyReferralLink() {
    const refLink = document.getElementById('myRefLink');
    const copyBtn = document.getElementById('copyRefBtn');
    const copyText = document.getElementById('copyText');
    
    if (!refLink || !copyBtn || !copyText) return;
    
    refLink.select();
    refLink.setSelectionRange(0, 99999);
    
    try {
      navigator.clipboard.writeText(refLink.value).then(() => {
        copyBtn.classList.add('copied');
        copyText.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
        
        setTimeout(() => {
          copyBtn.classList.remove('copied');
          copyText.textContent = '–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å';
        }, 2000);
        
        this.showToast('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', 'success');
        this.createParticles(
          copyBtn.getBoundingClientRect().left + copyBtn.offsetWidth / 2,
          copyBtn.getBoundingClientRect().top + copyBtn.offsetHeight / 2,
          8,
          '#3b82f6'
        );
      }).catch(err => {
        document.execCommand('copy');
        copyBtn.classList.add('copied');
        copyText.textContent = '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
        
        setTimeout(() => {
          copyBtn.classList.remove('copied');
          copyText.textContent = '–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å';
        }, 2000);
        
        this.showToast('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!', 'success');
      });
    } catch (error) {
      console.error('Error copying text:', error);
      this.showToast('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è', 'error');
    }
  }

  // –ü–æ–∫–∞–∑–∞—Ç—å –±–∞–Ω–∫ –º–æ–¥–∞–ª–∫—É
  showBankModal() {
    document.getElementById('bankOverlay').style.display = 'flex';
  }

  // –°–∫—Ä—ã—Ç—å –±–∞–Ω–∫ –º–æ–¥–∞–ª–∫—É
  hideBankModal() {
    document.getElementById('bankOverlay').style.display = 'none';
  }

  // –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
  deposit() {
    const amountInput = document.getElementById('amountInput');
    const amount = parseInt(amountInput?.value) || 0;
    
    if (amount < CONFIG.MIN_DEPOSIT) {
      this.showToast(`–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è ${CONFIG.MIN_DEPOSIT} ‚ÇΩ`, 'error');
      return;
    }

    this.addBalance(amount);
    this.hideBankModal();
    this.showToast(`–î–µ–º–æ: –ü–æ–ø–æ–ª–Ω–µ–Ω–æ ${amount} ‚ÇΩ`, 'success');
    this.pushFakeChat(`${this.getRandomName()} –ø–æ–ø–æ–ª–Ω–∏–ª –±–∞–ª–∞–Ω—Å –Ω–∞ ${amount} ‚ÇΩ`);
  }

  // –í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤
  withdraw() {
    const amountInput = document.getElementById('amountInput');
    const amount = parseInt(amountInput?.value) || 0;
    
    if (amount < CONFIG.MIN_WITHDRAWAL) {
      this.showToast(`–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤—ã–≤–æ–¥–∞ ${CONFIG.MIN_WITHDRAWAL} ‚ÇΩ`, 'error');
      return;
    }

    if (!this.state.adminLogged && this.state.balance < amount) {
      this.showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –≤—ã–≤–æ–¥–∞', 'error');
      return;
    }

    if (!this.state.adminLogged) {
      this.subBalance(amount);
    }

    this.hideBankModal();
    this.showToast(`–î–µ–º–æ: –í—ã–≤–µ–¥–µ–Ω–æ ${amount} ‚ÇΩ`, 'success');
    this.pushFakeChat(`${this.getRandomName()} –≤—ã–≤–µ–ª ${amount} ‚ÇΩ`);
  }

  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏
  toggleAdminPanel() {
    const panel = document.getElementById('adminPanel');
    panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
  }

  // –í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∫—É
  adminLogin() {
    const password = document.getElementById('adminPass')?.value || '';
    
    if (password === CONFIG.DEMO_PASSWORD) {
      this.state.adminLogged = true;
      document.getElementById('adminControls').style.display = 'block';
      this.updateBalanceUI();
      this.showToast('–ê–¥–º–∏–Ω: –≤—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω. –ë–∞–ª–∞–Ω—Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ ‚Äî –±–µ–∑–≥—Ä–∞–Ω–∏—á–Ω—ã–π.', 'success');
    } else {
      this.showToast('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å.', 'error');
    }
  }

  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É
  adminAddBalance() {
    if (!this.state.adminLogged) {
      this.showToast('–¢—Ä–µ–±—É–µ—Ç—Å—è –≤—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∫—É', 'error');
      return;
    }

    const amountInput = document.getElementById('adminAddAmount');
    const amount = parseInt(amountInput?.value) || 0;
    
    if (amount <= 0) {
      this.showToast('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É > 0', 'error');
      return;
    }

    this.addBalance(amount);
    this.showToast(`–ê–¥–º–∏–Ω: –¥–æ–±–∞–≤–ª–µ–Ω–æ ${amount} ‚ÇΩ`, 'success');
  }

  // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ RTP
  adminSetRtp() {
    if (!this.state.adminLogged) {
      this.showToast('–¢—Ä–µ–±—É–µ—Ç—Å—è –≤—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∫—É', 'error');
      return;
    }

    const rtpInput = document.getElementById('adminSetRtp');
    const rtp = parseFloat(rtpInput?.value);
    
    if (!rtp || rtp < 0.1 || rtp > 0.95) {
      this.showToast('RTP –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 0.10‚Äì0.95', 'error');
      return;
    }

    this.state.currentRtp = rtp;
    this.applyHiddenRtp(rtp);
    this.showToast(`–ê–¥–º–∏–Ω: RTP —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω ${rtp}`, 'success');
  }

  // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à
  adminForceWin() {
    if (!this.state.adminLogged) {
      this.showToast('–¢—Ä–µ–±—É–µ—Ç—Å—è –≤—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∫—É', 'error');
      return;
    }

    const caseSelect = document.getElementById('adminForceCase');
    const itemSelect = document.getElementById('adminForceItem');
    
    if (!caseSelect || !itemSelect) return;

    const caseId = caseSelect.value;
    const itemId = itemSelect.value;
    
    const caseItem = this.cases.find(c => c.id === caseId);
    if (!caseItem) {
      this.showToast('–ö–µ–π—Å –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
      return;
    }

    const item = caseItem.items.find(it => it.id === itemId);
    if (!item) {
      this.showToast('–ü—Ä–µ–¥–º–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
      return;
    }

    const inventoryItem = {
      uid: 'item_' + Date.now() + '_' + Math.random().toString(36).slice(2),
      id: item.id,
      name: item.name,
      price: item.price,
      img: item.img,
      upgraded: null
    };

    this.state.inventory.push(inventoryItem);
    this.saveState();
    this.renderInventory();
    this.showFullScreenWin(inventoryItem);
    this.pushFakeChat(`–ê–¥–º–∏–Ω –≤—ã–¥–∞–ª: ${item.name}`);
    this.showToast(`–í—ã–¥–∞–Ω –ø—Ä–µ–¥–º–µ—Ç: ${item.name}`, 'success');
  }

  // –°–±—Ä–æ—Å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π
  adminClearRef() {
    if (!this.state.adminLogged) {
      this.showToast('–¢—Ä–µ–±—É–µ—Ç—Å—è –≤—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∫—É', 'error');
      return;
    }

    Object.keys(localStorage).forEach(key => {
      if (key.includes(CONFIG.STORAGE_PREFIX + 'refearn_')) {
        localStorage.removeItem(key);
      }
    });

    this.updateUI();
    this.showToast('–†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è —Å–±—Ä–æ—à–µ–Ω—ã.', 'success');
  }

  // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–æ–≤ –≤ –∞–¥–º–∏–Ω–∫–µ
  populateAdminSelects() {
    const caseSelect = document.getElementById('adminForceCase');
    const itemSelect = document.getElementById('adminForceItem');
    
    if (!caseSelect || !itemSelect) return;

    caseSelect.innerHTML = '';
    itemSelect.innerHTML = '';

    this.cases.forEach(caseItem => {
      const option = document.createElement('option');
      option.value = caseItem.id;
      option.textContent = caseItem.name;
      caseSelect.appendChild(option);
    });

    if (this.cases.length > 0) {
      this.updateAdminItems(this.cases[0].id);
    }

    caseSelect.addEventListener('change', (e) => {
      this.updateAdminItems(e.target.value);
    });
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –≤ –∞–¥–º–∏–Ω–∫–µ
  updateAdminItems(caseId) {
    const itemSelect = document.getElementById('adminForceItem');
    if (!itemSelect) return;

    itemSelect.innerHTML = '';
    
    const caseItem = this.cases.find(c => c.id === caseId);
    if (!caseItem) return;

    caseItem.items.forEach(item => {
      const option = document.createElement('option');
      option.value = item.id;
      option.textContent = item.name;
      itemSelect.appendChild(option);
    });
  }

  // –ü–æ–ª—É—á–µ–Ω–∏–µ –±–æ–Ω—É—Å–∞
  claimBonus(type) {
    const today = new Date().toISOString().split('T')[0];
    const storageKey = type === 'daily' 
      ? CONFIG.STORAGE_PREFIX + 'lastBonus_' + this.userId
      : CONFIG.STORAGE_PREFIX + 'lastExtraBonus_' + this.userId;

    const lastClaim = localStorage.getItem(storageKey);
    const amount = 10;

    if (lastClaim === today) {
      this.showToast('–ë–æ–Ω—É—Å —É–∂–µ –ø–æ–ª—É—á–µ–Ω —Å–µ–≥–æ–¥–Ω—è', 'warning');
      return;
    }

    this.playSound('bonus');
    this.addBalance(amount);
    localStorage.setItem(storageKey, today);
    
    const message = type === 'daily' 
      ? `–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å ${amount} ‚ÇΩ –∑–∞—á–∏—Å–ª–µ–Ω`
      : `–ë–æ–Ω—É—Å —Å–≤–µ—Ä—Ö—É +${amount} ‚ÇΩ –∑–∞—á–∏—Å–ª–µ–Ω`;
    
    this.showToast(message, 'success');
    this.createParticles(
      document.getElementById('balanceBox').getBoundingClientRect().left + 50,
      document.getElementById('balanceBox').getBoundingClientRect().top + 25,
      12,
      '#facc15'
    );
  }

  // –ó–∞—á–∏—Å–ª–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤
  claimReferralEarnings() {
    const earnings = this.getReferralEarnings();
    
    if (earnings <= 0) {
      this.showToast('–ù–µ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –∑–∞—á–∏—Å–ª–µ–Ω–∏—è', 'warning');
      return;
    }

    this.playSound('bonus');
    this.addBalance(earnings);
    this.clearReferralEarnings();
    this.showToast(`–ó–∞—á–∏—Å–ª–µ–Ω–æ ${earnings} ‚ÇΩ –Ω–∞ –±–∞–ª–∞–Ω—Å`, 'success');
    this.animateRefBonus(earnings);
  }

  // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –¥–æ—Ö–æ–¥–æ–≤
  getReferralEarnings() {
    try {
      const key = CONFIG.STORAGE_PREFIX + 'refearn_' + this.userId;
      return parseInt(localStorage.getItem(key) || '0');
    } catch {
      return 0;
    }
  }

  // –û—á–∏—Å—Ç–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –¥–æ—Ö–æ–¥–æ–≤
  clearReferralEarnings() {
    try {
      const key = CONFIG.STORAGE_PREFIX + 'refearn_' + this.userId;
      localStorage.setItem(key, '0');
      this.updateUI();
    } catch (error) {
      console.error('Error clearing referral earnings:', error);
    }
  }

  // –†–µ–Ω–¥–µ—Ä –∫–µ–π—Å–æ–≤
  renderCases() {
    const container = document.getElementById('casesList');
    if (!container) return;

    container.innerHTML = '';

    this.cases.forEach(caseItem => {
      const caseElement = document.createElement('div');
      caseElement.className = 'case';
      caseElement.dataset.id = caseItem.id;

      caseElement.innerHTML = `
        <div class="left">
          <div class="case-badge">
            <div>–ö–ï–ô–°</div>
          </div>
          <div class="meta">
            <div class="title">${caseItem.name}</div>
            <div class="sub">–¶–µ–Ω–∞: ${caseItem.price} ‚ÇΩ</div>
          </div>
        </div>
        <div class="right">
          <div style="font-size:12px;color:var(--muted);margin-bottom:6px">–ü—Ä–µ–¥–º–µ—Ç–æ–≤: ${caseItem.items.length}</div>
          <button class="openBtn" data-open="${caseItem.id}">–û—Ç–∫—Ä—ã—Ç—å</button>
        </div>
      `;

      const rouletteWrap = document.createElement('div');
      rouletteWrap.className = 'roulette';
      rouletteWrap.style.marginTop = '12px';
      rouletteWrap.style.display = 'none';
      
      const track = document.createElement('div');
      track.className = 'track';
      track.dataset.case = caseItem.id;
      
      const centerLine = document.createElement('div');
      centerLine.className = 'roulette-center-line';
      
      const glow = document.createElement('div');
      glow.className = 'roulette-glow';
      
      rouletteWrap.appendChild(track);
      rouletteWrap.appendChild(centerLine);
      rouletteWrap.appendChild(glow);
      
      caseElement.appendChild(rouletteWrap);
      container.appendChild(caseElement);

      this.prepareRouletteForCase(caseItem, track);

      const openBtn = caseElement.querySelector(`[data-open="${caseItem.id}"]`);
      if (openBtn) {
        openBtn.addEventListener('click', (ev) => {
          ev.stopPropagation();
          this.playSound('click');
          this.showCaseRoulette(caseItem.id);
          this.openCaseWithDynamicSpin(caseItem.id, track);
        });
      }

      caseElement.addEventListener('click', (e) => {
        if (e.target !== openBtn && !e.target.closest('.openBtn')) {
          this.playSound('click');
          this.toggleCaseRoulette(caseItem.id);
        }
      });
    });
  }

  // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä—É–ª–µ—Ç–∫–∏ –¥–ª—è –∫–µ–π—Å–∞ - –ë–ï–°–ö–û–ù–ï–ß–ù–ê–Ø
  prepareRouletteForCase(caseItem, trackEl) {
    if (!trackEl) return;

    trackEl.innerHTML = '';

    // –°–æ–∑–¥–∞–µ–º –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–ª—è –ø–ª–∞–≤–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
    const itemsToShow = 30; // –£–º–µ–Ω—å—à–µ–Ω–æ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
    
    for (let i = 0; i < itemsToShow; i++) {
      caseItem.items.forEach(item => {
        const el = document.createElement('div');
        el.className = 'roulette-item';
        el.dataset.itemId = item.id;

        const img = document.createElement('img');
        img.className = 'weapon-img';
        img.src = item.img;
        img.alt = item.name;
        img.onerror = () => {
          img.src = this.createImagePlaceholder(item.name);
        };

        el.appendChild(img);
        
        const nameDiv = document.createElement('div');
        nameDiv.textContent = item.name;
        nameDiv.style.fontSize = '12px';
        nameDiv.style.marginTop = '4px';
        
        const priceDiv = document.createElement('div');
        priceDiv.textContent = item.price + ' ‚ÇΩ';
        priceDiv.style.fontSize = '11px';
        priceDiv.style.color = 'var(--muted)';
        
        el.appendChild(nameDiv);
        el.appendChild(priceDiv);
        
        trackEl.appendChild(el);
      });
    }
  }

  // –°–æ–∑–¥–∞–Ω–∏–µ placeholder –¥–ª—è –∫–∞—Ä—Ç–∏–Ω–∫–∏
  createImagePlaceholder(text) {
    const canvas = document.createElement('canvas');
    canvas.width = 100;
    canvas.height = 100;
    const ctx = canvas.getContext('2d');
    
    ctx.fillStyle = '#0b0f14';
    ctx.fillRect(0, 0, 100, 100);
    
    ctx.fillStyle = '#facc15';
    ctx.globalAlpha = 0.12;
    ctx.fillRect(12, 12, 76, 76);
    ctx.globalAlpha = 1;
    
    ctx.fillStyle = '#e6eef6';
    ctx.font = 'bold 10px Arial';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    
    const words = text.split(' ');
    let lines = [];
    let currentLine = words[0];
    
    for (let i = 1; i < words.length; i++) {
      const testLine = currentLine + ' ' + words[i];
      if (ctx.measureText(testLine).width < 80) {
        currentLine = testLine;
      } else {
        lines.push(currentLine);
        currentLine = words[i];
      }
    }
    lines.push(currentLine);
    
    const startY = 50 - ((lines.length - 1) * 7);
    lines.forEach((line, index) => {
      ctx.fillText(line, 50, startY + (index * 14));
    });
    
    return canvas.toDataURL();
  }

  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä—É–ª–µ—Ç–∫–∏ –∫–µ–π—Å–∞
  toggleCaseRoulette(caseId) {
    const caseEl = document.querySelector(`.case[data-id="${caseId}"]`);
    if (!caseEl) return;
    
    const roulette = caseEl.querySelector('.roulette');
    if (!roulette) return;
    
    document.querySelectorAll('.case .roulette').forEach(r => {
      if (r !== roulette) r.style.display = 'none';
    });
    
    roulette.style.display = roulette.style.display === 'none' ? 'block' : 'none';
  }

  // –ü–æ–∫–∞–∑–∞—Ç—å —Ä—É–ª–µ—Ç–∫—É –∫–µ–π—Å–∞
  showCaseRoulette(caseId) {
    const caseEl = document.querySelector(`.case[data-id="${caseId}"]`);
    if (!caseEl) return;
    
    const roulette = caseEl.querySelector('.roulette');
    if (!roulette) return;
    
    document.querySelectorAll('.case .roulette').forEach(r => {
      if (r !== roulette) r.style.display = 'none';
    });
    
    roulette.style.display = 'block';
  }

  // –û—Ç–∫—Ä—ã—Ç–∏–µ –∫–µ–π—Å–∞ —Å –¥–∏–Ω–∞–º–∏—á–Ω–æ–π –∞–Ω–∏–º–∞—Ü–∏–µ–π
  async openCaseWithDynamicSpin(caseId, trackEl) {
    const caseItem = this.cases.find(c => c.id === caseId);
    if (!caseItem) return;
    
    const cost = caseItem.price;
    
    if (!this.state.adminLogged && this.state.balance < cost) {
      this.showToast(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤. –ù—É–∂–Ω–æ ${cost} ‚ÇΩ`, 'error');
      return;
    }
    
    if (!this.state.adminLogged) {
      this.subBalance(cost);
    }
    
    const openBtn = document.querySelector(`[data-open="${caseId}"]`);
    if (openBtn) {
      openBtn.disabled = true;
      openBtn.textContent = '–û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è...';
    }
    
    const winItem = this.pickRandomItem(caseItem.items);
    
    // –ó–≤—É–∫ –≤—Ä–∞—â–µ–Ω–∏—è —Ä—É–ª–µ—Ç–∫–∏
    this.playSound('rouletteSpin');
    
    // –î–∏–Ω–∞–º–∏—á–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è —Å –±—ã—Å—Ç—Ä—ã–º —Å—Ç–∞—Ä—Ç–æ–º –∏ –ø–ª–∞–≤–Ω—ã–º –∑–∞–º–µ–¥–ª–µ–Ω–∏–µ–º
    await this.animateRouletteWithDynamicSpeed(caseId, winItem, trackEl);
    
    const inventoryItem = {
      uid: 'item_' + Date.now() + '_' + Math.random().toString(36).slice(2),
      id: winItem.id,
      name: winItem.name,
      price: winItem.price,
      img: winItem.img,
      upgraded: null
    };
    
    this.state.inventory.push(inventoryItem);
    this.saveState();
    
    this.creditReferrerIfApplicable(cost, winItem.price);
    
    // –ó–≤—É–∫ –≤—ã–∏–≥—Ä—ã—à–∞
    this.playSound('win');
    this.playSound('openCase');
    
    this.showFullScreenWin(inventoryItem);
    this.renderInventory();
    this.updateUI();
    
    this.pushFakeChat(`${this.getRandomName()} –æ—Ç–∫—Ä—ã–ª ${caseItem.name} –∏ –ø–æ–ª—É—á–∏–ª ${winItem.name}`);
    
    // –≠—Ñ—Ñ–µ–∫—Ç —á–∞—Å—Ç–∏—Ü –ø—Ä–∏ –≤—ã–∏–≥—Ä—ã—à–µ
    const caseRect = document.querySelector(`.case[data-id="${caseId}"]`)?.getBoundingClientRect();
    if (caseRect) {
      this.createParticles(
        caseRect.left + caseRect.width / 2,
        caseRect.top + caseRect.height / 2,
        20,
        '#facc15'
      );
    }
    
    if (openBtn) {
      openBtn.disabled = false;
      openBtn.textContent = '–û—Ç–∫—Ä—ã—Ç—å';
    }
    
    this.showToast(`–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏: ${winItem.name} (${winItem.price} ‚ÇΩ)`, 'success');
  }

  // –ê–Ω–∏–º–∞—Ü–∏—è —Ä—É–ª–µ—Ç–∫–∏ —Å –¥–∏–Ω–∞–º–∏—á–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç—å—é - –ò–°–ü–†–ê–í–õ–ï–ù–û: –ø—Ä–µ–¥–º–µ—Ç—ã –Ω–µ –ø—Ä–æ–ø–∞–¥–∞—é—Ç
  animateRouletteWithDynamicSpeed(caseId, winItem, trackEl) {
    return new Promise((resolve) => {
      if (!trackEl) {
        resolve();
        return;
      }
      
      const items = Array.from(trackEl.children);
      if (items.length === 0) {
        resolve();
        return;
      }
      
      let targetIndex = -1;
      for (let i = 0; i < items.length; i++) {
        if (items[i].dataset.itemId === winItem.id) {
          targetIndex = i;
          break;
        }
      }
      
      if (targetIndex === -1) {
        targetIndex = Math.floor(items.length / 2);
      }
      
      const itemWidth = items[0].offsetWidth || 120;
      const container = trackEl.parentElement;
      const containerWidth = container.clientWidth;
      
      const centerOffset = Math.floor(containerWidth / 2);
      
      // –í—ã—á–∏—Å–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é —Ç–∞–∫, —á—Ç–æ–±—ã –≤—ã–∏–≥—Ä–∞–Ω–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è –≤ —Ü–µ–Ω—Ç—Ä–µ
      let targetPosition = 0;
      for (let i = 0; i < targetIndex; i++) {
        targetPosition += (items[i].offsetWidth || itemWidth);
      }
      targetPosition += (items[targetIndex].offsetWidth || itemWidth) / 2;
      
      const trackWidth = items.reduce((sum, item) => sum + (item.offsetWidth || itemWidth), 0);
      
      // –í—ã—á–∏—Å–ª—è–µ–º –∫–æ–Ω–µ—á–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ
      const finalTranslate = centerOffset - targetPosition;
      
      // –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ (–¥–∞–ª–µ–∫–æ —Å–ª–µ–≤–∞)
      const startTranslate = trackWidth * 2;
      
      // 1. –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢ - –ø–µ—Ä–≤—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
      trackEl.style.transition = 'transform 2s cubic-bezier(0.1, 0.8, 0.2, 1)';
      trackEl.style.transform = `translateX(${startTranslate}px)`;
      
      setTimeout(() => {
        // 2. –°–†–ï–î–ù–Ø–Ø –°–ö–û–†–û–°–¢–¨ - —Å–ª–µ–¥—É—é—â–∏–µ 4 —Å–µ–∫—É–Ω–¥—ã
        trackEl.style.transition = 'transform 4s cubic-bezier(0.2, 0.7, 0.3, 1)';
        const midTranslate = finalTranslate * 0.3;
        trackEl.style.transform = `translateX(${midTranslate}px)`;
        
        setTimeout(() => {
          // 3. –ú–ï–î–õ–ï–ù–ù–û–ï –ó–ê–ú–ï–î–õ–ï–ù–ò–ï - –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 —Å–µ–∫—É–Ω–¥—ã
          trackEl.style.transition = 'transform 3s cubic-bezier(0.3, 0.1, 0.2, 1)';
          trackEl.style.transform = `translateX(${finalTranslate}px)`;
          
          setTimeout(() => {
            items.forEach(item => item.classList.remove('active'));
            
            const winningElements = items.filter(item => item.dataset.itemId === winItem.id);
            if (winningElements.length > 0) {
              let closestToCenter = winningElements[0];
              let minDistance = Infinity;
              
              winningElements.forEach(el => {
                const rect = el.getBoundingClientRect();
                const center = container.getBoundingClientRect().left + containerWidth / 2;
                const distance = Math.abs(rect.left + rect.width / 2 - center);
                
                if (distance < minDistance) {
                  minDistance = distance;
                  closestToCenter = el;
                }
              });
              
              closestToCenter.classList.add('active');
              
              // –≠—Ñ—Ñ–µ–∫—Ç —á–∞—Å—Ç–∏—Ü –Ω–∞ –≤—ã–∏–≥—Ä–∞–Ω–Ω–æ–º –ø—Ä–µ–¥–º–µ—Ç–µ
              const rect = closestToCenter.getBoundingClientRect();
              this.createParticles(
                rect.left + rect.width / 2,
                rect.top + rect.height / 2,
                15,
                '#facc15'
              );
            }
            
            trackEl.style.transition = '';
            resolve();
          }, 2900);
        }, 3800);
      }, 1900);
    });
  }

  // –í—ã–±–æ—Ä —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞ —Å —É—á–µ—Ç–æ–º —Ä–µ–∞–ª—å–Ω—ã—Ö —à–∞–Ω—Å–æ–≤
  pickRandomItem(items) {
    const totalChance = items.reduce((sum, item) => sum + (item.chance || 1), 0);
    let random = Math.random() * totalChance;
    
    for (const item of items) {
      random -= (item.chance || 1);
      if (random <= 0) {
        return { ...item };
      }
    }
    
    return { ...items[items.length - 1] };
  }

  // –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—É
  creditReferrerIfApplicable(cost, winPrice) {
    try {
      const refKey = CONFIG.STORAGE_PREFIX + 'referrer_' + this.userId;
      const referrerId = localStorage.getItem(refKey);
      
      if (!referrerId) return;
      
      const loss = Math.max(0, cost - winPrice);
      if (loss <= 0) return;
      
      const reward = Math.round(loss * CONFIG.REFERRAL_PERCENT);
      
      const refEarnKey = CONFIG.STORAGE_PREFIX + 'refearn_' + referrerId;
      const currentEarnings = parseInt(localStorage.getItem(refEarnKey) || '0');
      localStorage.setItem(refEarnKey, (currentEarnings + reward).toString());
      
      const refBalanceKey = CONFIG.STORAGE_PREFIX + 'balance_' + referrerId;
      const refBalance = parseInt(localStorage.getItem(refBalanceKey) || '0');
      localStorage.setItem(refBalanceKey, (refBalance + reward).toString());
      
    } catch (error) {
      console.error('Error crediting referrer:', error);
    }
  }

  // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–∏–≥—Ä—ã—à –≤ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ
  showFullScreenWin(item) {
    const winImg = document.getElementById('winImg');
    const winTitle = document.getElementById('winTitle');
    const winPrice = document.getElementById('winPrice');
    const winNote = document.getElementById('winNote');
    
    winImg.src = item.img;
    winImg.onerror = () => {
      winImg.src = this.createImagePlaceholder(item.name);
    };
    
    winTitle.textContent = item.name;
    winPrice.textContent = `${item.price} ‚ÇΩ`;
    winNote.textContent = '–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –ü—Ä–µ–¥–º–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å.';
    
    document.getElementById('winResultBox').style.display = 'block';
    document.getElementById('overlay').style.display = 'flex';
    
    // –≠—Ñ—Ñ–µ–∫—Ç —á–∞—Å—Ç–∏—Ü –≤ –º–æ–¥–∞–ª–∫–µ
    const modalRect = document.getElementById('winResultBox').getBoundingClientRect();
    this.createParticles(
      modalRect.left + modalRect.width / 2,
      modalRect.top + 100,
      25,
      '#facc15'
    );
  }

  // –†–µ–Ω–¥–µ—Ä –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
  renderInventory() {
    const container = document.getElementById('inventoryList');
    if (!container) return;
    
    if (this.state.inventory.length === 0) {
      container.innerHTML = '<div style="text-align:center;color:var(--muted);padding:20px">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç</div>';
      return;
    }
    
    container.innerHTML = '';
    
    [...this.state.inventory].reverse().forEach(item => {
      const itemElement = document.createElement('div');
      itemElement.className = 'item';
      itemElement.dataset.uid = item.uid;
      
      itemElement.innerHTML = `
        <div class="left">
          <img src="${item.img}" alt="${item.name}" class="weapon-img" 
               onerror="this.src='${this.createImagePlaceholder(item.name)}'">
          <div class="meta">
            <div class="title">${item.name}${item.upgraded ? ` ‚Ä¢ ${item.upgraded.multiplier}x` : ''}</div>
            <div class="sub">${item.price} ‚ÇΩ</div>
          </div>
        </div>
        <div>
          <button class="smallBtn" data-sell="${item.uid}" style="margin-bottom:8px">–ü—Ä–æ–¥–∞—Ç—å</button>
          <button class="smallBtn" data-upgrade="${item.uid}">–ê–ø–≥—Ä–µ–π–¥</button>
        </div>
      `;
      
      container.appendChild(itemElement);
      
      const sellBtn = itemElement.querySelector(`[data-sell="${item.uid}"]`);
      const upgradeBtn = itemElement.querySelector(`[data-upgrade="${item.uid}"]`);
      
      if (sellBtn) {
        sellBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          if (confirm(`–ü—Ä–æ–¥–∞—Ç—å "${item.name}" –∑–∞ ${item.price} ‚ÇΩ?`)) {
            this.sellItem(item.uid);
          }
        });
      }
      
      if (upgradeBtn) {
        upgradeBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          this.openUpgradePanelForItem(item);
        });
      }
    });
  }

  // –ü—Ä–æ–¥–∞–∂–∞ –ø—Ä–µ–¥–º–µ—Ç–∞
  sellItem(itemUid) {
    const itemIndex = this.state.inventory.findIndex(item => item.uid === itemUid);
    if (itemIndex === -1) return;
    
    const item = this.state.inventory[itemIndex];
    
    this.playSound('sell');
    this.addBalance(item.price);
    this.state.inventory.splice(itemIndex, 1);
    
    this.saveState();
    this.renderInventory();
    this.showToast(`–ü—Ä–µ–¥–º–µ—Ç "${item.name}" –ø—Ä–æ–¥–∞–Ω –∑–∞ ${item.price} ‚ÇΩ`, 'success');
    this.pushFakeChat(`${this.getRandomName()} –ø—Ä–æ–¥–∞–ª ${item.name} –∑–∞ ${item.price} ‚ÇΩ`);
    
    // –≠—Ñ—Ñ–µ–∫—Ç —á–∞—Å—Ç–∏—Ü –ø—Ä–∏ –ø—Ä–æ–¥–∞–∂–µ
    const itemElement = document.querySelector(`.item[data-uid="${itemUid}"]`);
    if (itemElement) {
      const rect = itemElement.getBoundingClientRect();
      this.createParticles(
        rect.left + rect.width / 2,
        rect.top + rect.height / 2,
        10,
        '#10b981'
      );
    }
  }

  // –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–∞–Ω–µ–ª–∏ –∞–ø–≥—Ä–µ–π–¥–∞
  openUpgradePanelForItem(item) {
    this.state.upgradeSelectedItem = item;
    
    const preview = document.getElementById('upgradeSelectedPreview');
    if (preview) {
      preview.innerHTML = '';
      const img = document.createElement('img');
      img.style.width = '60px';
      img.style.height = '60px';
      img.style.borderRadius = '8px';
      img.style.objectFit = 'cover';
      img.src = item.img;
      img.onerror = () => {
        img.src = this.createImagePlaceholder(item.name);
      };
      preview.appendChild(img);
    }
    
    document.getElementById('upgradeSelectedName').textContent = item.name;
    document.getElementById('upgradeSelectedPrice').textContent = `${item.price} ‚ÇΩ`;
    document.getElementById('upgradeResultSmall').textContent = '';
    document.getElementById('upgradeInnerSmall').textContent = '–ê–ø–≥—Ä–µ–π–¥';
    
    const upgradePanel = document.getElementById('upgradePanel');
    upgradePanel.scrollIntoView({ 
      behavior: 'smooth', 
      block: 'center' 
    });
    
    upgradePanel.style.boxShadow = '0 0 30px rgba(250, 204, 21, 0.3)';
    setTimeout(() => {
      upgradePanel.style.boxShadow = '';
    }, 1500);
  }

  // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∞–ø–≥—Ä–µ–π–¥–∞
  performUpgrade(multiplier) {
    if (!this.state.upgradeSelectedItem) {
      document.getElementById('upgradeResultSmall').textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç';
      return;
    }
    
    const item = this.state.upgradeSelectedItem;
    const cost = multiplier === 2 
      ? Math.max(30, Math.round(item.price * 0.15))
      : Math.max(60, Math.round(item.price * 0.25));
    
    if (!this.state.adminLogged && this.state.balance < cost) {
      document.getElementById('upgradeResultSmall').textContent = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤';
      return;
    }
    
    if (!this.state.adminLogged) {
      this.subBalance(cost);
    }
    
    document.getElementById('upgradeResultSmall').textContent = 'üîÑ –ó–∞–ø—É—Å–∫–∞–µ–º –∞–ø–≥—Ä–µ–π–¥...';
    document.getElementById('upgrade2xBtn').disabled = true;
    document.getElementById('upgrade3xBtn').disabled = true;
    
    const probability = multiplier === 2 ? 0.60 : 0.35;
    const success = Math.random() < probability;
    
    const wheel = document.getElementById('upgradeWheelSmall');
    const baseSpins = 4 + Math.floor(Math.random() * 4);
    let finalAngle;
    
    if (success) {
      finalAngle = 360 * baseSpins + (Math.random() * 50 + 5);
    } else {
      finalAngle = 360 * baseSpins + (Math.random() * 180 + 120);
    }
    
    if (wheel) {
      wheel.style.transition = 'transform 3s cubic-bezier(.2,.9,.2,1)';
      wheel.style.transform = `rotate(${finalAngle}deg)`;
    }
    
    setTimeout(() => {
      if (wheel) {
        wheel.style.transition = '';
        wheel.style.transform = `rotate(${finalAngle % 360}deg)`;
        
        if (success) {
          wheel.classList.add('upgrade-success');
          this.playSound('upgradeSuccess');
        } else {
          wheel.classList.add('upgrade-fail');
          this.playSound('upgradeFail');
        }
        
        setTimeout(() => {
          wheel.classList.remove('upgrade-success', 'upgrade-fail');
        }, 800);
      }
      
      if (success) {
        item.price = Math.round(item.price * multiplier);
        item.upgraded = item.upgraded || { times: 0, multiplier: 1 };
        item.upgraded.times += 1;
        item.upgraded.multiplier *= multiplier;
        
        document.getElementById('upgradeResultSmall').textContent = 
          `üéâ –£—Å–ø–µ—Ö! –ü—Ä–µ–¥–º–µ—Ç —É–º–Ω–æ–∂–µ–Ω –Ω–∞ ${multiplier}x. –ù–æ–≤–∞—è —Ü–µ–Ω–∞: ${item.price} ‚ÇΩ`;
        document.getElementById('upgradeSelectedPrice').textContent = `${item.price} ‚ÇΩ`;
        
        this.showToast(`–ê–ø–≥—Ä–µ–π–¥ —É—Å–ø–µ—à–µ–Ω! –ù–æ–≤–∞—è —Ü–µ–Ω–∞: ${item.price} ‚ÇΩ`, 'success');
        this.pushFakeChat(`${this.getRandomName()} —É—Å–ø–µ—à–Ω–æ –∞–ø–≥—Ä–µ–π–¥–Ω—É–ª ${item.name} –¥–æ ${item.price} ‚ÇΩ`);
        
        // –≠—Ñ—Ñ–µ–∫—Ç —á–∞—Å—Ç–∏—Ü –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –∞–ø–≥—Ä–µ–π–¥–µ
        const upgradePanel = document.getElementById('upgradePanel');
        const rect = upgradePanel.getBoundingClientRect();
        this.createParticles(
          rect.left + rect.width / 2,
          rect.top + rect.height / 2,
          20,
          '#10b981'
        );
      } else {
        const itemElement = document.querySelector(`.item[data-uid="${item.uid}"]`);
        if (itemElement) {
          itemElement.classList.add('item-burn');
        }
        
        document.getElementById('upgradeResultSmall').textContent = 
          'üí• –ù–µ—É–¥–∞—á–∞! –ü—Ä–µ–¥–º–µ—Ç —Å–≥–æ—Ä–µ–ª.';
        document.getElementById('upgradeSelectedPreview').innerHTML = 'üí•';
        document.getElementById('upgradeSelectedName').textContent = '–ü—Ä–µ–¥–º–µ—Ç —Å–≥–æ—Ä–µ–ª';
        document.getElementById('upgradeSelectedPrice').textContent = '‚Äî';
        
        this.showToast('–ê–ø–≥—Ä–µ–π–¥ –Ω–µ—É–¥–∞—á–µ–Ω: –ø—Ä–µ–¥–º–µ—Ç —Å–≥–æ—Ä–µ–ª', 'error');
        this.pushFakeChat(`${this.getRandomName()} –Ω–µ—É–¥–∞—á–Ω–æ –∞–ø–≥—Ä–µ–π–¥–Ω—É–ª ${item.name} - –ø—Ä–µ–¥–º–µ—Ç —Å–≥–æ—Ä–µ–ª`);
        
        // –≠—Ñ—Ñ–µ–∫—Ç —á–∞—Å—Ç–∏—Ü –ø—Ä–∏ —Å–≥–æ—Ä–∞–Ω–∏–∏
        const upgradePanel = document.getElementById('upgradePanel');
        const rect = upgradePanel.getBoundingClientRect();
        this.createParticles(
          rect.left + rect.width / 2,
          rect.top + rect.height / 2,
          15,
          '#ef4444'
        );
        
        setTimeout(() => {
          const itemIndex = this.state.inventory.findIndex(invItem => invItem.uid === item.uid);
          if (itemIndex !== -1) {
            this.state.inventory.splice(itemIndex, 1);
            this.saveState();
            this.renderInventory();
          }
          this.state.upgradeSelectedItem = null;
        }, 1000);
      }
      
      this.saveState();
      this.renderInventory();
      this.updateUI();
      
      document.getElementById('upgrade2xBtn').disabled = false;
      document.getElementById('upgrade3xBtn').disabled = false;
      
    }, 3100);
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
  updateUI() {
    const balanceElement = document.getElementById('balance');
    if (balanceElement) {
      balanceElement.textContent = this.state.adminLogged ? '‚àû' : this.state.balance;
    }
    
    const refEarningsElement = document.getElementById('refEarnings');
    if (refEarningsElement) {
      refEarningsElement.textContent = this.getReferralEarnings();
    }
    
    const refLinkElement = document.getElementById('myRefLink');
    if (refLinkElement) {
      refLinkElement.value = this.getReferralLink();
    }
    
    const soundBtn = document.getElementById('soundToggle');
    if (soundBtn) {
      soundBtn.textContent = this.state.soundEnabled ? 'üîä' : 'üîá';
      soundBtn.classList.toggle('muted', !this.state.soundEnabled);
    }
  }

  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
  addBalance(amount) {
    if (this.state.adminLogged) {
      this.updateUI();
      return;
    }
    
    this.state.balance += Math.round(amount);
    this.saveState();
    this.updateUI();
    this.animateBalanceChange(amount);
  }

  // –°–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
  subBalance(amount) {
    if (this.state.adminLogged) {
      this.updateUI();
      return;
    }
    
    this.state.balance = Math.max(0, this.state.balance - Math.round(amount));
    this.saveState();
    this.updateUI();
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –≤ UI
  updateBalanceUI() {
    const balanceElement = document.getElementById('balance');
    if (!balanceElement) return;
    
    if (this.state.adminLogged) {
      balanceElement.textContent = '‚àû';
      balanceElement.parentElement.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
    } else {
      balanceElement.textContent = this.state.balance;
      balanceElement.parentElement.style.background = 'linear-gradient(135deg, #facc15, #eab308)';
    }
  }

  // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ RTP
  applyHiddenRtp(targetRtp) {
    this.cases.forEach(c => {
      const items = c.items;
      const avgPrice = items.reduce((s, i) => s + i.price, 0) / items.length;
      const baseChances = items.map(i => i.baseChance || 1);
      const factor = Math.max(0.10, targetRtp);
      
      const newChances = items.map((it, idx) => {
        const rel = it.price / avgPrice;
        const val = baseChances[idx] * (1 / (1 + (rel - 1) * (1.4 - factor)));
        return Math.max(val, 0.01);
      });
      
      items.forEach((it, idx) => {
        it.chance = newChances[idx];
      });
    });
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–∞—Ç–∞
  initChat() {
    const initialMessages = [
      '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Case Hunters! üéÆ',
      '–û—Ç–∫—Ä—ã–≤–∞–π—Ç–µ –∫–µ–π—Å—ã –∏ –≤—ã–∏–≥—Ä—ã–≤–∞–π—Ç–µ –∫—Ä—É—Ç—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã! üí∞',
      '–ü—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π –∏ –ø–æ–ª—É—á–∞–π—Ç–µ 30% –æ—Ç –∏—Ö –ø—Ä–æ–∏–≥—Ä—ã—à–µ–π! üë•',
      '–ê–ø–≥—Ä–µ–π–¥ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ —Å —Ä–∏—Å–∫–æ–º —Å–≥–æ—Ä–∞–Ω–∏—è - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ—é —É–¥–∞—á—É! ‚ö°'
    ];
    
    initialMessages.forEach((msg, i) => {
      setTimeout(() => {
        this.pushFakeChat(msg, '–°–∏—Å—Ç–µ–º–∞');
      }, 1000 * i);
    });
    
    setInterval(() => {
      const messages = [
        'P250 | Sand Dune',
        'AK-47 | Redline',
        'AWP | Asiimov',
        'Glock-18 | Fade',
        'M4A4 | Howl',
        'Sport Gloves | Pandora\'s Box'
      ];
      
      const randomItem = messages[Math.floor(Math.random() * messages.length)];
      this.pushFakeChat(
        `${this.getRandomName()} –æ—Ç–∫—Ä—ã–ª –∫–µ–π—Å –∏ –ø–æ–ª—É—á–∏–ª ${randomItem}`,
        this.getRandomName()
      );
    }, 12000);
    
    setInterval(() => {
      const amount = 500 + Math.floor(Math.random() * 1000);
      this.pushFakeChat(
        `${this.getRandomName()} –≤—ã–≤–µ–ª ${amount} ‚ÇΩ`,
        this.getRandomName()
      );
    }, 18000);
    
    setInterval(() => {
      const messages = [
        '—É—Å–ø–µ—à–Ω–æ –∞–ø–≥—Ä–µ–π–¥–Ω—É–ª –ø—Ä–µ–¥–º–µ—Ç –¥–æ 2x! üéâ',
        '–ø–æ–ø—ã—Ç–∞–ª—Å—è –∞–ø–≥—Ä–µ–π–¥–Ω—É—Ç—å –ø—Ä–µ–¥–º–µ—Ç –∏ –æ–Ω —Å–≥–æ—Ä–µ–ª üí•',
        '–ø—Ä–æ–¥–∞–ª –ø—Ä–µ–¥–º–µ—Ç –∏ –∑–∞—Ä–∞–±–æ—Ç–∞–ª –∫—Ä—É—Ç—ã–µ –¥–µ–Ω—å–≥–∏ üí∞',
        '–ø—Ä–∏–≥–ª–∞—Å–∏–ª –¥—Ä—É–≥–∞ –∏ –ø–æ–ª—É—á–∏–ª —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –±–æ–Ω—É—Å üë•'
      ];
      
      const randomMessage = messages[Math.floor(Math.random() * messages.length)];
      this.pushFakeChat(
        `${this.getRandomName()} ${randomMessage}`,
        this.getRandomName()
      );
    }, 15000);
  }

  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
  pushFakeChat(text, user = null) {
    const chatBox = document.getElementById('chatBox');
    if (!chatBox) return;
    
    const messageElement = document.createElement('div');
    messageElement.className = 'chatMessage';
    
    const userName = user || this.getRandomName();
    const time = new Date().toLocaleTimeString([], { 
      hour: '2-digit', 
      minute: '2-digit' 
    });
    
    messageElement.innerHTML = `
      <div class="meta">
        <span>${userName}</span>
        <span>${time}</span>
      </div>
      <div>${text}</div>
    `;
    
    chatBox.appendChild(messageElement);
    
    chatBox.scrollTop = chatBox.scrollHeight;
    
    if (chatBox.children.length > 50) {
      chatBox.removeChild(chatBox.children[0]);
    }
  }

  // –°–ª—É—á–∞–π–Ω–æ–µ –∏–º—è –¥–ª—è —á–∞—Ç–∞
  getRandomName() {
    const names = [
      '–ò–≤–∞–Ω_92', 'Anna_Pro', 'GamerMax', 'Oleg_CS', 'Vlad99',
      'Katya', 'Pro_Player', 'Rus_Bot', 'Sniper', 'Hunter',
      'CaseMaster', 'Lucky_Shot', 'TradeKing', 'SkinGod', 'RoulettePro'
    ];
    return names[Math.floor(Math.random() * names.length)];
  }

  // –°—á–µ—Ç—á–∏–∫ –æ–Ω–ª–∞–π–Ω
  initOnlineCounter() {
    let onlineCount = 120 + Math.floor(Math.random() * 80);
    
    const updateOnline = () => {
      onlineCount += Math.floor(Math.random() * 7) - 3;
      onlineCount = Math.max(50, Math.min(350, onlineCount));
      
      const onlineElement = document.getElementById('fakeOnline');
      if (onlineElement) {
        onlineElement.textContent = onlineCount;
      }
    };
    
    updateOnline();
    setInterval(updateOnline, 5000);
  }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
let app;

document.addEventListener('DOMContentLoaded', () => {
  try {
    app = new CaseHuntersGame();
    
    window.CaseHunters = app;
    
    console.log('Case Hunters —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!');
    
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:', error);
    
    const errorDiv = document.createElement('div');
    errorDiv.style.position = 'fixed';
    errorDiv.style.top = '50%';
    errorDiv.style.left = '50%';
    errorDiv.style.transform = 'translate(-50%, -50%)';
    errorDiv.style.background = '#ef4444';
    errorDiv.style.color = 'white';
    errorDiv.style.padding = '20px';
    errorDiv.style.borderRadius = '10px';
    errorDiv.style.zIndex = '9999';
    errorDiv.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.';
    
    document.body.appendChild(errorDiv);
  }
});
</script>
</body>
</html>