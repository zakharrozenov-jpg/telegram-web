<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<title>Case Hunters ‚Äî Demo</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet">
<style>
/* –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π CSS –¥–ª—è Telegram Web */
:root{
  --bg:#0b0f14;
  --card:#111827;
  --accent:#facc15;
  --muted:#9ca3af;
  --green:#10b981;
  --red:#ef4444;
  --blue:#3b82f6;
  --yellow-line:#facc15;
  --glow: rgba(250,204,21,0.18);
  --shadow: 0 4px 20px rgba(0,0,0,.6);
}
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;
  background:var(--bg);
  color:#fff;
  -webkit-tap-highlight-color:transparent;
  -webkit-font-smoothing:antialiased;
  overflow-x:hidden;
}

/* Top Bar */
#topBar{
  position:sticky;
  top:0;
  left:0;
  right:0;
  background:#020617;
  padding:12px 16px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  box-shadow:var(--shadow);
  z-index:1000;
  backdrop-filter:blur(10px);
}
#logo{
  font-family:'Russo One',sans-serif;
  font-size:20px;
  color:var(--accent);
  letter-spacing:0.5px;
}
#balanceBox{
  padding:8px 14px;
  border-radius:12px;
  background:linear-gradient(135deg,var(--accent),#eab308);
  color:#020617;
  font-weight:700;
  font-size:15px;
  box-shadow:0 0 12px rgba(250,204,21,.5);
  white-space:nowrap;
}

/* Container */
.container{
  max-width:100%;
  margin:0 auto;
  padding:16px 12px 160px;
}
.section{
  background:var(--card);
  border-radius:14px;
  padding:18px;
  margin:12px 0;
  border:1px solid rgba(255,255,255,0.05);
  box-shadow:0 4px 12px rgba(0,0,0,.3);
}

/* Case Cards */
.case{
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:linear-gradient(135deg,#1a2233,#111827);
  border-radius:12px;
  padding:16px;
  margin:10px 0;
  cursor:pointer;
  border:1px solid rgba(255,255,255,0.05);
  transition:all 0.3s ease;
  touch-action:manipulation;
}
.case:active{
  transform:scale(0.98);
}
.case:hover{
  border-color:rgba(250,204,21,0.3);
  box-shadow:0 0 20px rgba(250,204,21,0.1);
}
.case .left{
  display:flex;
  gap:14px;
  align-items:center;
  flex:1;
}
.case-badge{
  width:70px;
  height:70px;
  border-radius:12px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:linear-gradient(135deg,#facc15,#eab308);
  color:#000;
  font-weight:900;
  font-family:'Russo One',sans-serif;
  box-shadow:0 6px 20px var(--glow);
  font-size:14px;
  letter-spacing:1px;
  flex-shrink:0;
}
.case .meta{
  flex:1;
}
.case .meta .title{
  font-weight:bold;
  font-size:16px;
  margin-bottom:4px;
}
.case .meta .sub{
  font-size:13px;
  color:var(--muted);
}
.case .right{
  display:flex;
  flex-direction:column;
  align-items:flex-end;
  gap:8px;
}

/* Buttons */
.smallBtn{
  background:linear-gradient(135deg,#1a2233,#111827);
  border:1px solid rgba(255,255,255,0.1);
  color:#fff;
  padding:10px 16px;
  border-radius:10px;
  cursor:pointer;
  font-size:14px;
  font-weight:500;
  transition:all 0.2s;
  touch-action:manipulation;
  user-select:none;
  min-width:80px;
}
.smallBtn:active{
  transform:scale(0.95);
}
.openBtn{
  background:linear-gradient(135deg,var(--green),#0da271);
  border:none;
  padding:12px 20px;
  border-radius:12px;
  color:#fff;
  font-weight:600;
  font-size:14px;
  cursor:pointer;
  min-width:100px;
  transition:all 0.2s;
  touch-action:manipulation;
  box-shadow:0 4px 12px rgba(16,185,129,0.3);
}
.openBtn:active{
  transform:scale(0.95);
}
.openBtn:disabled{
  opacity:0.5;
  cursor:not-allowed;
  transform:none;
}

/* Roulette */
.roulette{
  width:100%;
  overflow:hidden;
  position:relative;
  border-radius:14px;
  height:140px;
  margin:12px 0;
  background:#071018;
  border:2px solid rgba(250,204,21,0.1);
  -webkit-overflow-scrolling:touch;
}
.track{
  display:flex;
  height:100%;
  will-change:transform;
  transform:translate3d(0,0,0);
}
.roulette-item{
  width:140px;
  flex-shrink:0;
  text-align:center;
  padding:12px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
}
.roulette-item img{
  width:100px;
  height:100px;
  display:block;
  margin:0 auto 8px;
  border-radius:12px;
  box-shadow:0 6px 20px rgba(0,0,0,.7);
  object-fit:cover;
  background:#0b0f14;
}
.roulette-center-line{
  position:absolute;
  left:50%;
  top:0;
  transform:translateX(-50%);
  width:4px;
  height:100%;
  background:linear-gradient(180deg,var(--yellow-line),rgba(250,204,21,0.6));
  box-shadow:0 0 25px rgba(250,204,21,0.4);
  pointer-events:none;
  z-index:10;
}
.roulette-glow{
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  width:240px;
  height:240px;
  border-radius:50%;
  background:radial-gradient(circle, rgba(250,204,21,0.08), transparent 40%);
  pointer-events:none;
}

/* Win Modal */
#overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.95);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:2000;
  padding:20px;
  animation:fadeIn 0.3s ease;
}
#winResultBox{
  width:100%;
  max-width:450px;
  padding:30px;
  background:linear-gradient(135deg,#071018,#08121a);
  border-radius:20px;
  border:3px solid var(--accent);
  text-align:center;
  animation:slideUp 0.4s ease;
  box-shadow:0 20px 40px rgba(0,0,0,0.5);
}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes slideUp{from{transform:translateY(30px);opacity:0}to{transform:translateY(0);opacity:1}}
@keyframes winPulse{0%{transform:scale(.8);opacity:0}50%{transform:scale(1.06)}100%{transform:scale(1);opacity:1}}
#winResultBox img{
  width:200px;
  height:200px;
  border-radius:14px;
  margin:0 auto 20px;
  box-shadow:0 0 50px rgba(250,204,21,.3);
  object-fit:cover;
  border:2px solid rgba(250,204,21,0.3);
}
#winResultBox .winTitle{
  font-size:26px;
  font-weight:800;
  color:var(--accent);
  margin-bottom:12px;
  line-height:1.2;
}
#winResultBox .winPrice{
  font-size:22px;
  color:#4ecdc4;
  margin-bottom:10px;
  font-weight:600;
}
#winResultBox .winNote{
  font-size:15px;
  color:#cbd5e1;
  margin-bottom:24px;
}

/* Inventory */
.item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:linear-gradient(135deg,#1a2233,#111827);
  border-radius:12px;
  padding:16px;
  margin:10px 0;
  border:1px solid rgba(255,255,255,0.05);
}
.weapon-img{
  width:70px;
  height:70px;
  border-radius:10px;
  object-fit:cover;
  box-shadow:0 4px 12px rgba(0,0,0,.5);
  background:#0b0f14;
  flex-shrink:0;
  border:1px solid rgba(255,255,255,0.1);
}

/* Chat */
.chatBox{
  width:100%;
  max-height:360px;
  background:#0b1220;
  border-radius:12px;
  padding:14px;
  overflow-y:auto;
  border:1px solid #16202a;
  -webkit-overflow-scrolling:touch;
}
.chatMessage{
  padding:12px;
  border-radius:10px;
  margin-bottom:12px;
  background:linear-gradient(135deg,#071018,#08121a);
  font-size:14px;
  line-height:1.4;
  border:1px solid rgba(255,255,255,0.05);
}
.chatMessage .meta{
  font-size:12px;
  color:var(--muted);
  margin-bottom:6px;
  display:flex;
  justify-content:space-between;
}

/* Admin Panel */
#adminPanel{
  position:fixed;
  right:16px;
  top:100px;
  background:#0b1220;
  border:1px solid #1f2937;
  padding:18px;
  border-radius:14px;
  z-index:1000;
  min-width:300px;
  display:none;
  box-shadow:var(--shadow);
  backdrop-filter:blur(10px);
}
#adminPanel h4{
  margin:0 0 12px 0;
  color:var(--accent);
  font-size:18px;
}
.adminRow{
  display:flex;
  gap:10px;
  align-items:center;
  margin-bottom:12px;
}
.adminRow input, .adminRow select{
  padding:10px;
  border-radius:8px;
  border:1px solid #2b3440;
  background:#071018;
  color:#fff;
  font-size:14px;
  flex:1;
}
.adminBtn{
  background:linear-gradient(135deg,#1a2233,#111827);
  border:1px solid #2b3440;
  color:#fff;
  padding:10px 16px;
  border-radius:10px;
  cursor:pointer;
  font-size:14px;
  transition:all 0.2s;
}
.adminBtn:active{
  transform:scale(0.95);
}

/* Bank Modal */
#bankOverlay{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.9);
  z-index:1500;
  align-items:center;
  justify-content:center;
  padding:20px;
}
#bankModal{
  background:#181d27;
  border-radius:16px;
  box-shadow:0 20px 40px rgba(0,0,0,0.5);
  padding:28px;
  max-width:450px;
  width:90%;
  border:2px solid rgba(250,204,21,0.2);
}
#amountInput{
  padding:12px;
  border-radius:10px;
  border:1px solid #2b3440;
  background:#0b1220;
  color:#fff;
  font-size:16px;
  text-align:center;
  width:100%;
  margin-bottom:16px;
}

/* Upgrade Panel */
#upgradePanel{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  background:#071018;
  border-top:4px solid var(--yellow-line);
  padding:20px;
  z-index:100;
  display:none;
}
.upgrade-wheel{
  width:120px;
  height:120px;
  border-radius:50%;
  border:4px solid var(--accent);
  position:relative;
  display:flex;
  align-items:center;
  justify-content:center;
  background:radial-gradient(circle,#111827,#020617);
  box-shadow:0 0 20px rgba(250,204,21,0.25);
  transition:transform 2s cubic-bezier(0.2,0.9,0.2,1);
}
.upgrade-wheel .inner{
  color:#e5e7eb;
  font-size:14px;
  text-align:center;
}

/* Responsive */
@media (max-width:768px){
  .container{
    padding:12px 10px 180px;
  }
  .section{
    padding:16px;
    margin:10px 0;
  }
  .case{
    flex-wrap:wrap;
    gap:12px;
  }
  .case .right{
    width:100%;
    align-items:stretch;
  }
  .openBtn{
    width:100%;
  }
  .roulette{
    height:130px;
  }
  .roulette-item{
    width:130px;
  }
  .roulette-item img{
    width:90px;
    height:90px;
  }
  #adminPanel{
    position:fixed;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    width:90%;
    max-width:400px;
  }
  #winResultBox{
    padding:24px 20px;
    margin:20px;
  }
  #winResultBox img{
    width:160px;
    height:160px;
  }
}

@media (max-width:480px){
  #topBar{
    padding:10px 12px;
  }
  #logo{
    font-size:18px;
  }
  #balanceBox{
    padding:6px 12px;
    font-size:14px;
  }
  .case-badge{
    width:60px;
    height:60px;
    font-size:12px;
  }
  .weapon-img{
    width:60px;
    height:60px;
  }
}
</style>
</head>
<body>

<!-- Top Bar -->
<div id="topBar">
  <div id="logo">CASE HUNTERS</div>
  <div style="display:flex;align-items:center;gap:12px">
    <div id="balanceBox"><span style="font-size:16px;">üíµ</span> <span id="balance">0</span> ‚ÇΩ</div>
    <button id="bankBtn" class="smallBtn" title="–ë–∞–Ω–∫">üíº</button>
    <button id="adminToggle" class="smallBtn" title="–ê–¥–º–∏–Ω–∫–∞">Admin</button>
  </div>
</div>

<!-- Daily Bonus Top -->
<div style="background:#111827;padding:12px 16px;text-align:center;border-bottom:1px solid #222">
  <button id="dailyBonusBtnTop" class="smallBtn">üéÅ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å +10 ‚ÇΩ</button>
</div>

<!-- Main Container -->
<div class="container">
  <div style="display:flex;flex-direction:column;gap:16px">
    <div>
      <!-- Cases Section -->
      <div class="section">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
          <div style="font-weight:bold;font-size:18px">–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–µ–π—Å—ã</div>
          <div style="font-size:12px;color:var(--muted)">–ù–∞–∂–º–∏—Ç–µ "–û—Ç–∫—Ä—ã—Ç—å" –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ä—É–ª–µ—Ç–∫–∏</div>
        </div>
        <div id="casesList"></div>
      </div>

      <!-- Inventory Section -->
      <div class="section">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
          <div style="font-weight:bold;font-size:18px">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</div>
          <div style="font-size:12px;color:var(--muted)">–í–∞—à–∏ –ø—Ä–µ–¥–º–µ—Ç—ã</div>
        </div>
        <div id="inventoryList" style="margin-top:12px"></div>
      </div>

      <!-- Referral Section -->
      <div class="section">
        <div style="font-weight:bold;font-size:18px;margin-bottom:12px">–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞</div>
        <div style="font-size:13px;color:var(--muted);margin-bottom:8px">–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:</div>
        <input id="myRefLink" style="width:100%;padding:12px;border-radius:10px;border:1px solid #2b3440;background:#071018;color:#fff;font-size:14px;margin-bottom:16px" readonly>
        
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
          <div style="font-size:14px">
            –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: <b id="refEarnings" style="color:var(--accent)">0</b> ‚ÇΩ
          </div>
          <button id="claimRefBtn" class="smallBtn">–ó–∞—á–∏—Å–ª–∏—Ç—å</button>
        </div>
        
        <div style="display:flex;gap:10px;margin-top:20px">
          <button id="dailyBonusBtn" class="smallBtn" style="flex:1">üéÅ –ë–æ–Ω—É—Å 10 ‚ÇΩ</button>
          <button id="extraBonusBtn" class="smallBtn" style="flex:1">‚ú® +10 ‚ÇΩ</button>
        </div>
      </div>
    </div>

    <!-- Chat & Online -->
    <div>
      <!-- Online Widget -->
      <div style="background:linear-gradient(135deg,#071018,#08121a);border-radius:14px;padding:20px;margin-bottom:16px;border:1px solid rgba(255,255,255,0.05)">
        <div style="font-weight:bold;font-size:16px;margin-bottom:8px">–û–Ω–ª–∞–π–Ω</div>
        <div style="font-size:40px;font-weight:800;color:var(--accent)" id="fakeOnline">0</div>
        <div style="font-size:13px;color:var(--muted);margin-top:6px">–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–µ–π—á–∞—Å</div>
      </div>

      <!-- Chat Box -->
      <div class="chatBox" id="chatBox"></div>
    </div>
  </div>
</div>

<!-- Admin Panel -->
<div id="adminPanel">
  <h4>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h4>
  <div class="adminRow">
    <input id="adminPass" placeholder="–ü–∞—Ä–æ–ª—å" type="password" />
    <button id="adminLogin" class="adminBtn">–í–æ–π—Ç–∏</button>
  </div>
  <div id="adminControls" style="display:none">
    <div class="adminRow">
      <input id="adminAddAmount" type="number" placeholder="–°—É–º–º–∞ +–±–∞–ª–∞–Ω—Å" />
      <button id="adminAddBtn" class="adminBtn">–î–æ–±–∞–≤–∏—Ç—å</button>
    </div>
    <div class="adminRow">
      <input id="adminSetRtp" type="number" step="0.01" placeholder="RTP (0.1-0.95)" />
      <button id="adminSetRtpBtn" class="adminBtn">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å RTP</button>
    </div>
    <div class="adminRow">
      <select id="adminForceCase" style="flex:1"></select>
      <select id="adminForceItem" style="flex:1"></select>
    </div>
    <div class="adminRow">
      <button id="adminForceWin" class="adminBtn" style="width:100%">–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à</button>
    </div>
    <div class="adminRow">
      <button id="adminClearRef" class="adminBtn" style="width:100%;background:linear-gradient(135deg,#ef4444,#dc2626)">–°–±—Ä–æ—Å–∏—Ç—å —Ä–µ—Ñ. –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è</button>
    </div>
    <div style="font-size:12px;color:var(--muted);margin-top:12px;text-align:center">–ü–∞—Ä–æ–ª—å: <b>!125125Cc</b></div>
  </div>
</div>

<!-- Bank Modal -->
<div id="bankOverlay">
  <div id="bankModal">
    <div style="font-weight:bold;font-size:20px;margin-bottom:12px;text-align:center">–ë–∞–Ω–∫</div>
    <div style="margin-bottom:16px;color:var(--muted);text-align:center;font-size:14px">
      –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ –≤—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ –≤ –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ
    </div>
    
    <div style="display:flex;gap:10px;margin-bottom:20px;align-items:center">
      <input id="amountInput" type="number" min="100" step="50" value="500" />
    </div>
    
    <div style="display:flex;gap:10px;margin-bottom:20px">
      <button id="depositBtn" class="smallBtn" style="flex:1;background:linear-gradient(135deg,var(--green),#0da271)">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
      <button id="withdrawBtn" class="smallBtn" style="flex:1;background:linear-gradient(135deg,#3b82f6,#2563eb)">–í—ã–≤–µ—Å—Ç–∏</button>
    </div>
    
    <div style="width:100%;border-top:1px solid rgba(255,255,255,0.1);padding-top:16px">
      <div style="text-align:center;color:var(--muted);font-size:13px">–ú–∏–Ω–∏–º—É–º: 100 ‚ÇΩ | –í—ã–≤–æ–¥: –æ—Ç 500 ‚ÇΩ</div>
    </div>
    
    <button id="closeBank" class="smallBtn" style="width:100%;margin-top:16px">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>

<!-- Win Overlay -->
<div id="overlay">
  <div id="modal">
    <div id="winResultBox">
      <img id="winImg" src="" alt="win">
      <div class="winTitle" id="winTitle">–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏</div>
      <div class="winPrice" id="winPrice">0 ‚ÇΩ</div>
      <div class="winNote" id="winNote">–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –ü—Ä–µ–¥–º–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å.</div>
      <div style="margin-top:24px"><button id="closeModal" class="smallBtn" style="min-width:120px">–ó–∞–∫—Ä—ã—Ç—å</button></div>
    </div>
  </div>
</div>

<!-- Upgrade Panel -->
<div id="upgradePanel">
  <div style="display:flex;align-items:center;justify-content:space-between;gap:16px;flex-wrap:wrap">
    <div style="display:flex;gap:12px;align-items:center">
      <div id="upgradeSelectedPreview" style="width:70px;height:70px;border-radius:10px;background:#0b0f14;display:flex;align-items:center;justify-content:center;color:#cbd5e1;border:1px solid rgba(255,255,255,0.1)">‚Äî</div>
      <div>
        <div id="upgradeSelectedName" style="font-weight:bold;font-size:16px">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç –¥–ª—è –∞–ø–≥—Ä–µ–π–¥–∞</div>
        <div id="upgradeSelectedPrice" style="font-size:13px;color:var(--muted)">‚Äî</div>
      </div>
    </div>

    <div style="display:flex;gap:16px;align-items:center">
      <div class="upgrade-wheel" id="upgradeWheelSmall">
        <div style="position:absolute;top:6px;left:50%;transform:translateX(-50%);width:0;height:0;border-left:8px solid transparent;border-right:8px solid transparent;border-bottom:12px solid var(--accent);z-index:20"></div>
        <div class="inner" id="upgradeInnerSmall">–ê–ø–≥—Ä–µ–π–¥</div>
      </div>
      <div style="display:flex;flex-direction:column;gap:10px;align-items:flex-end">
        <div style="display:flex;gap:10px">
          <button id="upgrade2xBtn" class="smallBtn">–ü–æ–ø—ã—Ç–∫–∞ 2x</button>
          <button id="upgrade3xBtn" class="smallBtn">–ü–æ–ø—ã—Ç–∫–∞ 3x</button>
        </div>
        <div id="upgradeResultSmall" style="font-size:13px;color:var(--muted);min-width:200px;text-align:right"></div>
      </div>
    </div>
  </div>
</div>

<script>
// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
const CONFIG = {
  STORAGE_PREFIX: 'ch_',
  DEMO_PASSWORD: '!125125Cc',
  DEFAULT_RTP: 0.65,
  IMAGE_BASE: 'https://via.placeholder.com/100x100/0b0f14/facc15?text=', // Placeholder –¥–ª—è –¥–µ–º–æ
  SPIN_DURATION: 6000,
  CHAT_UPDATE_INTERVAL: 7000,
  REFERRAL_PERCENT: 0.40,
  MIN_WITHDRAWAL: 500,
  MIN_DEPOSIT: 100
};

// –í—Å–µ –∫–µ–π—Å—ã –∏–∑ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞
const CASES = [
  {
    id: 'case0',
    name: 'Starter Case',
    price: 120,
    baseItems: [
      { id: 's1', name: 'P250 | Sand Dune', price: 220, baseChance: 55, img: 'P250' },
      { id: 's2', name: 'USP-S | Torque', price: 480, baseChance: 30, img: 'USP-S' },
      { id: 's4', name: 'CZ75-Auto | Tigris', price: 900, baseChance: 10, img: 'CZ75' },
      { id: 's3', name: 'Nova | Ranger', price: 1500, baseChance: 5, img: 'Nova' }
    ]
  },
  {
    id: 'case1',
    name: 'Dust II Case',
    price: 220,
    baseItems: [
      { id: 'g1', name: 'AK-47 | Redline', price: 900, baseChance: 40, img: 'AK-47' },
      { id: 'g2', name: 'M4A1-S | Guardian', price: 1800, baseChance: 30, img: 'M4A1-S' },
      { id: 'g5', name: 'P90 | Asiimov', price: 2600, baseChance: 10, img: 'P90' },
      { id: 'g3', name: 'Desert Eagle | Blaze', price: 5200, baseChance: 20, img: 'Deagle' }
    ]
  },
  {
    id: 'case1b',
    name: 'Classic Case',
    price: 420,
    baseItems: [
      { id: 'c1', name: 'AK-47 | Vulcan', price: 7200, baseChance: 35, img: 'AK-Vulcan' },
      { id: 'c2', name: 'M4A4 | Howl', price: 45000, baseChance: 6, img: 'M4-Howl' },
      { id: 'c4', name: 'USP-S | Kill Confirmed', price: 12000, baseChance: 20, img: 'USP-KC' },
      { id: 'c3', name: 'Glock-18 | Fade', price: 9600, baseChance: 39, img: 'Glock-Fade' }
    ]
  },
  {
    id: 'case2',
    name: 'Inferno Case',
    price: 980,
    baseItems: [
      { id: 'p1', name: 'AWP | Asiimov', price: 17600, baseChance: 18, img: 'AWP' },
      { id: 'p2', name: 'AK-47 | Fire Serpent', price: 72000, baseChance: 25, img: 'AK-Serpent' },
      { id: 'p3', name: 'M4A1-S | Hot Rod', price: 56000, baseChance: 45, img: 'M4-HotRod' },
      { id: 'p4', name: 'FAMAS | Roll Cage', price: 4200, baseChance: 12, img: 'FAMAS' }
    ]
  },
  {
    id: 'case3',
    name: 'Mirage Case',
    price: 7200,
    baseItems: [
      { id: 'l1', name: 'AWP | Medusa', price: 480000, baseChance: 3, img: 'AWP-Medusa' },
      { id: 'l2', name: 'AK-47 | Fire Serpent (StatTrak)', price: 200000, baseChance: 12, img: 'AK-ST' },
      { id: 'l3', name: 'M4A4 | Howl (StatTrak)', price: 96000, baseChance: 85, img: 'M4-Howl-ST' }
    ]
  },
  {
    id: 'gloveCase',
    name: 'Glove Case',
    price: 720,
    baseItems: [
      { id: 'gl1', name: 'Sport Gloves | Pandora\'s Box', price: 96000, baseChance: 40, img: 'Gloves' },
      { id: 'gl2', name: 'Driver Gloves | King Snake', price: 200000, baseChance: 35, img: 'Gloves-Snake' },
      { id: 'gl3', name: 'Specialist Gloves | Crimson Kimono', price: 360000, baseChance: 25, img: 'Gloves-Crimson' }
    ]
  }
];

// –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
class CaseHuntersGame {
  constructor() {
    this.state = {
      balance: 0,
      inventory: [],
      currentRtp: CONFIG.DEFAULT_RTP,
      adminLogged: false,
      upgradeSelectedItem: null
    };
    
    this.userId = this.getUserId();
    this.cases = this.prepareCases();
    this.init();
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  init() {
    this.loadState();
    this.setupReferrer();
    this.bindEvents();
    this.renderCases();
    this.renderInventory();
    this.updateUI();
    this.initChat();
    this.initOnlineCounter();
    this.populateAdminSelects();
  }

  // –ü–æ–ª—É—á–µ–Ω–∏–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  getUserId() {
    const key = CONFIG.STORAGE_PREFIX + 'userid';
    let id = localStorage.getItem(key);
    if (!id) {
      id = 'user_' + Math.random().toString(36).slice(2, 9);
      localStorage.setItem(key, id);
    }
    return id;
  }

  // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
  loadState() {
    try {
      const balanceKey = CONFIG.STORAGE_PREFIX + 'balance_' + this.userId;
      const balance = localStorage.getItem(balanceKey);
      this.state.balance = balance ? parseInt(balance) : 0;

      const inventoryKey = CONFIG.STORAGE_PREFIX + 'inventory_' + this.userId;
      const inventory = localStorage.getItem(inventoryKey);
      this.state.inventory = inventory ? JSON.parse(inventory) : [];
    } catch (error) {
      console.error('Error loading state:', error);
    }
  }

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
  saveState() {
    try {
      const balanceKey = CONFIG.STORAGE_PREFIX + 'balance_' + this.userId;
      localStorage.setItem(balanceKey, this.state.balance.toString());

      const inventoryKey = CONFIG.STORAGE_PREFIX + 'inventory_' + this.userId;
      localStorage.setItem(inventoryKey, JSON.stringify(this.state.inventory));
    } catch (error) {
      console.error('Error saving state:', error);
    }
  }

  // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–µ–π—Å–æ–≤ —Å RTP
  prepareCases() {
    return CASES.map(c => ({
      ...c,
      items: c.baseItems.map(it => ({ 
        ...it, 
        chance: it.baseChance,
        img: this.getImageUrl(it.img || it.name)
      })),
      baseTotalChance: c.baseItems.reduce((s, i) => s + i.baseChance, 0)
    }));
  }

  // –ü–æ–ª—É—á–µ–Ω–∏–µ URL –∫–∞—Ä—Ç–∏–Ω–∫–∏
  getImageUrl(name) {
    // –î–ª—è –¥–µ–º–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º placeholder, –≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∏
    const encodedName = encodeURIComponent(name.substring(0, 20));
    return `${CONFIG.IMAGE_BASE}${encodedName}`;
  }

  // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª–∞
  setupReferrer() {
    try {
      const urlParams = new URLSearchParams(window.location.search);
      const referrer = urlParams.get('ref');
      
      if (referrer && referrer !== this.userId) {
        const referrerKey = CONFIG.STORAGE_PREFIX + 'referrer_' + this.userId;
        localStorage.setItem(referrerKey, referrer);
      }
    } catch (error) {
      console.error('Error setting up referrer:', error);
    }
  }

  // –ü—Ä–∏–≤—è–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π
  bindEvents() {
    // –ë–∞–Ω–∫
    document.getElementById('bankBtn')?.addEventListener('click', () => this.showBankModal());
    document.getElementById('closeBank')?.addEventListener('click', () => this.hideBankModal());
    document.getElementById('depositBtn')?.addEventListener('click', () => this.deposit());
    document.getElementById('withdrawBtn')?.addEventListener('click', () => this.withdraw());

    // –ê–¥–º–∏–Ω–∫–∞
    document.getElementById('adminToggle')?.addEventListener('click', () => this.toggleAdminPanel());
    document.getElementById('adminLogin')?.addEventListener('click', () => this.adminLogin());
    document.getElementById('adminAddBtn')?.addEventListener('click', () => this.adminAddBalance());
    document.getElementById('adminSetRtpBtn')?.addEventListener('click', () => this.adminSetRtp());
    document.getElementById('adminForceWin')?.addEventListener('click', () => this.adminForceWin());
    document.getElementById('adminClearRef')?.addEventListener('click', () => this.adminClearRef());

    // –ë–æ–Ω—É—Å—ã
    document.getElementById('dailyBonusBtn')?.addEventListener('click', () => this.claimBonus('daily'));
    document.getElementById('dailyBonusBtnTop')?.addEventListener('click', () => this.claimBonus('daily'));
    document.getElementById('extraBonusBtn')?.addEventListener('click', () => this.claimBonus('extra'));
    document.getElementById('claimRefBtn')?.addEventListener('click', () => this.claimReferralEarnings());

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–æ–∫
    document.getElementById('closeModal')?.addEventListener('click', () => {
      document.getElementById('overlay').style.display = 'none';
    });

    // –ê–ø–≥—Ä–µ–π–¥
    document.getElementById('upgrade2xBtn')?.addEventListener('click', () => this.performUpgrade(2));
    document.getElementById('upgrade3xBtn')?.addEventListener('click', () => this.performUpgrade(3));
  }

  // –ü–æ–∫–∞–∑–∞—Ç—å –±–∞–Ω–∫ –º–æ–¥–∞–ª–∫—É
  showBankModal() {
    document.getElementById('bankOverlay').style.display = 'flex';
  }

  // –°–∫—Ä—ã—Ç—å –±–∞–Ω–∫ –º–æ–¥–∞–ª–∫—É
  hideBankModal() {
    document.getElementById('bankOverlay').style.display = 'none';
  }

  // –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
  deposit() {
    const amountInput = document.getElementById('amountInput');
    const amount = parseInt(amountInput?.value) || 0;
    
    if (amount < CONFIG.MIN_DEPOSIT) {
      this.showMessage(`–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è ${CONFIG.MIN_DEPOSIT} ‚ÇΩ`);
      return;
    }

    this.addBalance(amount);
    this.hideBankModal();
    this.showMessage(`–ü–æ–ø–æ–ª–Ω–µ–Ω–æ ${amount} ‚ÇΩ`, false);
    this.pushFakeChat(`${this.getRandomName()} –ø–æ–ø–æ–ª–Ω–∏–ª –±–∞–ª–∞–Ω—Å –Ω–∞ ${amount} ‚ÇΩ`);
  }

  // –í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤
  withdraw() {
    const amountInput = document.getElementById('amountInput');
    const amount = parseInt(amountInput?.value) || 0;
    
    if (amount < CONFIG.MIN_WITHDRAWAL) {
      this.showMessage(`–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤—ã–≤–æ–¥–∞ ${CONFIG.MIN_WITHDRAWAL} ‚ÇΩ`);
      return;
    }

    if (!this.state.adminLogged && this.state.balance < amount) {
      this.showMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –≤—ã–≤–æ–¥–∞');
      return;
    }

    if (!this.state.adminLogged) {
      this.subBalance(amount);
    }

    this.hideBankModal();
    this.showMessage(`–í—ã–≤–µ–¥–µ–Ω–æ ${amount} ‚ÇΩ`, false);
    this.pushFakeChat(`${this.getRandomName()} –≤—ã–≤–µ–ª ${amount} ‚ÇΩ`);
  }

  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏
  toggleAdminPanel() {
    const panel = document.getElementById('adminPanel');
    panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
  }

  // –í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∫—É
  adminLogin() {
    const password = document.getElementById('adminPass')?.value || '';
    
    if (password === CONFIG.DEMO_PASSWORD) {
      this.state.adminLogged = true;
      document.getElementById('adminControls').style.display = 'block';
      this.updateBalanceUI();
      this.showMessage('–ê–¥–º–∏–Ω: –≤—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω. –ë–∞–ª–∞–Ω—Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ ‚Äî –±–µ–∑–≥—Ä–∞–Ω–∏—á–Ω—ã–π.', false);
    } else {
      this.showMessage('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å.', false);
    }
  }

  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É
  adminAddBalance() {
    if (!this.state.adminLogged) {
      this.showMessage('–¢—Ä–µ–±—É–µ—Ç—Å—è –≤—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∫—É');
      return;
    }

    const amountInput = document.getElementById('adminAddAmount');
    const amount = parseInt(amountInput?.value) || 0;
    
    if (amount <= 0) {
      this.showMessage('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É > 0');
      return;
    }

    this.addBalance(amount);
    this.showMessage(`–ê–¥–º–∏–Ω: –¥–æ–±–∞–≤–ª–µ–Ω–æ ${amount} ‚ÇΩ`, false);
  }

  // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ RTP —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É
  adminSetRtp() {
    if (!this.state.adminLogged) {
      this.showMessage('–¢—Ä–µ–±—É–µ—Ç—Å—è –≤—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∫—É');
      return;
    }

    const rtpInput = document.getElementById('adminSetRtp');
    const rtp = parseFloat(rtpInput?.value);
    
    if (!rtp || rtp < 0.1 || rtp > 0.95) {
      this.showMessage('RTP –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 0.10‚Äì0.95');
      return;
    }

    this.state.currentRtp = rtp;
    this.applyHiddenRtp(rtp);
    this.showMessage(`–ê–¥–º–∏–Ω: RTP —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω ${rtp}`, false);
  }

  // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à
  adminForceWin() {
    if (!this.state.adminLogged) {
      this.showMessage('–¢—Ä–µ–±—É–µ—Ç—Å—è –≤—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∫—É');
      return;
    }

    const caseSelect = document.getElementById('adminForceCase');
    const itemSelect = document.getElementById('adminForceItem');
    
    if (!caseSelect || !itemSelect) return;

    const caseId = caseSelect.value;
    const itemId = itemSelect.value;
    
    const caseItem = this.cases.find(c => c.id === caseId);
    if (!caseItem) {
      this.showMessage('–ö–µ–π—Å –Ω–µ –Ω–∞–π–¥–µ–Ω');
      return;
    }

    const item = caseItem.items.find(it => it.id === itemId);
    if (!item) {
      this.showMessage('–ü—Ä–µ–¥–º–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
      return;
    }

    const inventoryItem = {
      uid: 'item_' + Date.now() + '_' + Math.random().toString(36).slice(2),
      id: item.id,
      name: item.name,
      price: item.price,
      img: item.img,
      upgraded: null
    };

    this.state.inventory.push(inventoryItem);
    this.saveState();
    this.renderInventory();
    this.showFullScreenWin(inventoryItem);
    this.pushFakeChat(`–ê–¥–º–∏–Ω –≤—ã–¥–∞–ª: ${item.name}`);
  }

  // –°–±—Ä–æ—Å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π
  adminClearRef() {
    if (!this.state.adminLogged) {
      this.showMessage('–¢—Ä–µ–±—É–µ—Ç—Å—è –≤—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∫—É');
      return;
    }

    // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è
    Object.keys(localStorage).forEach(key => {
      if (key.includes(CONFIG.STORAGE_PREFIX + 'refearn_')) {
        localStorage.removeItem(key);
      }
    });

    this.updateUI();
    this.showMessage('–†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è —Å–±—Ä–æ—à–µ–Ω—ã.', false);
  }

  // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–æ–≤ –≤ –∞–¥–º–∏–Ω–∫–µ
  populateAdminSelects() {
    const caseSelect = document.getElementById('adminForceCase');
    const itemSelect = document.getElementById('adminForceItem');
    
    if (!caseSelect || !itemSelect) return;

    caseSelect.innerHTML = '';
    itemSelect.innerHTML = '';

    // –ó–∞–ø–æ–ª–Ω—è–µ–º –∫–µ–π—Å—ã
    this.cases.forEach(caseItem => {
      const option = document.createElement('option');
      option.value = caseItem.id;
      option.textContent = caseItem.name;
      caseSelect.appendChild(option);
    });

    // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø—Ä–µ–¥–º–µ—Ç—ã –∏–∑ –ø–µ—Ä–≤–æ–≥–æ –∫–µ–π—Å–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    if (this.cases.length > 0) {
      this.updateAdminItems(this.cases[0].id);
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–µ–π—Å–∞
    caseSelect.addEventListener('change', (e) => {
      this.updateAdminItems(e.target.value);
    });
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –≤ –∞–¥–º–∏–Ω–∫–µ
  updateAdminItems(caseId) {
    const itemSelect = document.getElementById('adminForceItem');
    if (!itemSelect) return;

    itemSelect.innerHTML = '';
    
    const caseItem = this.cases.find(c => c.id === caseId);
    if (!caseItem) return;

    caseItem.items.forEach(item => {
      const option = document.createElement('option');
      option.value = item.id;
      option.textContent = item.name;
      itemSelect.appendChild(option);
    });
  }

  // –ü–æ–ª—É—á–µ–Ω–∏–µ –±–æ–Ω—É—Å–∞
  claimBonus(type) {
    const today = new Date().toISOString().split('T')[0];
    const storageKey = type === 'daily' 
      ? CONFIG.STORAGE_PREFIX + 'lastBonus_' + this.userId
      : CONFIG.STORAGE_PREFIX + 'lastExtraBonus_' + this.userId;

    const lastClaim = localStorage.getItem(storageKey);
    const amount = 10; // 10 ‚ÇΩ –∑–∞ –∫–∞–∂–¥—ã–π –±–æ–Ω—É—Å

    if (lastClaim === today) {
      this.showMessage(`–ë–æ–Ω—É—Å —É–∂–µ –ø–æ–ª—É—á–µ–Ω —Å–µ–≥–æ–¥–Ω—è`, false);
      return;
    }

    this.addBalance(amount);
    localStorage.setItem(storageKey, today);
    
    const message = type === 'daily' 
      ? `–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å ${amount} ‚ÇΩ –∑–∞—á–∏—Å–ª–µ–Ω`
      : `–ë–æ–Ω—É—Å —Å–≤–µ—Ä—Ö—É +${amount} ‚ÇΩ –∑–∞—á–∏—Å–ª–µ–Ω`;
    
    this.showMessage(message, false);
  }

  // –ó–∞—á–∏—Å–ª–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤
  claimReferralEarnings() {
    const earnings = this.getReferralEarnings();
    
    if (earnings <= 0) {
      this.showMessage('–ù–µ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –∑–∞—á–∏—Å–ª–µ–Ω–∏—è', false);
      return;
    }

    this.addBalance(earnings);
    this.clearReferralEarnings();
    this.showMessage(`–ó–∞—á–∏—Å–ª–µ–Ω–æ ${earnings} ‚ÇΩ –Ω–∞ –±–∞–ª–∞–Ω—Å`, false);
  }

  // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –¥–æ—Ö–æ–¥–æ–≤
  getReferralEarnings() {
    try {
      const key = CONFIG.STORAGE_PREFIX + 'refearn_' + this.userId;
      return parseInt(localStorage.getItem(key) || '0');
    } catch {
      return 0;
    }
  }

  // –û—á–∏—Å—Ç–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –¥–æ—Ö–æ–¥–æ–≤
  clearReferralEarnings() {
    try {
      const key = CONFIG.STORAGE_PREFIX + 'refearn_' + this.userId;
      localStorage.setItem(key, '0');
      this.updateUI();
    } catch (error) {
      console.error('Error clearing referral earnings:', error);
    }
  }

  // –†–µ–Ω–¥–µ—Ä –∫–µ–π—Å–æ–≤
  renderCases() {
    const container = document.getElementById('casesList');
    if (!container) return;

    container.innerHTML = '';

    this.cases.forEach(caseItem => {
      const caseElement = document.createElement('div');
      caseElement.className = 'case';
      caseElement.dataset.id = caseItem.id;

      caseElement.innerHTML = `
        <div class="left">
          <div class="case-badge">
            <div>–ö–ï–ô–°</div>
          </div>
          <div class="meta">
            <div class="title">${caseItem.name}</div>
            <div class="sub">–¶–µ–Ω–∞: ${caseItem.price} ‚ÇΩ</div>
          </div>
        </div>
        <div class="right">
          <div style="font-size:12px;color:var(--muted);margin-bottom:6px">–ü—Ä–µ–¥–º–µ—Ç–æ–≤: ${caseItem.items.length}</div>
          <button class="openBtn" data-open="${caseItem.id}">–û—Ç–∫—Ä—ã—Ç—å</button>
        </div>
      `;

      // –î–æ–±–∞–≤–ª—è–µ–º —Ä—É–ª–µ—Ç–∫—É
      const rouletteWrap = document.createElement('div');
      rouletteWrap.className = 'roulette';
      rouletteWrap.style.marginTop = '12px';
      rouletteWrap.style.display = 'none';
      
      const track = document.createElement('div');
      track.className = 'track';
      track.dataset.case = caseItem.id;
      
      const centerLine = document.createElement('div');
      centerLine.className = 'roulette-center-line';
      
      const glow = document.createElement('div');
      glow.className = 'roulette-glow';
      
      rouletteWrap.appendChild(track);
      rouletteWrap.appendChild(centerLine);
      rouletteWrap.appendChild(glow);
      
      caseElement.appendChild(rouletteWrap);
      container.appendChild(caseElement);

      // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º —Ä—É–ª–µ—Ç–∫—É
      this.prepareRouletteForCase(caseItem, track);

      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
      const openBtn = caseElement.querySelector(`[data-open="${caseItem.id}"]`);
      if (openBtn) {
        openBtn.addEventListener('click', (ev) => {
          ev.stopPropagation();
          this.showCaseRoulette(caseItem.id);
          this.openCaseWithTimedSpin(caseItem.id, track, CONFIG.SPIN_DURATION);
        });
      }

      caseElement.addEventListener('click', (e) => {
        if (e.target !== openBtn && !e.target.closest('.openBtn')) {
          this.toggleCaseRoulette(caseItem.id);
        }
      });
    });
  }

  // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä—É–ª–µ—Ç–∫–∏ –¥–ª—è –∫–µ–π—Å–∞
  prepareRouletteForCase(caseItem, trackEl) {
    if (!trackEl) return;

    trackEl.innerHTML = '';

    // –î—É–±–ª–∏—Ä—É–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã 20 —Ä–∞–∑ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç–∏
    const itemsToShow = 20;
    
    for (let i = 0; i < itemsToShow; i++) {
      caseItem.items.forEach(item => {
        const el = document.createElement('div');
        el.className = 'roulette-item';

        const img = document.createElement('img');
        img.className = 'weapon-img';
        img.src = item.img;
        img.alt = item.name;
        img.onerror = () => {
          // –ï—Å–ª–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∞ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å, —Å–æ–∑–¥–∞–µ–º placeholder —Å —Ç–µ–∫—Å—Ç–æ–º
          img.src = this.createImagePlaceholder(item.name);
        };

        el.appendChild(img);
        
        const nameDiv = document.createElement('div');
        nameDiv.textContent = item.name;
        nameDiv.style.fontSize = '12px';
        nameDiv.style.marginTop = '4px';
        
        const priceDiv = document.createElement('div');
        priceDiv.textContent = item.price + ' ‚ÇΩ';
        priceDiv.style.fontSize = '11px';
        priceDiv.style.color = 'var(--muted)';
        
        el.appendChild(nameDiv);
        el.appendChild(priceDiv);
        
        trackEl.appendChild(el);
      });
    }
  }

  // –°–æ–∑–¥–∞–Ω–∏–µ placeholder –¥–ª—è –∫–∞—Ä—Ç–∏–Ω–∫–∏
  createImagePlaceholder(text) {
    const canvas = document.createElement('canvas');
    canvas.width = 100;
    canvas.height = 100;
    const ctx = canvas.getContext('2d');
    
    // –§–æ–Ω
    ctx.fillStyle = '#0b0f14';
    ctx.fillRect(0, 0, 100, 100);
    
    // –ê–∫—Ü–µ–Ω—Ç–Ω—ã–π –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫
    ctx.fillStyle = '#facc15';
    ctx.globalAlpha = 0.12;
    ctx.fillRect(12, 12, 76, 76);
    ctx.globalAlpha = 1;
    
    // –¢–µ–∫—Å—Ç
    ctx.fillStyle = '#e6eef6';
    ctx.font = 'bold 10px Arial';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    
    // –†–∞–∑–±–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ —Å—Ç—Ä–æ–∫–∏
    const words = text.split(' ');
    let lines = [];
    let currentLine = words[0];
    
    for (let i = 1; i < words.length; i++) {
      const testLine = currentLine + ' ' + words[i];
      if (ctx.measureText(testLine).width < 80) {
        currentLine = testLine;
      } else {
        lines.push(currentLine);
        currentLine = words[i];
      }
    }
    lines.push(currentLine);
    
    // –†–∏—Å—É–µ–º —Ç–µ–∫—Å—Ç
    const startY = 50 - ((lines.length - 1) * 7);
    lines.forEach((line, index) => {
      ctx.fillText(line, 50, startY + (index * 14));
    });
    
    return canvas.toDataURL();
  }

  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä—É–ª–µ—Ç–∫–∏ –∫–µ–π—Å–∞
  toggleCaseRoulette(caseId) {
    const caseEl = document.querySelector(`.case[data-id="${caseId}"]`);
    if (!caseEl) return;
    
    const roulette = caseEl.querySelector('.roulette');
    if (!roulette) return;
    
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ä—É–ª–µ—Ç–∫–∏
    document.querySelectorAll('.case .roulette').forEach(r => {
      if (r !== roulette) r.style.display = 'none';
    });
    
    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ç–µ–∫—É—â—É—é
    roulette.style.display = roulette.style.display === 'none' ? 'block' : 'none';
  }

  // –ü–æ–∫–∞–∑–∞—Ç—å —Ä—É–ª–µ—Ç–∫—É –∫–µ–π—Å–∞
  showCaseRoulette(caseId) {
    const caseEl = document.querySelector(`.case[data-id="${caseId}"]`);
    if (!caseEl) return;
    
    const roulette = caseEl.querySelector('.roulette');
    if (!roulette) return;
    
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ä—É–ª–µ—Ç–∫–∏
    document.querySelectorAll('.case .roulette').forEach(r => {
      if (r !== roulette) r.style.display = 'none';
    });
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â—É—é
    roulette.style.display = 'block';
  }

  // –û—Ç–∫—Ä—ã—Ç–∏–µ –∫–µ–π—Å–∞ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
  async openCaseWithTimedSpin(caseId, trackEl, spinMs) {
    const caseItem = this.cases.find(c => c.id === caseId);
    if (!caseItem) return;
    
    const cost = caseItem.price;
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
    if (!this.state.adminLogged && this.state.balance < cost) {
      this.showMessage(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤. –ù—É–∂–Ω–æ ${cost} ‚ÇΩ`);
      return;
    }
    
    // –°–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤
    if (!this.state.adminLogged) {
      this.subBalance(cost);
    }
    
    // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞ –≤—Ä–µ–º—è –∞–Ω–∏–º–∞—Ü–∏–∏
    const openBtn = document.querySelector(`[data-open="${caseId}"]`);
    if (openBtn) {
      openBtn.disabled = true;
      openBtn.textContent = '–û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è...';
    }
    
    // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç
    const winItem = this.pickRandomItem(caseItem.items);
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
    await this.animateRoulette(caseId, winItem, spinMs);
    
    // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
    const inventoryItem = {
      uid: 'item_' + Date.now() + '_' + Math.random().toString(36).slice(2),
      id: winItem.id,
      name: winItem.name,
      price: winItem.price,
      img: winItem.img,
      upgraded: null
    };
    
    this.state.inventory.push(inventoryItem);
    this.saveState();
    
    // –ù–∞—á–∏—Å–ª—è–µ–º —Ä–µ—Ñ–µ—Ä–∞–ª—É –µ—Å–ª–∏ –µ—Å—Ç—å
    this.creditReferrerIfApplicable(cost, winItem.price);
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    this.showFullScreenWin(inventoryItem);
    this.renderInventory();
    this.updateUI();
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç
    this.pushFakeChat(`${this.getRandomName()} –æ—Ç–∫—Ä—ã–ª ${caseItem.name} –∏ –ø–æ–ª—É—á–∏–ª ${winItem.name}`);
    
    // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
    if (openBtn) {
      openBtn.disabled = false;
      openBtn.textContent = '–û—Ç–∫—Ä—ã—Ç—å';
    }
  }

  // –ê–Ω–∏–º–∞—Ü–∏—è —Ä—É–ª–µ—Ç–∫–∏
  animateRoulette(caseId, winItem, duration) {
    return new Promise((resolve) => {
      const track = document.querySelector(`.track[data-case="${caseId}"]`);
      if (!track) {
        resolve();
        return;
      }
      
      const items = Array.from(track.children);
      if (items.length === 0) {
        resolve();
        return;
      }
      
      // –ù–∞—Ö–æ–¥–∏–º –∏–Ω–¥–µ–∫—Å –≤—ã–∏–≥—Ä–∞–Ω–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞
      let targetIndex = items.findIndex(item => 
        item.textContent.includes(winItem.name)
      );
      
      if (targetIndex === -1) {
        targetIndex = Math.floor(items.length / 2);
      }
      
      const itemWidth = items[0].offsetWidth || 140;
      const container = track.parentElement;
      const containerWidth = container.clientWidth;
      
      // –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —Ç–æ—á–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
      const centerOffset = Math.floor(containerWidth / 2);
      
      // –ü–æ–∑–∏—Ü–∏—è —Ü–µ–Ω—Ç—Ä–∞ –≤—ã–∏–≥—Ä–∞–Ω–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞
      let targetCenter = 0;
      for (let i = 0; i < targetIndex; i++) {
        targetCenter += (items[i].offsetWidth || itemWidth);
      }
      targetCenter += (items[targetIndex].offsetWidth || itemWidth) / 2;
      
      // –ù–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª–Ω—ã—Ö –æ–±–æ—Ä–æ—Ç–æ–≤ + –ø–æ–∑–∏—Ü–∏—è –≤—ã–∏–≥—Ä—ã—à–∞
      const cycles = 5;
      const trackWidth = items.reduce((sum, item) => sum + (item.offsetWidth || itemWidth), 0);
      const virtualTargetCenter = targetCenter + cycles * trackWidth;
      
      // –ü–æ–∑–∏—Ü–∏—è –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
      let desiredTranslate = centerOffset - virtualTargetCenter;
      
      // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –¥–ª—è –ø–ª–∞–≤–Ω–æ—Å—Ç–∏
      const minTranslate = containerWidth - trackWidth;
      while (desiredTranslate < minTranslate) {
        desiredTranslate += trackWidth;
      }
      
      // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
      track.style.transition = `transform ${duration}ms cubic-bezier(0.18, 0.9, 0.2, 1)`;
      requestAnimationFrame(() => {
        track.style.transform = `translateX(${desiredTranslate}px)`;
      });
      
      // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∞–Ω–∏–º–∞—Ü–∏–∏
      setTimeout(() => {
        track.style.transition = '';
        resolve();
      }, duration + 100);
    });
  }

  // –í—ã–±–æ—Ä —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞
  pickRandomItem(items) {
    const totalChance = items.reduce((sum, item) => sum + (item.chance || 1), 0);
    let random = Math.random() * totalChance;
    
    for (const item of items) {
      random -= (item.chance || 1);
      if (random <= 0) {
        return { ...item };
      }
    }
    
    return { ...items[items.length - 1] };
  }

  // –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—É
  creditReferrerIfApplicable(cost, winPrice) {
    try {
      const refKey = CONFIG.STORAGE_PREFIX + 'referrer_' + this.userId;
      const referrerId = localStorage.getItem(refKey);
      
      if (!referrerId) return;
      
      const loss = Math.max(0, cost - winPrice);
      if (loss <= 0) return;
      
      const reward = Math.round(loss * CONFIG.REFERRAL_PERCENT);
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—É
      const refEarnKey = CONFIG.STORAGE_PREFIX + 'refearn_' + referrerId;
      const currentEarnings = parseInt(localStorage.getItem(refEarnKey) || '0');
      localStorage.setItem(refEarnKey, (currentEarnings + reward).toString());
      
      // –ï—Å–ª–∏ —Ä–µ—Ñ–µ—Ä–µ—Ä –æ–Ω–ª–∞–π–Ω, –¥–æ–±–∞–≤–ª—è–µ–º –µ–º—É –Ω–∞ –±–∞–ª–∞–Ω—Å
      const refBalanceKey = CONFIG.STORAGE_PREFIX + 'balance_' + referrerId;
      const refBalance = parseInt(localStorage.getItem(refBalanceKey) || '0');
      localStorage.setItem(refBalanceKey, (refBalance + reward).toString());
      
    } catch (error) {
      console.error('Error crediting referrer:', error);
    }
  }

  // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–∏–≥—Ä—ã—à –≤ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ
  showFullScreenWin(item) {
    const winImg = document.getElementById('winImg');
    const winTitle = document.getElementById('winTitle');
    const winPrice = document.getElementById('winPrice');
    const winNote = document.getElementById('winNote');
    
    winImg.src = item.img;
    winImg.onerror = () => {
      winImg.src = this.createImagePlaceholder(item.name);
    };
    
    winTitle.textContent = item.name;
    winPrice.textContent = `${item.price} ‚ÇΩ`;
    winNote.textContent = '–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –ü—Ä–µ–¥–º–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å.';
    
    document.getElementById('winResultBox').style.display = 'block';
    document.getElementById('overlay').style.display = 'flex';
  }

  // –†–µ–Ω–¥–µ—Ä –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
  renderInventory() {
    const container = document.getElementById('inventoryList');
    if (!container) return;
    
    if (this.state.inventory.length === 0) {
      container.innerHTML = '<div style="text-align:center;color:var(--muted);padding:20px">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç</div>';
      return;
    }
    
    container.innerHTML = '';
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç—ã –ø–µ—Ä–≤—ã–º–∏
    [...this.state.inventory].reverse().forEach(item => {
      const itemElement = document.createElement('div');
      itemElement.className = 'item';
      
      itemElement.innerHTML = `
        <div class="left">
          <img src="${item.img}" alt="${item.name}" class="weapon-img" 
               onerror="this.src='${this.createImagePlaceholder(item.name)}'">
          <div class="meta">
            <div class="title">${item.name}${item.upgraded ? ` ‚Ä¢ ${item.upgraded.multiplier}x` : ''}</div>
            <div class="sub">${item.price} ‚ÇΩ</div>
          </div>
        </div>
        <div>
          <button class="smallBtn" data-sell="${item.uid}" style="margin-bottom:8px">–ü—Ä–æ–¥–∞—Ç—å</button>
          <button class="smallBtn" data-upgrade="${item.uid}">–ê–ø–≥—Ä–µ–π–¥</button>
        </div>
      `;
      
      container.appendChild(itemElement);
      
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
      const sellBtn = itemElement.querySelector(`[data-sell="${item.uid}"]`);
      const upgradeBtn = itemElement.querySelector(`[data-upgrade="${item.uid}"]`);
      
      if (sellBtn) {
        sellBtn.addEventListener('click', () => {
          this.sellItem(item.uid);
        });
      }
      
      if (upgradeBtn) {
        upgradeBtn.addEventListener('click', () => {
          this.openUpgradePanelForItem(item);
        });
      }
    });
  }

  // –ü—Ä–æ–¥–∞–∂–∞ –ø—Ä–µ–¥–º–µ—Ç–∞
  sellItem(itemUid) {
    const itemIndex = this.state.inventory.findIndex(item => item.uid === itemUid);
    if (itemIndex === -1) return;
    
    const item = this.state.inventory[itemIndex];
    this.addBalance(item.price);
    this.state.inventory.splice(itemIndex, 1);
    
    this.saveState();
    this.renderInventory();
    this.showMessage(`–ü—Ä–µ–¥–º–µ—Ç "${item.name}" –ø—Ä–æ–¥–∞–Ω –∑–∞ ${item.price} ‚ÇΩ`, false);
    this.pushFakeChat(`${this.getRandomName()} –ø—Ä–æ–¥–∞–ª ${item.name} –∑–∞ ${item.price} ‚ÇΩ`);
  }

  // –û—Ç–∫—Ä—ã—Ç–∏–µ –ø–∞–Ω–µ–ª–∏ –∞–ø–≥—Ä–µ–π–¥–∞
  openUpgradePanelForItem(item) {
    this.state.upgradeSelectedItem = item;
    
    const preview = document.getElementById('upgradeSelectedPreview');
    if (preview) {
      preview.innerHTML = '';
      const img = document.createElement('img');
      img.style.width = '70px';
      img.style.height = '70px';
      img.style.borderRadius = '10px';
      img.style.objectFit = 'cover';
      img.src = item.img;
      img.onerror = () => {
        img.src = this.createImagePlaceholder(item.name);
      };
      preview.appendChild(img);
    }
    
    document.getElementById('upgradeSelectedName').textContent = item.name;
    document.getElementById('upgradeSelectedPrice').textContent = `${item.price} ‚ÇΩ`;
    document.getElementById('upgradeResultSmall').textContent = '';
    document.getElementById('upgradeInnerSmall').textContent = '–ê–ø–≥—Ä–µ–π–¥';
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å –∞–ø–≥—Ä–µ–π–¥–∞
    document.getElementById('upgradePanel').style.display = 'block';
    
    // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –ø–∞–Ω–µ–ª–∏ –∞–ø–≥—Ä–µ–π–¥–∞
    window.scrollTo({
      top: document.body.scrollHeight,
      behavior: 'smooth'
    });
  }

  // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∞–ø–≥—Ä–µ–π–¥–∞
  performUpgrade(multiplier) {
    if (!this.state.upgradeSelectedItem) {
      document.getElementById('upgradeResultSmall').textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç';
      return;
    }
    
    const item = this.state.upgradeSelectedItem;
    const cost = multiplier === 2 
      ? Math.max(100, Math.round(item.price * 0.18))
      : Math.max(200, Math.round(item.price * 0.35));
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
    if (!this.state.adminLogged && this.state.balance < cost) {
      document.getElementById('upgradeResultSmall').textContent = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤';
      return;
    }
    
    // –°–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤
    if (!this.state.adminLogged) {
      this.subBalance(cost);
    }
    
    document.getElementById('upgradeResultSmall').textContent = '–ö—Ä—É—Ç–∏–º...';
    
    // –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —É—Å–ø–µ—Ö–∞
    const probability = multiplier === 2 ? 0.60 : 0.30;
    const success = Math.random() < probability;
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –∫–æ–ª–µ—Å–∞
    const wheel = document.getElementById('upgradeWheelSmall');
    const baseSpins = 3 + Math.floor(Math.random() * 3);
    let finalAngle;
    
    if (success) {
      finalAngle = 360 * baseSpins + (Math.random() * 50 + 5);
    } else {
      finalAngle = 360 * baseSpins + (Math.random() * 180 + 120);
    }
    
    if (wheel) {
      wheel.style.transition = 'transform 2000ms cubic-bezier(.2,.9,.2,1)';
      wheel.style.transform = `rotate(${finalAngle}deg)`;
    }
    
    // –†–µ–∑—É–ª—å—Ç–∞—Ç –∞–ø–≥—Ä–µ–π–¥–∞
    setTimeout(() => {
      if (wheel) {
        wheel.style.transition = '';
        wheel.style.transform = `rotate(${finalAngle % 360}deg)`;
      }
      
      if (success) {
        // –£—Å–ø–µ—à–Ω—ã–π –∞–ø–≥—Ä–µ–π–¥
        item.price = Math.round(item.price * multiplier);
        item.upgraded = item.upgraded || { times: 0, multiplier: 1 };
        item.upgraded.times += 1;
        item.upgraded.multiplier *= multiplier;
        
        document.getElementById('upgradeResultSmall').textContent = 
          `–£—Å–ø–µ—Ö! –ü—Ä–µ–¥–º–µ—Ç —É–º–Ω–æ–∂–µ–Ω –Ω–∞ ${multiplier}x. –ù–æ–≤–∞—è —Ü–µ–Ω–∞: ${item.price} ‚ÇΩ`;
        document.getElementById('upgradeSelectedPrice').textContent = `${item.price} ‚ÇΩ`;
        
        this.pushFakeChat(`${this.getRandomName()} —É—Å–ø–µ—à–Ω–æ –∞–ø–≥—Ä–µ–π–¥–Ω—É–ª ${item.name} –¥–æ ${item.price} ‚ÇΩ`);
      } else {
        // –ù–µ—É–¥–∞—á–∞
        document.getElementById('upgradeResultSmall').textContent = 
          '–ù–µ—É–¥–∞—á–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞ –∏–ª–∏ –ø—Ä–æ–¥–∞–π—Ç–µ –ø—Ä–µ–¥–º–µ—Ç.';
        this.pushFakeChat(`${this.getRandomName()} –Ω–µ—É–¥–∞—á–Ω–æ –∞–ø–≥—Ä–µ–π–¥–Ω—É–ª ${item.name}`);
      }
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
      this.saveState();
      this.renderInventory();
      this.updateUI();
      
    }, 2050);
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
  updateUI() {
    // –ë–∞–ª–∞–Ω—Å
    const balanceElement = document.getElementById('balance');
    if (balanceElement) {
      balanceElement.textContent = this.state.adminLogged ? '‚àû' : this.state.balance;
    }
    
    // –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –¥–æ—Ö–æ–¥—ã
    const refEarningsElement = document.getElementById('refEarnings');
    if (refEarningsElement) {
      refEarningsElement.textContent = this.getReferralEarnings();
    }
    
    // –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞
    const refLinkElement = document.getElementById('myRefLink');
    if (refLinkElement) {
      refLinkElement.value = `${window.location.origin}${window.location.pathname}?ref=${this.userId}`;
    }
  }

  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
  addBalance(amount) {
    if (this.state.adminLogged) {
      // –í —Ä–µ–∂–∏–º–µ –∞–¥–º–∏–Ω–∞ –±–∞–ª–∞–Ω—Å –±–µ–∑–≥—Ä–∞–Ω–∏—á–Ω—ã–π
      this.updateUI();
      return;
    }
    
    this.state.balance += Math.round(amount);
    this.saveState();
    this.updateUI();
  }

  // –°–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
  subBalance(amount) {
    if (this.state.adminLogged) {
      // –í —Ä–µ–∂–∏–º–µ –∞–¥–º–∏–Ω–∞ –±–∞–ª–∞–Ω—Å –Ω–µ —Å–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è
      this.updateUI();
      return;
    }
    
    this.state.balance = Math.max(0, this.state.balance - Math.round(amount));
    this.saveState();
    this.updateUI();
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –≤ UI
  updateBalanceUI() {
    const balanceElement = document.getElementById('balance');
    if (!balanceElement) return;
    
    if (this.state.adminLogged) {
      balanceElement.textContent = '‚àû';
      balanceElement.parentElement.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
    } else {
      balanceElement.textContent = this.state.balance;
      balanceElement.parentElement.style.background = 'linear-gradient(135deg, #facc15, #eab308)';
    }
  }

  // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ RTP
  applyHiddenRtp(targetRtp) {
    this.cases.forEach(c => {
      const items = c.items;
      const avgPrice = items.reduce((s, i) => s + i.price, 0) / items.length;
      const baseChances = items.map(i => i.baseChance || 1);
      const factor = Math.max(0.10, targetRtp);
      
      const newChances = items.map((it, idx) => {
        const rel = it.price / avgPrice;
        const val = baseChances[idx] * (1 / (1 + (rel - 1) * (1.4 - factor)));
        return Math.max(val, 0.01);
      });
      
      items.forEach((it, idx) => {
        it.chance = newChances[idx];
      });
    });
  }

  // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
  showMessage(text, showWinBox = true) {
    // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π
    const modal = document.createElement('div');
    modal.style.position = 'fixed';
    modal.style.top = '50%';
    modal.style.left = '50%';
    modal.style.transform = 'translate(-50%, -50%)';
    modal.style.background = 'linear-gradient(135deg, #071018, #08121a)';
    modal.style.padding = '20px';
    modal.style.borderRadius = '14px';
    modal.style.border = '2px solid var(--accent)';
    modal.style.color = '#fff';
    modal.style.zIndex = '3000';
    modal.style.textAlign = 'center';
    modal.style.minWidth = '250px';
    modal.style.boxShadow = '0 10px 30px rgba(0,0,0,0.5)';
    modal.innerHTML = `
      <div style="margin-bottom:15px;font-size:16px">${text}</div>
      <button class="smallBtn" id="closeTempModal">OK</button>
    `;
    
    document.body.appendChild(modal);
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–∫—Ä—ã—Ç–∏—è
    document.getElementById('closeTempModal').addEventListener('click', () => {
      document.body.removeChild(modal);
    });
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    if (!showWinBox) {
      setTimeout(() => {
        if (modal.parentNode) {
          document.body.removeChild(modal);
        }
      }, 2000);
    }
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–∞—Ç–∞
  initChat() {
    // –ù–∞—á–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    const initialMessages = [
      '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Case Hunters!',
      '–û—Ç–∫—Ä—ã–≤–∞–π—Ç–µ –∫–µ–π—Å—ã –∏ –≤—ã–∏–≥—Ä—ã–≤–∞–π—Ç–µ –∫—Ä—É—Ç—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã!',
      '–ù–µ –∑–∞–±—ã–≤–∞–π—Ç–µ –ø—Ä–æ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –±–æ–Ω—É—Å—ã!'
    ];
    
    initialMessages.forEach((msg, i) => {
      setTimeout(() => {
        this.pushFakeChat(msg, '–°–∏—Å—Ç–µ–º–∞');
      }, 1000 * i);
    });
    
    // –ò–º–∏—Ç–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏–≥—Ä–æ–∫–æ–≤
    setInterval(() => {
      const messages = [
        'AK-47 | Redline',
        'AWP | Asiimov',
        'Desert Eagle | Blaze',
        'Glock-18 | Fade',
        'M4A4 | Howl',
        'Sport Gloves | Pandora\'s Box'
      ];
      
      const randomItem = messages[Math.floor(Math.random() * messages.length)];
      this.pushFakeChat(
        `${this.getRandomName()} –æ—Ç–∫—Ä—ã–ª –∫–µ–π—Å –∏ –ø–æ–ª—É—á–∏–ª ${randomItem}`,
        this.getRandomName()
      );
    }, 10000);
    
    // –ò–º–∏—Ç–∞—Ü–∏—è –≤—ã–≤–æ–¥–æ–≤
    setInterval(() => {
      const amount = 500 + Math.floor(Math.random() * 1000);
      this.pushFakeChat(
        `${this.getRandomName()} –≤—ã–≤–µ–ª ${amount} ‚ÇΩ`,
        this.getRandomName()
      );
    }, 15000);
  }

  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
  pushFakeChat(text, user = null) {
    const chatBox = document.getElementById('chatBox');
    if (!chatBox) return;
    
    const messageElement = document.createElement('div');
    messageElement.className = 'chatMessage';
    
    const userName = user || this.getRandomName();
    const time = new Date().toLocaleTimeString([], { 
      hour: '2-digit', 
      minute: '2-digit' 
    });
    
    messageElement.innerHTML = `
      <div class="meta">
        <span>${userName}</span>
        <span>${time}</span>
      </div>
      <div>${text}</div>
    `;
    
    chatBox.appendChild(messageElement);
    
    // –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ –Ω–æ–≤—ã–º —Å–æ–æ–±—â–µ–Ω–∏—è–º
    chatBox.scrollTop = chatBox.scrollHeight;
    
    // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
    if (chatBox.children.length > 50) {
      chatBox.removeChild(chatBox.children[0]);
    }
  }

  // –°–ª—É—á–∞–π–Ω–æ–µ –∏–º—è –¥–ª—è —á–∞—Ç–∞
  getRandomName() {
    const names = [
      '–ò–≤–∞–Ω_92', 'Anna_Pro', 'GamerMax', 'Oleg_CS', 'Vlad99',
      'Katya', 'Pro_Player', 'Rus_Bot', 'Sniper', 'Hunter'
    ];
    return names[Math.floor(Math.random() * names.length)];
  }

  // –°—á–µ—Ç—á–∏–∫ –æ–Ω–ª–∞–π–Ω
  initOnlineCounter() {
    let onlineCount = 120 + Math.floor(Math.random() * 80);
    
    const updateOnline = () => {
      onlineCount += Math.floor(Math.random() * 7) - 3;
      onlineCount = Math.max(50, Math.min(300, onlineCount));
      
      const onlineElement = document.getElementById('fakeOnline');
      if (onlineElement) {
        onlineElement.textContent = onlineCount;
      }
    };
    
    updateOnline();
    setInterval(updateOnline, 5000);
  }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
let app;

document.addEventListener('DOMContentLoaded', () => {
  try {
    app = new CaseHuntersGame();
    
    // –≠–∫—Å–ø–æ—Ä—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
    window.CaseHunters = app;
    
    console.log('Case Hunters —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!');
    
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:', error);
    
    // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
    const errorDiv = document.createElement('div');
    errorDiv.style.position = 'fixed';
    errorDiv.style.top = '50%';
    errorDiv.style.left = '50%';
    errorDiv.style.transform = 'translate(-50%, -50%)';
    errorDiv.style.background = '#ef4444';
    errorDiv.style.color = 'white';
    errorDiv.style.padding = '20px';
    errorDiv.style.borderRadius = '10px';
    errorDiv.style.zIndex = '9999';
    errorDiv.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.';
    
    document.body.appendChild(errorDiv);
  }
});

// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ö–µ–ª–ø–µ—Ä—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π
window.handleWithdraw = function() {
  const amountInput = document.getElementById('amountInput');
  if (!amountInput) return;
  
  const amount = parseInt(amountInput.value) || 0;
  if (amount < 500) {
    alert('–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤—ã–≤–æ–¥–∞ ‚Äî 500 ‚ÇΩ');
    return;
  }
  
  app?.subBalance(amount);
  document.getElementById('bankOverlay').style.display = 'none';
  app?.showMessage(`–í—ã–≤–µ–¥–µ–Ω–æ ${amount} ‚ÇΩ`, false);
  app?.pushFakeChat('–ò–≥—Ä–æ–∫ –≤—ã–≤–µ–ª ' + amount + ' ‚ÇΩ');
};

// –ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ —Å—Ç–∞—Ä—ã–º –∫–æ–¥–æ–º
window.adminLoginHandler = function() {
  const password = document.getElementById('adminPass')?.value || '';
  
  if (password === '!125125Cc') {
    if (app) {
      app.state.adminLogged = true;
      app.updateBalanceUI();
    }
    document.getElementById('adminControls').style.display = 'block';
    alert('–ê–¥–º–∏–Ω: –≤—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω. –ë–∞–ª–∞–Ω—Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ ‚Äî –±–µ–∑–≥—Ä–∞–Ω–∏—á–Ω—ã–π (–¥–µ–º–æ).');
  } else {
    alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å (–¥–µ–º–æ).');
  }
};
</script>
</body>
</html>