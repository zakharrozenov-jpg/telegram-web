<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Case Hunters</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body{margin:0;font-family:Arial;background:radial-gradient(circle at top,#2c3e50,#0f1419);color:#fff;text-align:center;padding-top:110px}
h1{color:#f39c12}
#topBar{position:fixed;top:10px;left:10px;right:10px;display:flex;justify-content:space-between;align-items:center;z-index:10}
#balance{color:#2ecc71;font-weight:bold}
#online{color:#1e90ff;font-size:.9em}
button{background:linear-gradient(135deg,#f39c12,#e67e22);border:none;border-radius:12px;padding:8px 14px;font-weight:bold;cursor:pointer}
.section{width:min(94vw,540px);margin:14px auto;background:#121820;border-radius:18px;padding:14px}
.case{background:#1c2630;border-radius:16px;padding:12px;margin:10px 0;display:flex;justify-content:space-between;align-items:center;cursor:pointer}
.case img{width:56px}
.list{font-size:.85em;text-align:left;max-height:160px;overflow:auto}
.list div{border-bottom:1px solid #1f2a35;padding:6px 0}
.inv-item{display:flex;justify-content:space-between;align-items:center;gap:6px}
.inv-item img{width:52px}
.small{font-size:.75em;opacity:.75}
#overlay{position:fixed;inset:0;background:rgba(0,0,0,.9);display:none;align-items:center;justify-content:center;z-index:100}
#modal{background:#121820;width:min(94vw,540px);border-radius:20px;padding:16px}
.roulette{height:120px;overflow:hidden;border:2px solid #f39c12;border-radius:14px;margin:12px 0;position:relative}
.roulette::after{content:'';position:absolute;left:50%;top:0;width:2px;height:100%;background:#f39c12}
.track{display:flex;position:relative;left:0}
.item{min-width:120px;font-size:.7em}
.item img{width:80px;height:55px;object-fit:contain}
#rewardImg{width:180px;margin-top:10px;display:none}
select{padding:6px;border-radius:8px}
</style>
</head>

<body>

<div id="topBar">
  <div>
    <div id="balance">–ë–∞–ª–∞–Ω—Å: 500 üí∞</div>
    <div id="online">üü¢ –û–Ω–ª–∞–π–Ω: 128</div>
  </div>
  <div>
    <button onclick="dailyBonus()">üéÅ</button>
    <button onclick="topUp()">‚ûï</button>
  </div>
</div>

<h1>Case Hunters</h1>

<div class="section">
  <h3>üì¶ –ö–µ–π—Å—ã</h3>
  <div id="cases"></div>
</div>

<div class="section">
  <h3>üèÜ –¢–æ–ø –¥—Ä–æ–ø–æ–≤ –¥–Ω—è</h3>
  <div id="topDrops" class="list"></div>
</div>

<div class="section">
  <h3>üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h3>
  <div id="inventory" class="list"></div>
</div>

<div class="section">
  <h3>üéØ –ê–ø–≥—Ä–µ–π–¥</h3>
  <div id="upgradeInfo">–í—ã–±–µ—Ä–∏ –ø—Ä–µ–¥–º–µ—Ç</div>
  <select id="upgradeTarget"></select>
  <div id="upgradeChance" class="small"></div>
  <button onclick="upgrade()">–ê–ø–≥—Ä–µ–π–¥–∏—Ç—å</button>
</div>

<div id="overlay">
  <div id="modal">
    <h3 id="caseTitle"></h3>
    <div class="roulette"><div id="track" class="track"></div></div>
    <img id="rewardImg">
    <div id="result"></div>
    <button onclick="closeModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>

<script>
const tg=Telegram.WebApp;tg.ready();tg.expand();

/* ===== BALANCE ===== */
let balance=Number(localStorage.getItem('balance'))||500;
const bal=document.getElementById('balance');
function updateBal(){bal.textContent=`–ë–∞–ª–∞–Ω—Å: ${balance} üí∞`;localStorage.setItem('balance',balance)}
updateBal();

/* ===== ONLINE ===== */
const onlineEl=document.getElementById('online');
setInterval(()=>onlineEl.textContent='üü¢ –û–Ω–ª–∞–π–Ω: '+(120+Math.floor(Math.random()*60)),10000);

/* ===== DAILY BONUS + STREAK ===== */
function dailyBonus(){
 const now=new Date().toDateString();
 const last=localStorage.getItem('dailyDate');
 let streak=Number(localStorage.getItem('streak'))||0;

 if(last===now){tg.showAlert('–ë–æ–Ω—É—Å —É–∂–µ –ø–æ–ª—É—á–µ–Ω —Å–µ–≥–æ–¥–Ω—è');return;}

 const yesterday=new Date(Date.now()-86400000).toDateString();
 streak = (last===yesterday) ? streak+1 : 1;

 const reward=100+streak*50;
 balance+=reward;
 updateBal();

 localStorage.setItem('dailyDate',now);
 localStorage.setItem('streak',streak);
 tg.showAlert(`üéÅ –ë–æ–Ω—É—Å +${reward} üí∞ | –°–µ—Ä–∏—è: ${streak}`);
}

/* ===== DATA ===== */
const casesData=[
 {name:'Low RTP Case',price:50,rtp:.85,img:'https://steamcdn-a.akamaihd.net/apps/730/icons/econ/weapon_cases/crate_community_26.png'},
 {name:'Medium RTP Case',price:150,rtp:.95,img:'https://steamcdn-a.akamaihd.net/apps/730/icons/econ/weapon_cases/crate_community_31.png'},
 {name:'High RTP Case',price:300,rtp:1.05,img:'https://steamcdn-a.akamaihd.net/apps/730/icons/econ/weapon_cases/crate_community_33.png'}
];

const rewards=[
 {name:'P90 | Sand Spray',price:20,img:'https://community.cloudflare.steamstatic.com/economy/image/class/730/1837'},
 {name:'AK-47 | Redline',price:120,img:'https://community.cloudflare.steamstatic.com/economy/image/class/730/282'},
 {name:'M4A4 | Howl',price:300,img:'https://community.cloudflare.steamstatic.com/economy/image/class/730/309'},
 {name:'AWP | Dragon Lore',price:800,img:'https://community.cloudflare.steamstatic.com/economy/image/class/730/344'}
];

/* ===== RTP BY BALANCE ===== */
function balanceModifier(){
 if(balance<300) return 1.08;
 if(balance>1500) return 0.9;
 return 1;
}

/* ===== CASES ===== */
const casesEl=document.getElementById('cases');
casesData.forEach(c=>{
 const d=document.createElement('div');
 d.className='case';
 d.innerHTML=`<img src="${c.img}"><div>${c.name}<br><span class="small">üí∞ ${c.price} | RTP ${Math.round(c.rtp*100)}%</span></div>`;
 d.onclick=()=>openCase(c);
 casesEl.appendChild(d);
});

/* ===== INVENTORY ===== */
let inventory=[];
const invEl=document.getElementById('inventory');
function updateInventory(){
 invEl.innerHTML='';
 inventory.forEach((i,idx)=>{
  invEl.innerHTML+=`
   <div class="inv-item">
    <div onclick="selectUpgrade(${idx})"><img src="${i.img}"> ${i.name} üí∞${i.price}</div>
    <button onclick="sell(${idx})">–ü—Ä–æ–¥–∞—Ç—å</button>
   </div>`;
 });
}
function sell(i){
 balance+=inventory[i].price;
 inventory.splice(i,1);
 updateBal();updateInventory();
}

/* ===== TOP DROPS ===== */
let topDrops=JSON.parse(localStorage.getItem('topDrops')||'[]');
function updateTop(){
 topDrops=topDrops.sort((a,b)=>b.price-a.price).slice(0,5);
 document.getElementById('topDrops').innerHTML=
  topDrops.map(d=>`<div>${d.name} üí∞${d.price}</div>`).join('');
 localStorage.setItem('topDrops',JSON.stringify(topDrops));
}
updateTop();

/* ===== ROULETTE ===== */
const overlay=document.getElementById('overlay');
const track=document.getElementById('track');
const rewardImg=document.getElementById('rewardImg');
const result=document.getElementById('result');

function openCase(c){
 if(balance<c.price){tg.showAlert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç');return}
 balance-=c.price;updateBal();
 overlay.style.display='flex';
 track.innerHTML='';rewardImg.style.display='none';result.textContent='';
 for(let i=0;i<30;i++){
  const r=rewards[Math.floor(Math.random()*rewards.length)];
  track.innerHTML+=`<div class="item"><img src="${r.img}"><div>${r.name}</div></div>`;
 }
 setTimeout(()=>track.style.left=`-${600+Math.random()*900}px`,50);
 setTimeout(()=>{
  const r=spinReward(c);
  inventory.push(r);
  topDrops.push(r);
  updateInventory();updateTop();
  rewardImg.src=r.img;rewardImg.style.display='block';
  result.textContent=r.name;
 },3200);
}

function spinReward(c){
 const mod=balanceModifier();
 if(Math.random() > c.rtp*mod) return rewards[0];
 return rewards[Math.floor(Math.random()*rewards.length)];
}
function closeModal(){overlay.style.display='none'}

/* ===== UPGRADE WITH MULTI ===== */
let selected=null;
const targetSel=document.getElementById('upgradeTarget');
const chanceEl=document.getElementById('upgradeChance');

function selectUpgrade(i){
 selected=i;
 const base=inventory[i];
 document.getElementById('upgradeInfo').textContent='–í—ã–±—Ä–∞–Ω: '+base.name;
 targetSel.innerHTML=`
  <option value="2">x2</option>
  <option value="3">x3</option>
  <option value="5">x5</option>`;
 updateChance();
}
targetSel.onchange=updateChance;

function updateChance(){
 if(selected===null)return;
 const base=inventory[selected];
 const mult=Number(targetSel.value);
 const chance=Math.max(5,Math.round((base.price/(base.price*mult))*100));
 chanceEl.textContent='–®–∞–Ω—Å: '+chance+'%';
}

function upgrade(){
 if(selected===null){tg.showAlert('–í—ã–±–µ—Ä–∏ –ø—Ä–µ–¥–º–µ—Ç');return}
 const base=inventory[selected];
 const mult=Number(targetSel.value);
 const chance=(base.price/(base.price*mult))*100;
 if(Math.random()*100<chance){
  inventory[selected]={...base,price:Math.round(base.price*mult),name:base.name+' x'+mult};
 }else{
  inventory.splice(selected,1);
 }
 selected=null;
 updateInventory();
}

function topUp(){tg.showAlert('–ü–ª–∞—Ç–µ–∂–∏ –ø–æ–∑–∂–µ üí≥')}
</script>

</body>
</html>