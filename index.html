<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<title>Case Hunters</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="https://fonts.googleapis.com/css2?family=Russo+One&display=swap" rel="stylesheet">
<!-- PWA –º–µ—Ç–∞-—Ç–µ–≥–∏ -->
<meta name="theme-color" content="#0b0f14">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<style>
/* –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π CSS –¥–ª—è Telegram Web App */
:root{
  --bg:#0b0f14;
  --card:#111827;
  --accent:#facc15;
  --accent-dark:#eab308;
  --muted:#9ca3af;
  --green:#10b981;
  --red:#ef4444;
  --blue:#3b82f6;
  --purple:#8b5cf6;
  --cyan:#06b6d4;
  --yellow-line:#facc15;
  --glow: rgba(250,204,21,0.18);
  --shadow: 0 4px 20px rgba(0,0,0,.6);
  --card-gradient: linear-gradient(135deg,#1a2233,#111827);
}
*{margin:0;padding:0;box-sizing:border-box}
html{scroll-behavior:smooth}
body{
  font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif;
  background:var(--bg);
  color:#fff;
  -webkit-tap-highlight-color:transparent;
  -webkit-font-smoothing:antialiased;
  overflow-x:hidden;
  min-height:100vh;
  position:relative;
}

/* Loading Overlay */
#loadingOverlay{
  position:fixed;
  inset:0;
  background:var(--bg);
  z-index:9999;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  transition:opacity 0.3s ease;
}
#loadingOverlay.fade-out{
  opacity:0;
  pointer-events:none;
}
.loader{
  width:60px;
  height:60px;
  border:4px solid var(--accent);
  border-top-color:transparent;
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin:0 auto 20px;
}
@keyframes spin{
  100%{transform:rotate(360deg);}
}
.loading-progress{
  width:200px;
  height:4px;
  background:rgba(255,255,255,0.1);
  border-radius:2px;
  margin-top:20px;
  overflow:hidden;
}
.loading-progress-bar{
  height:100%;
  background:linear-gradient(90deg, var(--accent), #eab308);
  width:0%;
  transition:width 0.3s ease;
}

/* Top Bar */
#topBar{
  position:sticky;
  top:0;
  left:0;
  right:0;
  background:rgba(2, 6, 23, 0.95);
  padding:10px 12px;
  display:flex;
  flex-direction:column;
  gap:8px;
  box-shadow:var(--shadow);
  z-index:1000;
  backdrop-filter:blur(10px);
}
#logo{
  font-family:'Russo One',sans-serif;
  font-size:18px;
  color:var(--accent);
  letter-spacing:0.5px;
  text-align:center;
  width:100%;
  padding-bottom:8px;
  border-bottom:1px solid rgba(255,255,255,0.1);
}
.top-controls{
  display:flex;
  width:100%;
  gap:8px;
  align-items:center;
}
#balanceBox{
  padding:8px 12px;
  border-radius:10px;
  background:linear-gradient(135deg,var(--accent),var(--accent-dark));
  color:#020617;
  font-weight:700;
  font-size:14px;
  box-shadow:0 0 10px rgba(250,204,21,.5);
  white-space:nowrap;
  flex:1;
  text-align:center;
  transition:transform 0.3s ease;
  min-height:44px;
  display:flex;
  align-items:center;
  justify-content:center;
}
.top-buttons{
  display:flex;
  gap:6px;
  align-items:center;
}
.top-buttons .smallBtn{
  min-width:50px;
  text-align:center;
  padding:10px 12px;
  font-size:13px;
  min-height:44px;
}
#soundToggle{
  width:44px;
  height:44px;
  border-radius:50%;
  background:linear-gradient(135deg, var(--blue), #2563eb);
  border:none;
  color:white;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:16px;
  transition:all 0.3s ease;
  flex-shrink:0;
}
#soundToggle:hover{
  transform:scale(1.1);
}
#soundToggle.muted{
  background:linear-gradient(135deg, #6b7280, #4b5563);
}

/* Container */
.container{
  max-width:100%;
  margin:0 auto;
  padding:16px 10px 180px;
}
.section{
  background:var(--card);
  border-radius:14px;
  padding:16px;
  margin:12px 0;
  border:1px solid rgba(255,255,255,0.05);
  box-shadow:0 4px 12px rgba(0,0,0,.3);
}

/* Case Cards */
.case-wrapper{
  background:var(--card-gradient);
  border-radius:12px;
  padding:14px;
  margin:10px 0;
  border:1px solid rgba(255,255,255,0.05);
  position:relative;
  overflow:hidden;
}
.case-wrapper::before{
  content:'';
  position:absolute;
  top:0;
  left:-100%;
  width:100%;
  height:100%;
  background:linear-gradient(90deg, transparent, rgba(250,204,21,0.1), transparent);
  transition:left 0.7s ease;
}
.case-wrapper:hover::before{
  left:100%;
}
.case-wrapper .case-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:pointer;
  touch-action:manipulation;
  margin-bottom:12px;
}
.case-wrapper .case-header:active{
  transform:scale(0.98);
}
.case-wrapper:hover{
  border-color:rgba(250,204,21,0.3);
  box-shadow:0 0 20px rgba(250,204,21,0.2);
}
.case-wrapper .case-left{
  display:flex;
  gap:12px;
  align-items:center;
  flex:1;
}
.case-badge{
  width:60px;
  height:60px;
  border-radius:10px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:linear-gradient(135deg,var(--accent),var(--accent-dark));
  color:#000;
  font-weight:900;
  font-family:'Russo One',sans-serif;
  box-shadow:0 6px 20px var(--glow);
  font-size:12px;
  letter-spacing:1px;
  flex-shrink:0;
  transition:all 0.3s ease;
}
.case-wrapper:hover .case-badge{
  transform:rotate(5deg) scale(1.05);
  box-shadow:0 8px 25px rgba(250,204,21,0.4);
}
.case-wrapper .case-meta{
  flex:1;
}
.case-wrapper .case-meta .title{
  font-weight:bold;
  font-size:15px;
  margin-bottom:4px;
}
.case-wrapper .case-meta .sub{
  font-size:12px;
  color:var(--muted);
}
.case-wrapper .case-right{
  display:flex;
  flex-direction:column;
  align-items:flex-end;
  gap:6px;
}
.case-wrapper .case-open-btn{
  background:linear-gradient(135deg,var(--green),#0da271);
  border:none;
  padding:12px 18px;
  border-radius:10px;
  color:#fff;
  font-weight:600;
  font-size:13px;
  cursor:pointer;
  min-width:90px;
  min-height:44px;
  transition:all 0.2s;
  touch-action:manipulation;
  box-shadow:0 4px 12px rgba(16,185,129,0.3);
  position:relative;
  overflow:hidden;
}
.case-wrapper .case-open-btn::before{
  content:'';
  position:absolute;
  top:0;
  left:-100%;
  width:100%;
  height:100%;
  background:linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
  transition:left 0.5s;
}
.case-wrapper .case-open-btn:hover::before{
  left:100%;
}
.case-wrapper .case-open-btn:active{
  transform:scale(0.95);
}
.case-wrapper .case-open-btn:disabled{
  opacity:0.5;
  cursor:not-allowed;
  transform:none;
}

/* Roulette */
.case-roulette{
  width:100%;
  overflow:hidden;
  position:relative;
  border-radius:12px;
  height:130px;
  background:#071018;
  border:2px solid rgba(250,204,21,0.1);
  margin-top:12px;
  -webkit-overflow-scrolling:touch;
  display:none;
}
.roulette-track{
  display:flex;
  height:100%;
  will-change:transform;
  transform:translate3d(0,0,0);
  position:absolute;
  left:0;
  top:0;
  gap:0;
}
.roulette-item{
  width:120px;
  flex-shrink:0;
  text-align:center;
  padding:10px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  transition:all 0.3s ease;
  position:relative;
  border:1px solid transparent;
  margin:0;
}
.roulette-item .item-visual{
  width:80px;
  height:80px;
  border-radius:10px;
  background:linear-gradient(135deg,#0b0f14,#111827);
  display:flex;
  align-items:center;
  justify-content:center;
  margin:0 auto 6px;
  box-shadow:0 6px 20px rgba(0,0,0,.7);
  border:1px solid rgba(255,255,255,0.1);
  font-size:10px;
  font-weight:bold;
  color:var(--accent);
  text-align:center;
  padding:5px;
  overflow:hidden;
}
.roulette-item.active{
  animation:itemHighlight 0.8s ease-in-out;
  border:2px solid var(--accent);
  border-radius:10px;
  box-shadow:0 0 30px rgba(250,204,21,0.7);
  transform:scale(1.05);
  z-index:5;
}
@keyframes itemHighlight{
  0%,100%{transform:scale(1.05); box-shadow:0 0 30px rgba(250,204,21,0.7);}
  50%{transform:scale(1.08); box-shadow:0 0 40px rgba(250,204,21,0.9);}
}
.roulette-center-line{
  position:absolute;
  left:50%;
  top:0;
  transform:translateX(-50%);
  width:4px;
  height:100%;
  background:linear-gradient(180deg,var(--yellow-line),rgba(250,204,21,0.6));
  box-shadow:0 0 25px rgba(250,204,21,0.4);
  pointer-events:none;
  z-index:10;
}
.roulette-glow{
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  width:200px;
  height:200px;
  border-radius:50%;
  background:radial-gradient(circle, rgba(250,204,21,0.08), transparent 40%);
  pointer-events:none;
}

/* Buttons */
.smallBtn{
  background:var(--card-gradient);
  border:1px solid rgba(255,255,255,0.1);
  color:#fff;
  padding:12px 16px;
  border-radius:8px;
  cursor:pointer;
  font-size:13px;
  font-weight:500;
  transition:all 0.2s;
  touch-action:manipulation;
  user-select:none;
  min-width:70px;
  min-height:44px;
  position:relative;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
}
.smallBtn::after{
  content:'';
  position:absolute;
  top:50%;
  left:50%;
  width:5px;
  height:5px;
  background:rgba(255,255,255,0.5);
  opacity:0;
  border-radius:100%;
  transform:scale(1,1) translate(-50%);
  transform-origin:50% 50%;
}
.smallBtn:focus:not(:active)::after{
  animation:ripple 1s ease-out;
}
@keyframes ripple{
  0%{transform:scale(0,0); opacity:0.5;}
  20%{transform:scale(25,25); opacity:0.3;}
  100%{transform:scale(40,40); opacity:0;}
}
.smallBtn:active{
  transform:scale(0.95);
}

/* –ö–Ω–æ–ø–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è */
.copy-btn{
  background:linear-gradient(135deg, var(--blue), #2563eb);
  border:none;
  color:white;
  padding:12px 16px;
  border-radius:8px;
  cursor:pointer;
  font-size:13px;
  transition:all 0.2s;
  display:flex;
  align-items:center;
  gap:5px;
  touch-action:manipulation;
  position:relative;
  overflow:hidden;
  min-height:44px;
}
.copy-btn::before{
  content:'';
  position:absolute;
  top:0;
  left:-100%;
  width:100%;
  height:100%;
  background:linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
  transition:left 0.5s;
}
.copy-btn:hover::before{
  left:100%;
}
.copy-btn:active{
  transform:scale(0.95);
}
.copy-btn.copied{
  background:linear-gradient(135deg, var(--green), #0da271);
  animation:pulse 0.5s ease-in-out;
}
@keyframes pulse{
  0%{transform:scale(1);}
  50%{transform:scale(1.05);}
  100%{transform:scale(1);}
}

/* Win Modal */
#overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.95);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:2000;
  padding:16px;
  animation:fadeIn 0.3s ease;
}
#winResultBox{
  width:100%;
  max-width:400px;
  padding:24px;
  background:linear-gradient(135deg,#071018,#08121a);
  border-radius:18px;
  border:3px solid var(--accent);
  text-align:center;
  animation:slideUp 0.4s ease;
  box-shadow:0 20px 40px rgba(0,0,0,0.5);
}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes slideUp{from{transform:translateY(30px);opacity:0}to{transform:translateY(0);opacity:1}}
#winResultBox img{
  width:160px;
  height:160px;
  border-radius:12px;
  margin:0 auto 16px;
  box-shadow:0 0 50px rgba(250,204,21,.3);
  object-fit:cover;
  border:2px solid rgba(250,204,21,0.3);
  animation:float 3s ease-in-out infinite;
}
@keyframes float{
  0%,100%{transform:translateY(0px);}
  50%{transform:translateY(-10px);}
}
#winResultBox .winTitle{
  font-size:22px;
  font-weight:800;
  color:var(--accent);
  margin-bottom:10px;
  line-height:1.2;
}
#winResultBox .winPrice{
  font-size:18px;
  color:#4ecdc4;
  margin-bottom:8px;
  font-weight:600;
}
#winResultBox .winNote{
  font-size:14px;
  color:#cbd5e1;
  margin-bottom:20px;
}

/* Inventory */
.item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:var(--card-gradient);
  border-radius:10px;
  padding:14px;
  margin:8px 0;
  border:1px solid rgba(255,255,255,0.05);
  transition:all 0.3s ease;
  position:relative;
  overflow:hidden;
}
.item::before{
  content:'';
  position:absolute;
  top:0;
  left:-100%;
  width:100%;
  height:100%;
  background:linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
  transition:left 0.7s ease;
}
.item:hover::before{
  left:100%;
}
.item.fade-out{
  animation:fadeOutItem 0.5s ease forwards;
}
@keyframes fadeOutItem{
  0%{opacity:1;transform:scale(1)}
  50%{opacity:0.5;transform:scale(0.95)}
  100%{opacity:0;transform:scale(0.9);height:0;margin:0;padding:0}
}
.weapon-img{
  width:60px;
  height:60px;
  border-radius:8px;
  object-fit:cover;
  box-shadow:0 4px 12px rgba(0,0,0,.5);
  background:#0b0f14;
  flex-shrink:0;
  border:1px solid rgba(255,255,255,0.1);
  transition:all 0.3s ease;
}
.item:hover .weapon-img{
  transform:rotate(5deg) scale(1.05);
  box-shadow:0 8px 20px rgba(0,0,0,0.7);
}

/* Chat */
.chatBox{
  width:100%;
  max-height:320px;
  background:#0b1220;
  border-radius:10px;
  padding:12px;
  overflow-y:auto;
  border:1px solid #16202a;
  -webkit-overflow-scrolling:touch;
}
.chatMessage{
  padding:10px;
  border-radius:8px;
  margin-bottom:10px;
  background:linear-gradient(135deg,#071018,#08121a);
  font-size:13px;
  line-height:1.4;
  border:1px solid rgba(255,255,255,0.05);
  transition:all 0.3s ease;
}
.chatMessage:hover{
  transform:translateX(5px);
  border-color:rgba(250,204,21,0.2);
}
.chatMessage .meta{
  font-size:11px;
  color:var(--muted);
  margin-bottom:6px;
  display:flex;
  justify-content:space-between;
}

/* Admin Panel */
#adminPanel{
  position:fixed;
  right:12px;
  top:100px;
  background:#0b1220;
  border:1px solid #1f2937;
  padding:16px;
  border-radius:12px;
  z-index:1000;
  min-width:280px;
  display:none;
  box-shadow:var(--shadow);
  backdrop-filter:blur(10px);
  animation:slideInRight 0.3s ease;
}
@keyframes slideInRight{
  from{transform:translateX(100%); opacity:0;}
  to{transform:translateX(0); opacity:1;}
}
#adminPanel h4{
  margin:0 0 10px 0;
  color:var(--accent);
  font-size:16px;
}
.adminRow{
  display:flex;
  gap:8px;
  align-items:center;
  margin-bottom:10px;
}
.adminRow input, .adminRow select{
  padding:10px;
  border-radius:6px;
  border:1px solid #2b3440;
  background:#071018;
  color:#fff;
  font-size:13px;
  flex:1;
  transition:all 0.3s ease;
  min-height:44px;
}
.adminRow input:focus, .adminRow select:focus{
  outline:none;
  border-color:var(--accent);
  box-shadow:0 0 0 2px rgba(250,204,21,0.1);
}
.adminBtn{
  background:var(--card-gradient);
  border:1px solid #2b3440;
  color:#fff;
  padding:12px 16px;
  border-radius:8px;
  cursor:pointer;
  font-size:13px;
  transition:all 0.2s;
  min-height:44px;
}
.adminBtn:active{
  transform:scale(0.95);
}

/* Bank Modal */
#bankOverlay{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.9);
  z-index:1500;
  align-items:center;
  justify-content:center;
  padding:16px;
  animation:fadeIn 0.3s ease;
}
#bankModal{
  background:#181d27;
  border-radius:14px;
  box-shadow:0 20px 40px rgba(0,0,0,0.5);
  padding:24px;
  max-width:400px;
  width:90%;
  border:2px solid rgba(250,204,21,0.2);
  animation:scaleUp 0.4s ease;
}
@keyframes scaleUp{
  from{transform:scale(0.9); opacity:0;}
  to{transform:scale(1); opacity:1;}
}
#amountInput{
  padding:12px;
  border-radius:8px;
  border:1px solid #2b3440;
  background:#0b1220;
  color:#fff;
  font-size:15px;
  text-align:center;
  width:100%;
  margin-bottom:14px;
  transition:all 0.3s ease;
  min-height:44px;
}
#amountInput:focus{
  outline:none;
  border-color:var(--accent);
  box-shadow:0 0 0 2px rgba(250,204,21,0.1);
}

/* Upgrade Panel - –£–õ–£–ß–®–ï–ù–ù–´–ô –î–ò–ó–ê–ô–ù */
#upgradePanel{
  position:relative;
  background:linear-gradient(135deg,#071018,#0a1524);
  border-radius:14px;
  padding:20px;
  margin:16px 0;
  border:2px solid rgba(250,204,21,0.2);
  overflow:hidden;
  scroll-margin-top:80px;
}
#upgradePanel::before{
  content:'';
  position:absolute;
  top:0;
  left:0;
  right:0;
  height:4px;
  background:linear-gradient(90deg, var(--accent), var(--accent-dark), var(--accent));
  background-size:200% 100%;
  animation:shimmer 2s infinite linear;
}
@keyframes shimmer{
  0%{background-position:200% 0}
  100%{background-position:-200% 0}
}
.upgrade-container{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:20px;
  flex-wrap:wrap;
}
.upgrade-left{
  flex:1;
  min-width:250px;
}
.upgrade-right{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:16px;
}
.upgrade-wheel-container{
  position:relative;
  width:140px;
  height:140px;
}
.upgrade-wheel{
  width:100%;
  height:100%;
  border-radius:50%;
  border:3px solid var(--accent);
  position:relative;
  display:flex;
  align-items:center;
  justify-content:center;
  background:radial-gradient(circle,#111827,#020617);
  box-shadow:0 0 40px rgba(250,204,21,0.3);
  transition:transform 3s cubic-bezier(0.2,0.9,0.2,1);
  overflow:hidden;
}
.upgrade-wheel.spinning{
  animation:wheelSpin 0.5s linear infinite;
}
@keyframes wheelSpin{
  0%{transform:rotate(0deg);}
  100%{transform:rotate(360deg);}
}
.upgrade-wheel::before{
  content:'';
  position:absolute;
  width:110%;
  height:110%;
  border-radius:50%;
  background:conic-gradient(transparent, var(--accent), var(--purple), var(--blue), transparent);
  animation:wheelGlow 4s linear infinite;
  opacity:0.3;
}
@keyframes wheelGlow{
  0%{transform:rotate(0deg);}
  100%{transform:rotate(360deg);}
}
.upgrade-wheel .inner{
  width:70%;
  height:70%;
  border-radius:50%;
  background:rgba(11,15,20,0.9);
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  z-index:2;
  position:relative;
  border:2px solid rgba(255,255,255,0.1);
}
.wheel-pointer{
  position:absolute;
  top:-12px;
  left:50%;
  transform:translateX(-50%);
  width:0;
  height:0;
  border-left:10px solid transparent;
  border-right:10px solid transparent;
  border-bottom:15px solid var(--accent);
  z-index:10;
  filter:drop-shadow(0 0 5px var(--accent));
}
.upgrade-buttons{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  justify-content:center;
}
.upgrade-btn{
  padding:12px 20px;
  border-radius:10px;
  border:none;
  color:white;
  font-weight:600;
  cursor:pointer;
  transition:all 0.3s;
  min-width:100px;
  position:relative;
  overflow:hidden;
}
.upgrade-btn::before{
  content:'';
  position:absolute;
  top:0;
  left:-100%;
  width:100%;
  height:100%;
  background:linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
  transition:left 0.5s;
}
.upgrade-btn:hover::before{
  left:100%;
}
.upgrade-btn:active{
  transform:scale(0.95);
}
#upgrade2xBtn{
  background:linear-gradient(135deg, var(--blue), #2563eb);
  box-shadow:0 4px 15px rgba(59,130,246,0.3);
}
#upgrade3xBtn{
  background:linear-gradient(135deg, var(--purple), #7c3aed);
  box-shadow:0 4px 15px rgba(139,92,246,0.3);
}
#upgradeResultSmall{
  text-align:center;
  min-height:40px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:14px;
  color:var(--accent);
  font-weight:500;
}

/* Upgrade Animations */
@keyframes upgradeSuccess{
  0%{transform:scale(1);box-shadow:0 0 20px rgba(250,204,21,0.3)}
  50%{transform:scale(1.15);box-shadow:0 0 60px rgba(250,204,21,0.8)}
  100%{transform:scale(1);box-shadow:0 0 20px rgba(250,204,21,0.3)}
}
@keyframes upgradeFail{
  0%{transform:scale(1);filter:brightness(1)}
  25%{transform:scale(1.05);filter:brightness(1.2)}
  50%{transform:scale(0.95);filter:brightness(1.5)}
  75%{transform:scale(1.02);filter:brightness(1.8)}
  100%{transform:scale(1);filter:brightness(1)}
}
@keyframes itemBurn{
  0%{transform:scale(1);filter:brightness(1)}
  25%{transform:scale(1.1);filter:brightness(1.5)}
  50%{transform:scale(1);filter:brightness(2)}
  75%{transform:scale(0.9);filter:brightness(2.5)}
  100%{transform:scale(0);filter:brightness(3);opacity:0}
}
.upgrade-success{
  animation:upgradeSuccess 0.8s ease-in-out;
}
.upgrade-fail{
  animation:upgradeFail 0.8s ease-in-out;
}
.item-burn{
  animation:itemBurn 1s ease-in-out forwards;
}

/* Online & Chat Widgets */
.online-chat-container{
  position:sticky;
  top:100px;
  z-index:10;
}
.online-widget{
  background:linear-gradient(135deg,#071018,#08121a);
  border-radius:12px;
  padding:16px;
  margin-bottom:14px;
  border:1px solid rgba(255,255,255,0.05);
  position:relative;
  overflow:hidden;
}
.online-widget::before{
  content:'';
  position:absolute;
  top:0;
  left:0;
  right:0;
  height:3px;
  background:linear-gradient(90deg, var(--blue), var(--purple));
}
.online-count{
  font-size:32px;
  font-weight:800;
  color:var(--accent);
  margin:6px 0;
  text-shadow:0 0 10px rgba(250,204,21,0.3);
  transition:all 0.5s ease;
}

/* Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
.toast{
  position:fixed;
  top:16px;
  right:16px;
  padding:12px 16px;
  background:linear-gradient(135deg, #071018, #08121a);
  border-left:4px solid var(--accent);
  border-radius:6px;
  color:white;
  font-size:13px;
  box-shadow:0 4px 15px rgba(0,0,0,0.3);
  z-index:9999;
  transform:translateX(120%);
  transition:transform 0.3s ease;
  max-width:280px;
}
.toast.show{
  transform:translateX(0);
}
.toast.success{border-left-color:var(--green);}
.toast.error{border-left-color:var(--red);}
.toast.info{border-left-color:var(--blue);}
.toast.warning{border-left-color:var(--accent);}

/* –≠—Ñ—Ñ–µ–∫—Ç—ã —á–∞—Å—Ç–∏—Ü */
.particle{
  position:absolute;
  pointer-events:none;
  z-index:100;
  opacity:0;
}
@keyframes particleFly{
  0%{transform:translate(0,0) rotate(0deg); opacity:1;}
  100%{transform:translate(var(--tx), var(--ty)) rotate(360deg); opacity:0;}
}

/* –ê–Ω–∏–º–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–∞ */
@keyframes balanceIncrease{
  0%{transform:scale(1);}
  50%{transform:scale(1.1);}
  100%{transform:scale(1);}
}
.balance-increase{
  animation:balanceIncrease 0.5s ease-in-out;
}

/* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ */
.achievement-notification{
  position:fixed;
  top:20px;
  left:50%;
  transform:translateX(-50%) translateY(-100px);
  background:linear-gradient(135deg, #1a1f2e, #111827);
  border-radius:12px;
  padding:16px;
  display:flex;
  align-items:center;
  gap:12px;
  box-shadow:0 10px 30px rgba(0,0,0,0.5);
  border:2px solid var(--accent);
  z-index:9998;
  min-width:300px;
  transition:transform 0.5s cubic-bezier(0.2,0.8,0.2,1);
}
.achievement-notification.show{
  transform:translateX(-50%) translateY(0);
}
.achievement-icon{
  font-size:32px;
  animation:bounce 1s infinite;
}
@keyframes bounce{
  0%,100%{transform:translateY(0);}
  50%{transform:translateY(-5px);}
}
.achievement-content{
  flex:1;
}
.achievement-title{
  font-weight:bold;
  font-size:16px;
  color:var(--accent);
  margin-bottom:4px;
}
.achievement-desc{
  font-size:13px;
  color:var(--muted);
  margin-bottom:4px;
}
.achievement-reward{
  font-size:14px;
  font-weight:bold;
  color:var(--green);
}

/* –°–µ–∫—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 12px;
  margin-top: 12px;
}
.stat-item {
  background: rgba(255,255,255,0.05);
  padding: 16px;
  border-radius: 10px;
  text-align: center;
  border: 1px solid rgba(255,255,255,0.1);
  transition: all 0.3s ease;
}
.stat-item:hover {
  transform: translateY(-2px);
  border-color: rgba(250,204,21,0.3);
  box-shadow: 0 5px 15px rgba(250,204,21,0.1);
}
.stat-value {
  font-size: 24px;
  font-weight: bold;
  color: var(--accent);
  margin-top: 8px;
}

/* –°–æ–±—ã—Ç–∏—è */
.event-banner {
  background: linear-gradient(135deg, var(--purple), #7c3aed);
  padding: 16px;
  border-radius: 12px;
  margin-bottom: 20px;
  text-align: center;
  border: 2px solid rgba(255,255,255,0.2);
  animation: pulse 2s infinite;
  position: relative;
  overflow: hidden;
}
.event-banner::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
  animation: shimmer 3s infinite linear;
}

/* Leaderboard */
.leaderboard {
  background: var(--card-gradient);
  border-radius: 12px;
  padding: 16px;
  margin: 16px 0;
  border: 1px solid rgba(255,255,255,0.1);
}
.leaderboard-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
  padding-bottom: 12px;
  border-bottom: 1px solid rgba(255,255,255,0.1);
}
.leaderboard-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
}
.leaderboard-item {
  display: grid;
  grid-template-columns: auto 1fr auto auto;
  gap: 12px;
  align-items: center;
  padding: 12px;
  background: rgba(255,255,255,0.03);
  border-radius: 8px;
  border: 1px solid transparent;
  transition: all 0.3s ease;
}
.leaderboard-item:hover {
  border-color: rgba(250,204,21,0.2);
  background: rgba(250,204,21,0.05);
}
.leaderboard-item.current-player {
  background: rgba(250,204,21,0.1);
  border-color: var(--accent);
}
.leaderboard-rank {
  width: 30px;
  height: 30px;
  background: linear-gradient(135deg, var(--accent), var(--accent-dark));
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: #000;
}
.leaderboard-name {
  font-weight: 500;
}
.leaderboard-balance {
  font-weight: bold;
  color: var(--accent);
}
.leaderboard-cases {
  font-size: 12px;
  color: var(--muted);
}

/* –ë–æ–Ω—É—Å–Ω–æ–µ –∫–æ–ª–µ—Å–æ */
.bonus-wheel-container {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.9);
  z-index: 3000;
  display: none;
  align-items: center;
  justify-content: center;
  padding: 20px;
}
.bonus-wheel-modal {
  background: linear-gradient(135deg, #071018, #0a1524);
  border-radius: 20px;
  padding: 30px;
  max-width: 500px;
  width: 90%;
  border: 3px solid var(--accent);
  text-align: center;
  position: relative;
  overflow: hidden;
}
.bonus-wheel-modal::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, var(--accent), var(--purple), var(--blue), var(--accent));
  animation: shimmer 3s infinite linear;
}
.bonus-wheel-spins {
  font-size: 18px;
  color: var(--accent);
  margin-bottom: 20px;
  font-weight: bold;
}
.spin-wheel-btn {
  background: linear-gradient(135deg, var(--accent), var(--accent-dark));
  border: none;
  color: #000;
  padding: 15px 30px;
  border-radius: 10px;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  margin-top: 20px;
  transition: all 0.3s;
}
.spin-wheel-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 0 30px rgba(250,204,21,0.4);
}

/* –ó–∞–¥–∞–Ω–∏—è */
.daily-quests {
  background: linear-gradient(135deg, #0f172a, #1e293b);
  border-radius: 12px;
  padding: 20px;
  margin: 16px 0;
  border: 2px solid rgba(250,204,21,0.2);
}
.quest-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px;
  background: rgba(255,255,255,0.05);
  border-radius: 8px;
  margin-bottom: 10px;
  border: 1px solid rgba(255,255,255,0.1);
}
.quest-progress {
  flex: 1;
  margin: 0 16px;
}
.progress-bar {
  height: 8px;
  background: rgba(255,255,255,0.1);
  border-radius: 4px;
  overflow: hidden;
}
.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--accent), var(--accent-dark));
  border-radius: 4px;
  transition: width 0.3s ease;
}
.quest-reward {
  font-weight: bold;
  color: var(--accent);
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
  .upgrade-container {
    flex-direction: column;
    text-align: center;
  }
  .upgrade-left, .upgrade-right {
    width: 100%;
  }
  .stats-grid {
    grid-template-columns: 1fr;
  }
  .leaderboard-item {
    grid-template-columns: auto 1fr auto;
  }
  .leaderboard-cases {
    display: none;
  }
}

@media (max-width: 480px) {
  .top-controls {
    flex-direction: column;
    gap: 12px;
  }
  .top-buttons {
    width: 100%;
    justify-content: space-between;
  }
  .case-wrapper .case-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 12px;
  }
  .case-wrapper .case-right {
    width: 100%;
    align-items: stretch;
  }
  .case-wrapper .case-open-btn {
    width: 100%;
  }
}

@media(min-width:481px){
  #topBar{
    flex-direction:row;
    align-items:center;
    padding:12px 16px;
  }
  #logo{
    text-align:left;
    width:auto;
    padding-bottom:0;
    border-bottom:none;
    flex:1;
  }
  .top-controls{
    width:auto;
    flex:2;
  }
  #balanceBox{
    flex:none;
  }
  .stats-grid {
    grid-template-columns: repeat(4, 1fr);
  }
}

@media (min-width: 768px) {
  .container {
    max-width: 768px;
    margin: 0 auto;
  }
}
</style>

<!-- Telegram Web App SDK -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<script>
// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
const CONFIG = {
  STORAGE_PREFIX: 'ch_',
  DEMO_PASSWORD: '!125125Cc',
  DEFAULT_RTP: 0.40,
  UPGRADE_RTP_2X: 0.50,
  UPGRADE_RTP_3X: 0.20,
  SPIN_DURATION: 9000,
  CHAT_UPDATE_INTERVAL: 7000,
  REFERRAL_PERCENT: 0.30,
  MIN_WITHDRAWAL: 500,
  MIN_DEPOSIT: 100,
  BOT_USERNAME: 'casehunter_bot'
};

// –í—Å–µ –∫–µ–π—Å—ã —Å —Ü–µ–Ω–∞–º–∏
const CASES = [
  {
    id: 'case1',
    name: '–ë–∞–∑–æ–≤—ã–π –ö–µ–π—Å',
    price: 50,
    baseItems: [
      { id: 's1', name: 'P250 | Sand Dune', price: 50, baseChance: 40 },
      { id: 's2', name: 'Glock-18 | Sandstorm', price: 60, baseChance: 30 },
      { id: 's3', name: 'MAC-10 | Indigo', price: 70, baseChance: 15 },
      { id: 's4', name: 'UMP-45 | Arctic Wolf', price: 90, baseChance: 10 },
      { id: 's5', name: 'Five-SeveN | Forest Night', price: 120, baseChance: 5 }
    ]
  },
  {
    id: 'case2',
    name: '–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ö–µ–π—Å',
    price: 100,
    baseItems: [
      { id: 'g1', name: 'AK-47 | Redline', price: 120, baseChance: 25 },
      { id: 'g2', name: 'M4A1-S | Guardian', price: 150, baseChance: 25 },
      { id: 'g3', name: 'AWP | Electric Hive', price: 180, baseChance: 20 },
      { id: 'g4', name: 'Desert Eagle | Crimson Web', price: 220, baseChance: 15 },
      { id: 'g5', name: 'P90 | Asiimov', price: 280, baseChance: 10 },
      { id: 'g6', name: 'USP-S | Orion', price: 350, baseChance: 5 }
    ]
  },
  {
    id: 'case3',
    name: '–ü—Ä–µ–º–∏—É–º –ö–µ–π—Å',
    price: 150,
    baseItems: [
      { id: 'p1', name: 'AWP | Asiimov', price: 200, baseChance: 20 },
      { id: 'p2', name: 'AK-47 | Vulcan', price: 300, baseChance: 20 },
      { id: 'p3', name: 'M4A4 | Desolate Space', price: 400, baseChance: 15 },
      { id: 'p4', name: 'Karambit | Blue Steel', price: 800, baseChance: 15 },
      { id: 'p5', name: 'M9 Bayonet | Doppler', price: 1200, baseChance: 10 },
      { id: 'p6', name: 'Butterfly Knife | Fade', price: 1800, baseChance: 10 },
      { id: 'p7', name: 'Dragon Lore | AWP', price: 2500, baseChance: 10 }
    ]
  },
  {
    id: 'case4',
    name: '–≠–ª–∏—Ç–Ω—ã–π –ö–µ–π—Å',
    price: 200,
    baseItems: [
      { id: 'e1', name: 'AWP | Dragon Lore', price: 300, baseChance: 15 },
      { id: 'e2', name: 'AK-47 | Fire Serpent', price: 500, baseChance: 15 },
      { id: 'e3', name: 'M4A1-S | Hot Rod', price: 800, baseChance: 15 },
      { id: 'e4', name: 'Karambit | Fade', price: 1200, baseChance: 15 },
      { id: 'e5', name: 'Butterfly Knife | Crimson Web', price: 1800, baseChance: 12 },
      { id: 'e6', name: 'M9 Bayonet | Marble Fade', price: 2200, baseChance: 12 },
      { id: 'e7', name: 'Sport Gloves | Vice', price: 3000, baseChance: 8 },
      { id: 'e8', name: 'Karambit | Sapphire', price: 4500, baseChance: 8 }
    ]
  },
  {
    id: 'case5',
    name: '–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –ö–µ–π—Å',
    price: 250,
    baseItems: [
      { id: 'l1', name: 'AWP | Medusa', price: 500, baseChance: 12 },
      { id: 'l2', name: 'AK-47 | Fire Serpent ST', price: 900, baseChance: 12 },
      { id: 'l3', name: 'M4A4 | Howl ST', price: 1500, baseChance: 12 },
      { id: 'l4', name: 'Sport Gloves | Pandora', price: 2400, baseChance: 12 },
      { id: 'l5', name: 'Karambit | Emerald', price: 3500, baseChance: 10 },
      { id: 'l6', name: 'Butterfly Knife | Sapphire', price: 4200, baseChance: 10 },
      { id: 'l7', name: 'M9 Bayonet | Ruby', price: 3800, baseChance: 10 },
      { id: 'l8', name: 'Dragon Lore ST | AWP', price: 5000, baseChance: 10 },
      { id: 'l9', name: 'Gloves | Crimson Kimono', price: 6000, baseChance: 6 },
      { id: 'l10', name: 'Karambit | Case Hardened #1', price: 7500, baseChance: 6 }
    ]
  }
];

// –ö–ª–∞—Å—Å —Å–∏—Å—Ç–µ–º—ã –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
class AchievementSystem {
  constructor(game) {
    this.game = game;
    this.achievements = this.loadAchievements();
    this.completed = this.loadCompleted();
  }

  loadAchievements() {
    return [
      { id: 'first_case', name: '–ù–æ–≤–∏—á–æ–∫', desc: '–û—Ç–∫—Ä–æ–π—Ç–µ –ø–µ—Ä–≤—ã–π –∫–µ–π—Å', reward: 100, icon: 'ü•á' },
      { id: 'rich_man', name: '–ë–æ–≥–∞—á', desc: '–î–æ—Å—Ç–∏–≥–Ω–∏—Ç–µ –±–∞–ª–∞–Ω—Å–∞ 1000 ‚ÇΩ', reward: 500, icon: 'üí∞' },
      { id: 'collector', name: '–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä', desc: '–°–æ–±–µ—Ä–∏—Ç–µ 10 –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ', reward: 300, icon: 'üéí' },
      { id: 'upgrade_master', name: '–ú–∞—Å—Ç–µ—Ä –∞–ø–≥—Ä–µ–π–¥–∞', desc: '–£—Å–ø–µ—à–Ω–æ –∞–ø–≥—Ä–µ–π–¥–Ω–∏—Ç–µ 5 –ø—Ä–µ–¥–º–µ—Ç–æ–≤', reward: 400, icon: '‚ö°' },
      { id: 'case_addict', name: '–ö–µ–π—Å–æ–≥–æ–ª–∏–∫', desc: '–û—Ç–∫—Ä–æ–π—Ç–µ 50 –∫–µ–π—Å–æ–≤', reward: 1000, icon: 'üéÆ' },
      { id: 'lucky_one', name: '–í–µ–∑—É–Ω—á–∏–∫', desc: '–í—ã–∏–≥—Ä–∞–π—Ç–µ –ø—Ä–µ–¥–º–µ—Ç –¥–æ—Ä–æ–∂–µ 5000 ‚ÇΩ', reward: 800, icon: 'üçÄ' },
      { id: 'trader', name: '–¢—Ä–µ–π–¥–µ—Ä', desc: '–ü—Ä–æ–¥–∞–π—Ç–µ 20 –ø—Ä–µ–¥–º–µ—Ç–æ–≤', reward: 600, icon: 'üíº' },
      { id: 'inviter', name: '–ü—Ä–∏–≥–ª–∞—à–∞—Ç–µ–ª—å', desc: '–ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ 5 –¥—Ä—É–∑–µ–π', reward: 700, icon: 'üë•' },
      { id: 'wheel_spinner', name: '–ö—Ä—É—Ç–∏–ª—å—â–∏–∫', desc: '–°–¥–µ–ª–∞–π—Ç–µ 10 –≤—Ä–∞—â–µ–Ω–∏–π –∫–æ–ª–µ—Å–∞ —É–¥–∞—á–∏', reward: 400, icon: 'üé°' },
      { id: 'quest_completer', name: '–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å', desc: '–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è –∑–∞ –¥–µ–Ω—å', reward: 500, icon: '‚úÖ' }
    ];
  }

  loadCompleted() {
    const key = CONFIG.STORAGE_PREFIX + 'achievements_' + this.game.userId;
    try {
      return JSON.parse(localStorage.getItem(key)) || [];
    } catch {
      return [];
    }
  }

  checkAchievements() {
    const stats = this.game.dataCollector.stats;
    
    this.achievements.forEach(achievement => {
      if (!this.completed.includes(achievement.id)) {
        let completed = false;
        
        switch(achievement.id) {
          case 'first_case':
            completed = stats.casesOpened >= 1;
            break;
          case 'rich_man':
            completed = this.game.state.balance >= 1000;
            break;
          case 'collector':
            completed = this.game.state.inventory.length >= 10;
            break;
          case 'upgrade_master':
            completed = stats.upgradesSuccess >= 5;
            break;
          case 'case_addict':
            completed = stats.casesOpened >= 50;
            break;
          case 'lucky_one':
            completed = this.game.state.inventory.some(item => item.price >= 5000);
            break;
          case 'trader':
            completed = stats.itemsSold >= 20;
            break;
          case 'wheel_spinner':
            completed = this.game.bonusWheel?.totalSpins >= 10;
            break;
        }
        
        if (completed) {
          this.unlockAchievement(achievement);
        }
      }
    });
  }

  unlockAchievement(achievement) {
    this.completed.push(achievement.id);
    this.saveCompleted();
    
    this.game.addBalance(achievement.reward);
    this.showAchievementNotification(achievement);
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ —á–∞—Ç
    this.game.pushFakeChat(`${this.game.getRandomName()} –ø–æ–ª—É—á–∏–ª –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ "${achievement.name}"!`, '–°–∏—Å—Ç–µ–º–∞');
  }

  showAchievementNotification(achievement) {
    const notification = document.createElement('div');
    notification.className = 'achievement-notification';
    notification.innerHTML = `
      <div class="achievement-icon">${achievement.icon}</div>
      <div class="achievement-content">
        <div class="achievement-title">${achievement.name}</div>
        <div class="achievement-desc">${achievement.desc}</div>
        <div class="achievement-reward">+${achievement.reward} ‚ÇΩ</div>
      </div>
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => notification.classList.add('show'), 100);
    setTimeout(() => {
      notification.classList.remove('show');
      setTimeout(() => notification.remove(), 300);
    }, 4000);
  }

  saveCompleted() {
    const key = CONFIG.STORAGE_PREFIX + 'achievements_' + this.game.userId;
    localStorage.setItem(key, JSON.stringify(this.completed));
  }

  renderAchievements() {
    const completedCount = this.completed.length;
    const totalCount = this.achievements.length;
    
    return `
      <div class="section">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
          <div style="font-weight:bold;font-size:17px">üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</div>
          <div style="font-size:14px;color:var(--muted)">${completedCount}/${totalCount}</div>
        </div>
        <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:12px">
          ${this.achievements.map(ach => `
            <div style="
              background:${this.completed.includes(ach.id) ? 'rgba(250,204,21,0.1)' : 'rgba(255,255,255,0.05)'};
              padding:12px;
              border-radius:8px;
              text-align:center;
              border:1px solid ${this.completed.includes(ach.id) ? 'var(--accent)' : 'rgba(255,255,255,0.1)'};
              opacity:${this.completed.includes(ach.id) ? '1' : '0.7'};
            ">
              <div style="font-size:24px;margin-bottom:8px">${ach.icon}</div>
              <div style="font-weight:bold;font-size:13px;margin-bottom:4px">${ach.name}</div>
              <div style="font-size:11px;color:var(--muted);margin-bottom:8px">${ach.desc}</div>
              <div style="font-size:12px;color:var(--accent);font-weight:bold">${ach.reward} ‚ÇΩ</div>
            </div>
          `).join('')}
        </div>
      </div>
    `;
  }
}

// –ö–ª–∞—Å—Å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π
class DailyQuests {
  constructor(game) {
    this.game = game;
    this.quests = this.loadQuests();
    this.lastReset = this.getLastReset();
  }

  loadQuests() {
    const key = CONFIG.STORAGE_PREFIX + 'daily_quests_' + this.game.userId;
    try {
      const saved = JSON.parse(localStorage.getItem(key));
      if (saved && this.isToday(new Date(saved.date))) {
        return saved.quests;
      }
    } catch {}
    
    return this.generateQuests();
  }

  generateQuests() {
    const questTypes = [
      { type: 'open_cases', name: '–ö–µ–π—Å-–º–∞—Ä–∞—Ñ–æ–Ω', desc: '–û—Ç–∫—Ä–æ–π—Ç–µ 5 –∫–µ–π—Å–æ–≤', target: 5, reward: 200, icon: 'üéÅ' },
      { type: 'sell_items', name: '–ü—Ä–æ–¥–∞–≤–µ—Ü', desc: '–ü—Ä–æ–¥–∞–π—Ç–µ 3 –ø—Ä–µ–¥–º–µ—Ç–∞', target: 3, reward: 150, icon: 'üí∞' },
      { type: 'upgrade_success', name: '–£–¥–∞—á–∞ –≤ –∞–ø–≥—Ä–µ–π–¥–µ', desc: '–£—Å–ø–µ—à–Ω–æ –∞–ø–≥—Ä–µ–π–¥–Ω–∏—Ç–µ 2 –ø—Ä–µ–¥–º–µ—Ç–∞', target: 2, reward: 300, icon: '‚ö°' },
      { type: 'big_win', name: '–ö—Ä—É–ø–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à', desc: '–í—ã–∏–≥—Ä–∞–π—Ç–µ –ø—Ä–µ–¥–º–µ—Ç –¥–æ—Ä–æ–∂–µ 1000 ‚ÇΩ', target: 1000, reward: 500, icon: 'üéØ' },
      { type: 'use_wheel', name: '–ö–æ–ª–µ—Å–æ —É–¥–∞—á–∏', desc: '–°–¥–µ–ª–∞–π—Ç–µ 2 –≤—Ä–∞—â–µ–Ω–∏—è –∫–æ–ª–µ—Å–∞', target: 2, reward: 250, icon: 'üé°' }
    ];

    // –í—ã–±–∏—Ä–∞–µ–º 3 —Å–ª—É—á–∞–π–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏—è
    const shuffled = [...questTypes].sort(() => Math.random() - 0.5).slice(0, 3);
    
    // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
    return shuffled.map(q => ({
      ...q,
      progress: 0,
      completed: false
    }));
  }

  isToday(date) {
    const today = new Date();
    return date.getDate() === today.getDate() &&
           date.getMonth() === today.getMonth() &&
           date.getFullYear() === today.getFullYear();
  }

  getLastReset() {
    const key = CONFIG.STORAGE_PREFIX + 'last_quest_reset_' + this.game.userId;
    const saved = localStorage.getItem(key);
    return saved ? new Date(saved) : new Date(0);
  }

  checkReset() {
    const now = new Date();
    if (!this.isToday(this.lastReset)) {
      this.quests = this.generateQuests();
      this.lastReset = now;
      this.saveQuests();
    }
  }

  updateProgress(type, amount = 1) {
    this.checkReset();
    
    let updated = false;
    this.quests.forEach(quest => {
      if (!quest.completed && quest.type === type) {
        quest.progress += amount;
        
        if (quest.progress >= quest.target) {
          quest.completed = true;
          quest.progress = quest.target;
          this.completeQuest(quest);
        }
        
        updated = true;
      }
    });
    
    if (updated) {
      this.saveQuests();
      this.renderQuests();
    }
  }

  completeQuest(quest) {
    this.game.addBalance(quest.reward);
    this.game.showToast(`‚úÖ –ó–∞–¥–∞–Ω–∏–µ "${quest.name}" –≤—ã–ø–æ–ª–Ω–µ–Ω–æ! +${quest.reward} ‚ÇΩ`, 'success');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ
    if (this.quests.every(q => q.completed)) {
      this.game.achievementSystem.checkAchievements();
    }
  }

  saveQuests() {
    const key = CONFIG.STORAGE_PREFIX + 'daily_quests_' + this.game.userId;
    localStorage.setItem(key, JSON.stringify({
      date: new Date().toISOString(),
      quests: this.quests
    }));
  }

  renderQuests() {
    const completedCount = this.quests.filter(q => q.completed).length;
    const totalCount = this.quests.length;
    
    return `
      <div class="daily-quests">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
          <div style="font-weight:bold;font-size:17px">üìÖ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è</div>
          <div style="font-size:14px;color:var(--muted)">${completedCount}/${totalCount}</div>
        </div>
        ${this.quests.map(quest => `
          <div class="quest-item">
            <div style="font-size:24px">${quest.icon}</div>
            <div style="flex:1;margin:0 16px">
              <div style="font-weight:bold;font-size:14px;margin-bottom:4px">${quest.name}</div>
              <div style="font-size:12px;color:var(--muted);margin-bottom:8px">${quest.desc}</div>
              <div class="progress-bar">
                <div class="progress-fill" style="width:${(quest.progress / quest.target) * 100}%"></div>
              </div>
            </div>
            <div class="quest-reward">${quest.reward} ‚ÇΩ</div>
          </div>
        `).join('')}
      </div>
    `;
  }
}

// –ö–ª–∞—Å—Å —Ä–µ–π—Ç–∏–Ω–≥–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã
class LeaderboardSystem {
  constructor(game) {
    this.game = game;
    this.players = this.generateLeaderboard();
  }

  generateLeaderboard() {
    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ñ–µ–π–∫–æ–≤—ã—Ö –∏–≥—Ä–æ–∫–æ–≤
    const fakePlayers = Array.from({length: 9}, (_, i) => ({
      name: ['ProPlayer', 'CaseHunter', 'LuckyGuy', 'TraderKing', 'SkinMaster', 'RoulettePro', 'RichMan', 'Gambler', 'CSGO_Fan'][i],
      balance: 5000 + Math.floor(Math.random() * 10000),
      casesOpened: 50 + Math.floor(Math.random() * 200),
      isCurrent: false
    }));
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
    const currentPlayer = {
      name: '–í—ã',
      balance: this.game.state.balance,
      casesOpened: this.game.dataCollector?.stats?.casesOpened || 0,
      isCurrent: true
    };
    
    return [...fakePlayers, currentPlayer].sort((a, b) => b.balance - a.balance);
  }

  updateLeaderboard() {
    // –ù–∞—Ö–æ–¥–∏–º –∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
    const playerIndex = this.players.findIndex(p => p.isCurrent);
    if (playerIndex !== -1) {
      this.players[playerIndex].balance = this.game.state.balance;
      this.players[playerIndex].casesOpened = this.game.dataCollector?.stats?.casesOpened || 0;
      this.players.sort((a, b) => b.balance - a.balance);
    }
  }

  renderLeaderboard() {
    this.updateLeaderboard();
    
    return `
      <div class="leaderboard">
        <div class="leaderboard-header">
          <h3 style="margin:0">üèÜ –¢–û–ü –ò–ì–†–û–ö–û–í</h3>
          <div style="color:var(--accent);font-weight:bold">
            –í–∞—à–µ –º–µ—Å—Ç–æ: #${this.players.findIndex(p => p.isCurrent) + 1}
          </div>
        </div>
        <div class="leaderboard-list">
          ${this.players.slice(0, 10).map((player, index) => `
            <div class="leaderboard-item ${player.isCurrent ? 'current-player' : ''}">
              <div class="leaderboard-rank">${index + 1}</div>
              <div class="leaderboard-name">${player.name}</div>
              <div class="leaderboard-balance">${player.balance} ‚ÇΩ</div>
              <div class="leaderboard-cases">${player.casesOpened} –∫–µ–π—Å–æ–≤</div>
            </div>
          `).join('')}
        </div>
      </div>
    `;
  }
}

// –ö–ª–∞—Å—Å —Å–µ–∑–æ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
class SeasonalEvents {
  constructor(game) {
    this.game = game;
    this.currentEvent = this.checkCurrentEvent();
  }

  checkCurrentEvent() {
    const now = new Date();
    const month = now.getMonth() + 1;
    const day = now.getDate();

    if (month === 12) return 'new_year';
    if (month === 10 && day >= 28) return 'halloween';
    if (month === 2 && day === 14) return 'valentines';
    if (month === 3 && day >= 8 && day <= 10) return 'womens_day';
    if (month === 5 && day === 9) return 'victory_day';
    
    return null;
  }

  getEventBonuses() {
    const events = {
      new_year: {
        name: 'üéÑ –ù–æ–≤–æ–≥–æ–¥–Ω–µ–µ —Å–æ–±—ã—Ç–∏–µ',
        caseDiscount: 0.2,
        upgradeChanceBonus: 0.1,
        dailyBonusMultiplier: 2,
        description: '–°–∫–∏–¥–∫–∏ –Ω–∞ –∫–µ–π—Å—ã –∏ –ø–æ–≤—ã—à–µ–Ω–Ω—ã–µ —à–∞–Ω—Å—ã!'
      },
      halloween: {
        name: 'üéÉ –•—ç–ª–ª–æ—É–∏–Ω',
        caseDiscount: 0.15,
        specialDropChance: 0.05,
        description: '–¢–µ–º–Ω—ã–µ —Å–∏–ª—ã —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç —É–¥–∞—á—É!'
      },
      valentines: {
        name: 'üíù –î–µ–Ω—å –°–≤—è—Ç–æ–≥–æ –í–∞–ª–µ–Ω—Ç–∏–Ω–∞',
        dailyBonusMultiplier: 1.5,
        upgradeChanceBonus: 0.05,
        description: '–õ—é–±–æ–≤—å –≤ –≤–æ–∑–¥—É—Ö–µ –∏ –≤ –∫–µ–π—Å–∞—Ö!'
      },
      womens_day: {
        name: 'üå∏ 8 –ú–∞—Ä—Ç–∞',
        caseDiscount: 0.1,
        dailyBonusMultiplier: 1.5,
        description: '–û—Å–æ–±—ã–µ –±–æ–Ω—É—Å—ã –¥–ª—è –≤—Å–µ—Ö!'
      },
      victory_day: {
        name: 'üéñÔ∏è –î–µ–Ω—å –ü–æ–±–µ–¥—ã',
        caseDiscount: 0.15,
        description: '–ß–µ—Å—Ç—å –∏ –æ—Ç–≤–∞–≥–∞ –ø—Ä–∏–Ω–æ—Å—è—Ç —É–¥–∞—á—É!'
      }
    };

    return this.currentEvent ? events[this.currentEvent] : null;
  }

  renderEventBanner() {
    const bonuses = this.getEventBonuses();
    if (!bonuses) return '';

    return `
      <div class="event-banner">
        <div style="font-size: 18px; font-weight: bold; margin-bottom: 8px;">
          ${bonuses.name}
        </div>
        <div style="font-size: 14px; margin-bottom: 8px;">
          ${bonuses.description}
        </div>
        <div style="display: flex; justify-content: center; gap: 16px; flex-wrap: wrap;">
          ${bonuses.caseDiscount ? `<div style="font-size: 12px;">üéÅ –°–∫–∏–¥–∫–∞ ${Math.round(bonuses.caseDiscount * 100)}% –Ω–∞ –∫–µ–π—Å—ã</div>` : ''}
          ${bonuses.upgradeChanceBonus ? `<div style="font-size: 12px;">‚ö° +${Math.round(bonuses.upgradeChanceBonus * 100)}% –∫ —à–∞–Ω—Å—É –∞–ø–≥—Ä–µ–π–¥–∞</div>` : ''}
          ${bonuses.dailyBonusMultiplier ? `<div style="font-size: 12px;">üí∞ –ë–æ–Ω—É—Å—ã x${bonuses.dailyBonusMultiplier}</div>` : ''}
        </div>
      </div>
    `;
  }

  applyBonuses() {
    const bonuses = this.getEventBonuses();
    if (!bonuses) return;

    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–∫–∏–¥–∫—É –∫ –∫–µ–π—Å–∞–º
    if (bonuses.caseDiscount) {
      this.game.cases.forEach(caseItem => {
        if (!caseItem.originalPrice) {
          caseItem.originalPrice = caseItem.price;
        }
        caseItem.price = Math.round(caseItem.originalPrice * (1 - bonuses.caseDiscount));
      });
    }

    // –ü—Ä–∏–º–µ–Ω—è–µ–º –±–æ–Ω—É—Å –∫ —à–∞–Ω—Å–∞–º –∞–ø–≥—Ä–µ–π–¥–∞
    if (bonuses.upgradeChanceBonus) {
      this.game.UPGRADE_RTP_2X = CONFIG.UPGRADE_RTP_2X + bonuses.upgradeChanceBonus;
      this.game.UPGRADE_RTP_3X = CONFIG.UPGRADE_RTP_3X + bonuses.upgradeChanceBonus;
    }
  }
}

// –ö–ª–∞—Å—Å –±–æ–Ω—É—Å–Ω–æ–≥–æ –∫–æ–ª–µ—Å–∞
class BonusWheel {
  constructor(game) {
    this.game = game;
    this.spinsAvailable = this.loadSpins();
    this.totalSpins = this.loadTotalSpins();
    this.rewards = [
      { type: 'balance', value: 50, chance: 30, color: '#10B981', icon: 'üí∞' },
      { type: 'balance', value: 100, chance: 20, color: '#3B82F6', icon: 'üíé' },
      { type: 'balance', value: 200, chance: 10, color: '#8B5CF6', icon: 'üíµ' },
      { type: 'case', value: 'random', chance: 15, color: '#F59E0B', icon: 'üéÅ' },
      { type: 'multiplier', value: 2, chance: 10, color: '#EF4444', icon: '‚ö°' },
      { type: 'protection', value: 'upgrade', chance: 5, color: '#06B6D4', icon: 'üõ°Ô∏è' },
      { type: 'jackpot', value: 1000, chance: 5, color: '#FACC15', icon: 'üéØ' },
      { type: 'nothing', value: 0, chance: 5, color: '#6B7280', icon: 'üò¢' }
    ];
  }

  loadSpins() {
    const key = CONFIG.STORAGE_PREFIX + 'wheel_spins_' + this.game.userId;
    const today = new Date().toDateString();
    const lastSpinDate = localStorage.getItem(CONFIG.STORAGE_PREFIX + 'last_spin_date');
    
    if (lastSpinDate !== today) {
      // –°–±—Ä–æ—Å –Ω–∞ 3 —Å–ø–∏–Ω–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ
      localStorage.setItem(CONFIG.STORAGE_PREFIX + 'last_spin_date', today);
      return 3;
    }
    
    return parseInt(localStorage.getItem(key) || '3');
  }

  loadTotalSpins() {
    const key = CONFIG.STORAGE_PREFIX + 'total_wheel_spins_' + this.game.userId;
    return parseInt(localStorage.getItem(key) || '0');
  }

  saveSpins() {
    const key = CONFIG.STORAGE_PREFIX + 'wheel_spins_' + this.game.userId;
    localStorage.setItem(key, this.spinsAvailable.toString());
    
    const totalKey = CONFIG.STORAGE_PREFIX + 'total_wheel_spins_' + this.game.userId;
    localStorage.setItem(totalKey, this.totalSpins.toString());
  }

  addSpin(count = 1) {
    this.spinsAvailable += count;
    this.saveSpins();
    this.game.showToast(`+${count} –≤—Ä–∞—â–µ–Ω–∏–µ –∫–æ–ª–µ—Å–∞ —É–¥–∞—á–∏!`, 'success');
  }

  spinWheel() {
    if (this.spinsAvailable <= 0) {
      this.game.showToast('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤—Ä–∞—â–µ–Ω–∏–π –∫–æ–ª–µ—Å–∞', 'warning');
      return null;
    }

    this.spinsAvailable--;
    this.totalSpins++;
    this.saveSpins();

    // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–¥–∞–Ω–∏–µ
    this.game.dailyQuests.updateProgress('use_wheel', 1);

    // –í—ã–±–∏—Ä–∞–µ–º –Ω–∞–≥—Ä–∞–¥—É –ø–æ —à–∞–Ω—Å–∞–º
    const totalChance = this.rewards.reduce((sum, r) => sum + r.chance, 0);
    let random = Math.random() * totalChance;
    
    let selectedReward = null;
    for (const reward of this.rewards) {
      random -= reward.chance;
      if (random <= 0) {
        selectedReward = reward;
        break;
      }
    }

    // –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞–≥—Ä–∞–¥—É
    this.applyReward(selectedReward);
    
    return selectedReward;
  }

  applyReward(reward) {
    switch(reward.type) {
      case 'balance':
        this.game.addBalance(reward.value);
        this.game.showToast(`üé° –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${reward.value} ‚ÇΩ –Ω–∞ –∫–æ–ª–µ—Å–µ —É–¥–∞—á–∏!`, 'success');
        break;
      case 'case':
        this.game.openRandomCase();
        this.game.showToast(`üé° –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ —Å–ª—É—á–∞–π–Ω—ã–π –∫–µ–π—Å!`, 'success');
        break;
      case 'multiplier':
        // –ü—Ä–∏–º–µ–Ω—è–µ–º –º–Ω–æ–∂–∏—Ç–µ–ª—å –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤—ã–∏–≥—Ä—ã—à—É
        this.game.state.nextWinMultiplier = reward.value;
        this.game.showToast(`üé° –í–∞—à —Å–ª–µ–¥—É—é—â–∏–π –≤—ã–∏–≥—Ä—ã—à –±—É–¥–µ—Ç —É–º–Ω–æ–∂–µ–Ω –Ω–∞ ${reward.value}x!`, 'success');
        break;
      case 'protection':
        this.game.state.upgradeProtection = true;
        this.game.showToast(`üé° –í—ã –ø–æ–ª—É—á–∏–ª–∏ –∑–∞—â–∏—Ç—É –æ—Ç —Å–≥–æ—Ä–∞–Ω–∏—è –ø—Ä–∏ –∞–ø–≥—Ä–µ–π–¥–µ!`, 'success');
        break;
      case 'jackpot':
        this.game.addBalance(reward.value);
        this.game.showToast(`üé° –î–ñ–ï–ö–ü–û–¢! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${reward.value} ‚ÇΩ!`, 'success');
        this.game.pushFakeChat(`üéØ ${this.game.getRandomName()} –≤—ã–∏–≥—Ä–∞–ª –î–ñ–ï–ö–ü–û–¢ –≤ ${reward.value} ‚ÇΩ –Ω–∞ –∫–æ–ª–µ—Å–µ —É–¥–∞—á–∏!`, '–°–∏—Å—Ç–µ–º–∞');
        break;
      case 'nothing':
        this.game.showToast(`üé° –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –≤ —ç—Ç–æ—Ç —Ä–∞–∑ –Ω–µ –ø–æ–≤–µ–∑–ª–æ`, 'warning');
        break;
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ
    if (this.totalSpins >= 10) {
      this.game.achievementSystem.checkAchievements();
    }
  }

  renderWheel() {
    return `
      <div class="bonus-wheel-container" id="bonusWheelModal">
        <div class="bonus-wheel-modal">
          <div style="font-size:24px;margin-bottom:10px">üé°</div>
          <div style="font-weight:bold;font-size:20px;margin-bottom:16px">–ö–æ–ª–µ—Å–æ —É–¥–∞—á–∏</div>
          <div class="bonus-wheel-spins">–î–æ—Å—Ç—É–ø–Ω–æ –≤—Ä–∞—â–µ–Ω–∏–π: ${this.spinsAvailable}</div>
          <div style="
            width: 200px;
            height: 200px;
            margin: 20px auto;
            border-radius: 50%;
            background: conic-gradient(${this.rewards.map((r, i) => `${r.color} ${(i/this.rewards.length)*100}% ${((i+1)/this.rewards.length)*100}%`).join(', ')});
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
          ">
            <div style="
              width: 80px;
              height: 80px;
              background: var(--bg);
              border-radius: 50%;
              display: flex;
              align-items: center;
              justify-content: center;
              font-weight: bold;
              font-size: 18px;
            ">
              –°–ü–ò–ù
            </div>
            <div style="
              position: absolute;
              top: -20px;
              left: 50%;
              transform: translateX(-50%);
              width: 0;
              height: 0;
              border-left: 15px solid transparent;
              border-right: 15px solid transparent;
              border-bottom: 25px solid var(--accent);
            "></div>
          </div>
          <button class="spin-wheel-btn" onclick="window.CaseHunters.spinBonusWheel()">
            –ö—Ä—É—Ç–∏—Ç—å –∑–∞ 1 —Å–ø–∏–Ω
          </button>
          <div style="margin-top: 20px; display: flex; justify-content: space-between;">
            <button class="smallBtn" onclick="document.getElementById('bonusWheelModal').style.display='none'">
              –ó–∞–∫—Ä—ã—Ç—å
            </button>
            <div style="font-size: 12px; color: var(--muted); display: flex; align-items: center; gap: 5px;">
              üîÑ –í—Å–µ–≥–æ –≤—Ä–∞—â–µ–Ω–∏–π: ${this.totalSpins}
            </div>
          </div>
        </div>
      </div>
    `;
  }
}

// –ö–ª–∞—Å—Å —Å–±–æ—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
class DataCollector {
  constructor(gameInstance) {
    this.game = gameInstance;
    this.sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    this.userId = this.game.userId;
    this.startTime = Date.now();
    this.events = [];
    this.stats = this.loadStats();
  }

  loadStats() {
    try {
      const key = CONFIG.STORAGE_PREFIX + 'stats_' + this.userId;
      const stats = JSON.parse(localStorage.getItem(key) || '{}');
      return {
        casesOpened: stats.casesOpened || 0,
        moneySpent: stats.moneySpent || 0,
        moneyWon: stats.moneyWon || 0,
        upgradesAttempted: stats.upgradesAttempted || 0,
        upgradesSuccess: stats.upgradesSuccess || 0,
        itemsSold: stats.itemsSold || 0,
        totalProfit: stats.totalProfit || 0,
        biggestWin: stats.biggestWin || 0,
        dailyCases: stats.dailyCases || 0,
        dailyProfit: stats.dailyProfit || 0
      };
    } catch {
      return {
        casesOpened: 0,
        moneySpent: 0,
        moneyWon: 0,
        upgradesAttempted: 0,
        upgradesSuccess: 0,
        itemsSold: 0,
        totalProfit: 0,
        biggestWin: 0,
        dailyCases: 0,
        dailyProfit: 0
      };
    }
  }

  saveStats() {
    try {
      const key = CONFIG.STORAGE_PREFIX + 'stats_' + this.userId;
      localStorage.setItem(key, JSON.stringify(this.stats));
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
    }
  }

  updateStatsDisplay() {
    const elements = {
      statsCasesOpened: this.stats.casesOpened,
      statsMoneySpent: this.stats.moneySpent + ' ‚ÇΩ',
      statsMoneyWon: this.stats.moneyWon + ' ‚ÇΩ',
      statsProfit: (this.stats.moneyWon - this.stats.moneySpent) + ' ‚ÇΩ',
      statsUpgradesSuccess: this.stats.upgradesSuccess,
      statsItemsSold: this.stats.itemsSold,
      statsBiggestWin: this.stats.biggestWin + ' ‚ÇΩ',
      statsDailyCases: this.stats.dailyCases
    };

    Object.entries(elements).forEach(([id, value]) => {
      const element = document.getElementById(id);
      if (element) {
        element.textContent = value;
      }
    });

    // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –ø—Ä–æ—Ñ–∏—Ç
    const profitElement = document.getElementById('statsProfit');
    if (profitElement) {
      const profit = this.stats.moneyWon - this.stats.moneySpent;
      profitElement.style.color = profit >= 0 ? 'var(--green)' : 'var(--red)';
    }
  }

  recordCaseOpen(casePrice) {
    this.stats.casesOpened++;
    this.stats.moneySpent += casePrice;
    this.stats.dailyCases++;
    this.saveStats();
    this.updateStatsDisplay();
  }

  recordWin(winPrice) {
    this.stats.moneyWon += winPrice;
    if (winPrice > this.stats.biggestWin) {
      this.stats.biggestWin = winPrice;
    }
    
    const profit = winPrice - (this.stats.moneySpent / this.stats.casesOpened);
    this.stats.totalProfit += profit;
    this.stats.dailyProfit += profit;
    
    this.saveStats();
    this.updateStatsDisplay();
  }

  recordUpgradeAttempt(success) {
    this.stats.upgradesAttempted++;
    if (success) this.stats.upgradesSuccess++;
    this.saveStats();
    this.updateStatsDisplay();
  }

  recordItemSell(price) {
    this.stats.itemsSold++;
    this.saveStats();
    this.updateStatsDisplay();
  }

  resetDailyStats() {
    const today = new Date().toDateString();
    const lastReset = localStorage.getItem(CONFIG.STORAGE_PREFIX + 'last_daily_reset');
    
    if (lastReset !== today) {
      this.stats.dailyCases = 0;
      this.stats.dailyProfit = 0;
      localStorage.setItem(CONFIG.STORAGE_PREFIX + 'last_daily_reset', today);
      this.saveStats();
      this.updateStatsDisplay();
    }
  }
}

// –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
class CaseHuntersGame {
  constructor() {
    this.state = {
      balance: 0,
      inventory: [],
      currentRtp: CONFIG.DEFAULT_RTP,
      adminLogged: false,
      upgradeSelectedItem: null,
      soundEnabled: false,
      nextWinMultiplier: 1,
      upgradeProtection: false
    };
    
    this.userId = this.getUserId();
    this.cases = this.prepareCases();
    this.placeholderCache = new Map();
    this.touchStartX = 0;
    this.touchEndX = 0;
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–∏—Å—Ç–µ–º—ã
    this.dataCollector = new DataCollector(this);
    this.achievementSystem = new AchievementSystem(this);
    this.dailyQuests = new DailyQuests(this);
    this.leaderboardSystem = new LeaderboardSystem(this);
    this.seasonalEvents = new SeasonalEvents(this);
    this.bonusWheel = new BonusWheel(this);
    
    this.UPGRADE_RTP_2X = CONFIG.UPGRADE_RTP_2X;
    this.UPGRADE_RTP_3X = CONFIG.UPGRADE_RTP_3X;
    
    this.lastBalance = 0;
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  async init() {
    try {
      this.updateLoadingProgress(1, '–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è...');
      this.loadState();
      
      this.updateLoadingProgress(2, '–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –±–æ–Ω—É—Å–æ–≤...');
      this.seasonalEvents.applyBonuses();
      
      this.updateLoadingProgress(3, '–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞...');
      this.bindEvents();
      
      this.updateLoadingProgress(4, '–ó–∞–≥—Ä—É–∑–∫–∞ –∫–µ–π—Å–æ–≤...');
      await this.renderCases();
      
      this.updateLoadingProgress(5, '–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è...');
      this.renderInventory();
      
      this.updateLoadingProgress(6, '–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã...');
      this.setupReferrer();
      
      this.updateLoadingProgress(7, '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI...');
      this.updateUI();
      
      this.updateLoadingProgress(8, '–ó–∞–≥—Ä—É–∑–∫–∞ —á–∞—Ç–∞...');
      this.initChat();
      
      this.updateLoadingProgress(9, '–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–Ω–ª–∞–π–Ω-—Å—á–µ—Ç—á–∏–∫–∞...');
      this.initOnlineCounter();
      
      this.updateLoadingProgress(10, '–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º...');
      this.populateAdminSelects();
      this.dataCollector.resetDailyStats();
      this.dataCollector.updateStatsDisplay();
      this.dailyQuests.checkReset();
      
      // –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram Web App
      this.initTelegramIntegration();
      
      setTimeout(() => {
        document.getElementById('loadingOverlay').classList.add('fade-out');
        setTimeout(() => {
          document.getElementById('loadingOverlay').style.display = 'none';
        }, 300);
      }, 500);
      
    } catch (error) {
      console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
      this.showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è', 'error');
      document.getElementById('loadingOverlay').style.display = 'none';
    }
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
  initTelegramIntegration() {
    if (window.Telegram?.WebApp) {
      const tg = window.Telegram.WebApp;
      tg.expand();
      tg.setBackgroundColor('#0b0f14');
    }
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏
  updateLoadingProgress(step, message = '') {
    const progress = (step / 10) * 100;
    const progressBar = document.getElementById('loadingProgress');
    const loadingText = document.getElementById('loadingText');
    
    if (progressBar) {
      progressBar.style.width = `${progress}%`;
    }
    
    if (loadingText && message) {
      loadingText.textContent = message;
    }
  }

  // –ü–æ–ª—É—á–µ–Ω–∏–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  getUserId() {
    const key = CONFIG.STORAGE_PREFIX + 'userid';
    let id = localStorage.getItem(key);
    if (!id) {
      id = 'user_' + Date.now() + '_' + Math.random().toString(36).slice(2, 9);
      localStorage.setItem(key, id);
    }
    return id;
  }

  // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏
  getReferralLink() {
    return `https://t.me/${CONFIG.BOT_USERNAME}?start=${this.userId}`;
  }

  // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
  loadState() {
    try {
      const balanceKey = CONFIG.STORAGE_PREFIX + 'balance_' + this.userId;
      const balance = localStorage.getItem(balanceKey);
      this.state.balance = balance ? parseInt(balance) : 0;

      const inventoryKey = CONFIG.STORAGE_PREFIX + 'inventory_' + this.userId;
      const inventory = localStorage.getItem(inventoryKey);
      this.state.inventory = inventory ? JSON.parse(inventory) : [];
      
      const soundKey = CONFIG.STORAGE_PREFIX + 'sound_' + this.userId;
      const sound = localStorage.getItem(soundKey);
      this.state.soundEnabled = sound !== null ? sound === 'true' : false;
    } catch (error) {
      console.error('Error loading state:', error);
      this.state.balance = 0;
      this.state.inventory = [];
      this.state.soundEnabled = false;
    }
  }

  // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
  saveState() {
    try {
      const balanceKey = CONFIG.STORAGE_PREFIX + 'balance_' + this.userId;
      localStorage.setItem(balanceKey, this.state.balance.toString());

      const inventoryKey = CONFIG.STORAGE_PREFIX + 'inventory_' + this.userId;
      localStorage.setItem(inventoryKey, JSON.stringify(this.state.inventory));
      
      const soundKey = CONFIG.STORAGE_PREFIX + 'sound_' + this.userId;
      localStorage.setItem(soundKey, this.state.soundEnabled.toString());
    } catch (error) {
      console.error('Error saving state:', error);
    }
  }

  // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–µ–π—Å–æ–≤
  prepareCases() {
    return CASES.map(c => ({
      ...c,
      items: c.baseItems.map(it => ({ 
        ...it, 
        chance: this.calculateRealChance(it, c.baseItems, CONFIG.DEFAULT_RTP)
      })),
      baseTotalChance: c.baseItems.reduce((s, i) => s + i.baseChance, 0)
    }));
  }

  // –†–∞—Å—á–µ—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö —à–∞–Ω—Å–æ–≤
  calculateRealChance(item, allItems, targetRtp) {
    const totalPrice = allItems.reduce((sum, i) => sum + i.price, 0);
    const avgPrice = totalPrice / allItems.length;
    const itemValueRatio = item.price / avgPrice;
    
    const baseChance = (1 / itemValueRatio) * 100;
    const adjustedChance = baseChance * (targetRtp / 0.5);
    
    return Math.max(adjustedChance, 1);
  }

  // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª–∞
  setupReferrer() {
    try {
      const urlParams = new URLSearchParams(window.location.search);
      const referrer = urlParams.get('ref') || urlParams.get('start');
      
      if (referrer && referrer !== this.userId) {
        const referrerKey = CONFIG.STORAGE_PREFIX + 'referrer_' + this.userId;
        localStorage.setItem(referrerKey, referrer);
      }
    } catch (error) {
      console.error('Error setting up referrer:', error);
    }
  }

  // –ü—Ä–∏–≤—è–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π
  bindEvents() {
    window.addEventListener('beforeunload', () => {
      this.saveState();
      this.dataCollector.saveStats();
    });
    
    // –°–≤–∞–π–ø—ã –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö
    document.addEventListener('touchstart', e => {
      this.touchStartX = e.changedTouches[0].screenX;
    });
    
    document.addEventListener('touchend', e => {
      this.touchEndX = e.changedTouches[0].screenX;
      this.handleSwipe();
    });
    
    // –ë–∞–Ω–∫
    document.getElementById('bankBtn')?.addEventListener('click', () => {
      this.showBankModal();
    });
    document.getElementById('closeBank')?.addEventListener('click', () => {
      this.hideBankModal();
    });
    document.getElementById('depositBtn')?.addEventListener('click', () => {
      this.deposit();
    });
    document.getElementById('withdrawBtn')?.addEventListener('click', () => {
      this.withdraw();
    });

    // –ê–¥–º–∏–Ω–∫–∞
    document.getElementById('adminToggle')?.addEventListener('click', () => {
      this.toggleAdminPanel();
    });
    document.getElementById('adminLogin')?.addEventListener('click', () => {
      this.adminLogin();
    });
    document.getElementById('adminAddBtn')?.addEventListener('click', () => {
      this.adminAddBalance();
    });
    document.getElementById('adminSetRtpBtn')?.addEventListener('click', () => {
      this.adminSetRtp();
    });
    document.getElementById('adminForceWin')?.addEventListener('click', () => {
      this.adminForceWin();
    });
    document.getElementById('adminClearRef')?.addEventListener('click', () => {
      this.adminClearRef();
    });

    // –ë–æ–Ω—É—Å—ã
    document.getElementById('dailyBonusBtn')?.addEventListener('click', () => {
      this.claimBonus('daily');
    });
    document.getElementById('dailyBonusBtnTop')?.addEventListener('click', () => {
      this.claimBonus('daily');
    });
    document.getElementById('extraBonusBtn')?.addEventListener('click', () => {
      this.claimBonus('extra');
    });
    document.getElementById('claimRefBtn')?.addEventListener('click', () => {
      this.claimReferralEarnings();
    });
    document.getElementById('bonusWheelBtn')?.addEventListener('click', () => {
      this.showBonusWheel();
    });

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–æ–∫
    document.getElementById('closeModal')?.addEventListener('click', () => {
      document.getElementById('overlay').style.display = 'none';
    });

    // –ê–ø–≥—Ä–µ–π–¥
    document.getElementById('upgrade2xBtn')?.addEventListener('click', () => {
      this.performUpgrade(2);
    });
    document.getElementById('upgrade3xBtn')?.addEventListener('click', () => {
      this.performUpgrade(3);
    });

    // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏
    document.getElementById('copyRefBtn')?.addEventListener('click', () => {
      this.copyReferralLink();
    });

    // –ó–≤—É–∫
    document.getElementById('soundToggle')?.addEventListener('click', () => {
      this.toggleSound();
    });
    
    // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    document.getElementById('showStatsBtn')?.addEventListener('click', () => {
      this.toggleStats();
    });
    
    // –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
    document.getElementById('showAchievementsBtn')?.addEventListener('click', () => {
      this.toggleAchievements();
    });
    
    // –õ–∏–¥–µ—Ä–±–æ—Ä–¥
    document.getElementById('showLeaderboardBtn')?.addEventListener('click', () => {
      this.toggleLeaderboard();
    });
  }

  // –û—Ç–∫—Ä—ã—Ç–∏–µ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∫–µ–π—Å–∞
  openRandomCase() {
    const availableCases = this.cases.filter(caseItem => 
      this.state.adminLogged || this.state.balance >= caseItem.price
    );
    
    if (availableCases.length === 0) {
      this.showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–µ–π—Å–æ–≤', 'error');
      return;
    }
    
    const randomCase = availableCases[Math.floor(Math.random() * availableCases.length)];
    const openBtn = document.querySelector(`[data-open="${randomCase.id}"]`);
    if (openBtn) {
      openBtn.click();
    }
  }

  // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–≤–∞–π–ø–æ–≤
  handleSwipe() {
    const diff = this.touchStartX - this.touchEndX;
    if (Math.abs(diff) > 50) {
      if (diff > 0) {
        // –°–≤–∞–π–ø –≤–ª–µ–≤–æ - –æ—Ç–∫—Ä—ã—Ç—å —Å–ª—É—á–∞–π–Ω—ã–π –∫–µ–π—Å
        this.openRandomCase();
      } else {
        // –°–≤–∞–π–ø –≤–ø—Ä–∞–≤–æ - –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
        this.toggleStats();
      }
    }
  }

  // –ü–æ–∫–∞–∑–∞—Ç—å –±–æ–Ω—É—Å–Ω–æ–µ –∫–æ–ª–µ—Å–æ
  showBonusWheel() {
    const modal = document.getElementById('bonusWheelModal');
    if (modal) {
      modal.style.display = 'flex';
    } else {
      // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª–∫—É –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
      const wheelHTML = this.bonusWheel.renderWheel();
      document.body.insertAdjacentHTML('beforeend', wheelHTML);
    }
  }

  // –í—Ä–∞—â–µ–Ω–∏–µ –±–æ–Ω—É—Å–Ω–æ–≥–æ –∫–æ–ª–µ—Å–∞
  spinBonusWheel() {
    const reward = this.bonusWheel.spinWheel();
    if (reward) {
      // –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è
      const wheel = document.querySelector('#bonusWheelModal .bonus-wheel-modal > div:nth-child(4)');
      if (wheel) {
        wheel.style.transition = 'transform 3s cubic-bezier(0.2,0.9,0.2,1)';
        wheel.style.transform = `rotate(${1440 + Math.random() * 360}deg)`;
        
        setTimeout(() => {
          wheel.style.transition = '';
          this.updateUI();
        }, 3000);
      }
    }
  }

  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
  toggleStats() {
    const statsSection = document.getElementById('statsSection');
    const isVisible = statsSection.style.display === 'block';
    statsSection.style.display = isVisible ? 'none' : 'block';
    
    if (!isVisible) {
      statsSection.scrollIntoView({ behavior: 'smooth' });
    }
  }

  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π
  toggleAchievements() {
    const achievementsHTML = this.achievementSystem.renderAchievements();
    const existing = document.getElementById('achievementsSection');
    
    if (existing) {
      existing.remove();
    } else {
      const container = document.querySelector('.container > div > div:first-child');
      if (container) {
        container.insertAdjacentHTML('afterbegin', achievementsHTML);
      }
    }
  }

  // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞
  toggleLeaderboard() {
    const leaderboardHTML = this.leaderboardSystem.renderLeaderboard();
    const existing = document.getElementById('leaderboardSection');
    
    if (existing) {
      existing.remove();
    } else {
      const container = document.querySelector('.container > div > div:first-child');
      if (container) {
        container.insertAdjacentHTML('afterbegin', leaderboardHTML);
      }
    }
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
  updateUI() {
    const balanceElement = document.getElementById('balance');
    if (balanceElement) {
      balanceElement.textContent = this.state.adminLogged ? '‚àû' : this.state.balance;
    }
    
    const refEarningsElement = document.getElementById('refEarnings');
    if (refEarningsElement) {
      refEarningsElement.textContent = this.getReferralEarnings();
    }
    
    const refLinkElement = document.getElementById('myRefLink');
    if (refLinkElement) {
      refLinkElement.value = this.getReferralLink();
    }
    
    const soundBtn = document.getElementById('soundToggle');
    if (soundBtn) {
      soundBtn.textContent = this.state.soundEnabled ? 'üîä' : 'üîá';
      soundBtn.classList.toggle('muted', !this.state.soundEnabled);
    }
    
    this.lastBalance = this.state.balance;
  }

  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
  addBalance(amount) {
    if (this.state.adminLogged) {
      this.updateUI();
      return;
    }
    
    const oldBalance = this.state.balance;
    this.state.balance += Math.round(amount);
    this.saveState();
    this.updateUI();
    
    const balanceBox = document.getElementById('balanceBox');
    if (balanceBox) {
      balanceBox.classList.add('balance-increase');
      setTimeout(() => {
        balanceBox.classList.remove('balance-increase');
      }, 500);
    }
    
    if (amount > 0) {
      const rect = balanceBox?.getBoundingClientRect();
      if (rect) {
        this.createParticles(
          rect.left + rect.width / 2,
          rect.top + rect.height / 2,
          15,
          '#facc15'
        );
      }
    }
  }

  // –°–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
  subBalance(amount) {
    if (this.state.adminLogged) {
      this.updateUI();
      return;
    }
    
    const oldBalance = this.state.balance;
    this.state.balance = Math.max(0, this.state.balance - Math.round(amount));
    this.saveState();
    this.updateUI();
  }

  // –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∏–≥—Ä—ã (—Ä–µ–Ω–¥–µ—Ä –∫–µ–π—Å–æ–≤, –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è, –æ—Ç–∫—Ä—ã—Ç–∏–µ –∫–µ–π—Å–æ–≤ –∏ —Ç.–¥.)
  // ... (–æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –æ—Å—Ç–∞—é—Ç—Å—è –ø–æ—Ö–æ–∂–∏–º–∏ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é –≤–µ—Ä—Å–∏—é, –Ω–æ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –Ω–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º)

  // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
  showToast(message, type = 'info') {
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => {
      toast.classList.add('show');
    }, 10);
    
    setTimeout(() => {
      toast.classList.remove('show');
      setTimeout(() => {
        if (toast.parentNode) {
          document.body.removeChild(toast);
        }
      }, 300);
    }, 3000);
  }

  // –°–æ–∑–¥–∞–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∞ —á–∞—Å—Ç–∏—Ü
  createParticles(x, y, count = 10, color = '#facc15') {
    for (let i = 0; i < count; i++) {
      const particle = document.createElement('div');
      particle.className = 'particle';
      particle.style.cssText = `
        width: 4px;
        height: 4px;
        background: ${color};
        border-radius: 50%;
        left: ${x}px;
        top: ${y}px;
        --tx: ${(Math.random() - 0.5) * 200}px;
        --ty: ${(Math.random() - 0.5) * 200}px;
      `;
      
      document.body.appendChild(particle);
      
      particle.animate([
        { transform: 'translate(0, 0) rotate(0deg)', opacity: 1 },
        { transform: 'translate(var(--tx), var(--ty)) rotate(360deg)', opacity: 0 }
      ], {
        duration: 1000 + Math.random() * 500,
        easing: 'cubic-bezier(0.1, 0.7, 0.2, 1)'
      }).onfinish = () => {
        if (particle.parentNode) {
          document.body.removeChild(particle);
        }
      };
    }
  }

  // –ü–æ–ª—É—á–µ–Ω–∏–µ –±–æ–Ω—É—Å–∞
  claimBonus(type) {
    const today = new Date().toISOString().split('T')[0];
    const storageKey = type === 'daily' 
      ? CONFIG.STORAGE_PREFIX + 'lastBonus_' + this.userId
      : CONFIG.STORAGE_PREFIX + 'lastExtraBonus_' + this.userId;

    const lastClaim = localStorage.getItem(storageKey);
    const amount = 10;

    if (lastClaim === today) {
      this.showToast('–ë–æ–Ω—É—Å —É–∂–µ –ø–æ–ª—É—á–µ–Ω —Å–µ–≥–æ–¥–Ω—è', 'warning');
      return;
    }

    this.addBalance(amount);
    localStorage.setItem(storageKey, today);
    
    const message = type === 'daily' 
      ? `–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å ${amount} ‚ÇΩ –∑–∞—á–∏—Å–ª–µ–Ω`
      : `–ë–æ–Ω—É—Å —Å–≤–µ—Ä—Ö—É +${amount} ‚ÇΩ –∑–∞—á–∏—Å–ª–µ–Ω`;
    
    this.showToast(message, 'success');
    this.createParticles(
      document.getElementById('balanceBox').getBoundingClientRect().left + 50,
      document.getElementById('balanceBox').getBoundingClientRect().top + 25,
      12,
      '#facc15'
    );
  }

  // –£–ª—É—á—à–µ–Ω–Ω—ã–π –∞–ø–≥—Ä–µ–π–¥ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π –∫–æ–ª–µ—Å–∞
  performUpgrade(multiplier) {
    if (!this.state.upgradeSelectedItem) {
      document.getElementById('upgradeResultSmall').textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç';
      return;
    }
    
    const item = this.state.upgradeSelectedItem;
    const cost = multiplier === 2 
      ? Math.max(30, Math.round(item.price * 0.15))
      : Math.max(60, Math.round(item.price * 0.25));
    
    if (!this.state.adminLogged && this.state.balance < cost) {
      document.getElementById('upgradeResultSmall').textContent = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤';
      return;
    }
    
    if (!this.state.adminLogged) {
      this.subBalance(cost);
    }
    
    document.getElementById('upgradeResultSmall').textContent = 'üîÑ –ó–∞–ø—É—Å–∫–∞–µ–º –∞–ø–≥—Ä–µ–π–¥...';
    document.getElementById('upgrade2xBtn').disabled = true;
    document.getElementById('upgrade3xBtn').disabled = true;
    
    const wheel = document.getElementById('upgradeWheelSmall');
    const inner = document.getElementById('upgradeInnerSmall');
    
    if (wheel && inner) {
      // –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è
      wheel.style.transition = 'transform 3s cubic-bezier(.2,.9,.2,1)';
      inner.textContent = '–ö—Ä—É—Ç–∏—Ç—Å—è...';
      
      const baseSpins = 4;
      let finalAngle;
      
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
      const probability = multiplier === 2 ? this.UPGRADE_RTP_2X : this.UPGRADE_RTP_3X;
      const success = Math.random() < probability || this.state.upgradeProtection;
      
      if (success) {
        finalAngle = 360 * baseSpins + (Math.random() * 60 + 30);
      } else {
        finalAngle = 360 * baseSpins + (Math.random() * 180 + 150);
      }
      
      wheel.style.transform = `rotate(${finalAngle}deg)`;
      
      setTimeout(() => {
        wheel.style.transition = '';
        wheel.style.transform = `rotate(${finalAngle % 360}deg)`;
        
        if (success) {
          wheel.classList.add('upgrade-success');
          inner.textContent = '–£–°–ü–ï–•!';
          
          const oldPrice = item.price;
          item.price = Math.round(item.price * multiplier);
          item.upgraded = item.upgraded || { times: 0, multiplier: 1 };
          item.upgraded.times += 1;
          item.upgraded.multiplier *= multiplier;
          
          // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
          this.dataCollector.recordUpgradeAttempt(true);
          
          // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–¥–∞–Ω–∏–µ
          this.dailyQuests.updateProgress('upgrade_success', 1);
          
          document.getElementById('upgradeResultSmall').textContent = 
            `üéâ –£—Å–ø–µ—Ö! –ü—Ä–µ–¥–º–µ—Ç —É–º–Ω–æ–∂–µ–Ω –Ω–∞ ${multiplier}x. –ù–æ–≤–∞—è —Ü–µ–Ω–∞: ${item.price} ‚ÇΩ`;
          document.getElementById('upgradeSelectedPrice').textContent = `${item.price} ‚ÇΩ`;
          
          this.showToast(`–ê–ø–≥—Ä–µ–π–¥ —É—Å–ø–µ—à–µ–Ω! –ù–æ–≤–∞—è —Ü–µ–Ω–∞: ${item.price} ‚ÇΩ`, 'success');
          this.pushFakeChat(`${this.getRandomName()} —É—Å–ø–µ—à–Ω–æ –∞–ø–≥—Ä–µ–π–¥–Ω—É–ª ${item.name} –¥–æ ${item.price} ‚ÇΩ`);
          
          // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ
          this.achievementSystem.checkAchievements();
          
          // –≠—Ñ—Ñ–µ–∫—Ç —á–∞—Å—Ç–∏—Ü
          const upgradePanel = document.getElementById('upgradePanel');
          const rect = upgradePanel.getBoundingClientRect();
          this.createParticles(
            rect.left + rect.width / 2,
            rect.top + rect.height / 2,
            20,
            '#10b981'
          );
          
        } else {
          wheel.classList.add('upgrade-fail');
          inner.textContent = '–ü–†–û–í–ê–õ';
          
          // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
          this.dataCollector.recordUpgradeAttempt(false);
          
          // –°–≥–æ—Ä–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞
          if (!this.state.upgradeProtection) {
            const itemElement = document.querySelector(`.item[data-uid="${item.uid}"]`);
            if (itemElement) {
              itemElement.classList.add('item-burn');
            }
            
            document.getElementById('upgradeResultSmall').textContent = 
              'üí• –ù–µ—É–¥–∞—á–∞! –ü—Ä–µ–¥–º–µ—Ç —Å–≥–æ—Ä–µ–ª.';
            document.getElementById('upgradeSelectedPreview').innerHTML = 'üí•';
            document.getElementById('upgradeSelectedName').textContent = '–ü—Ä–µ–¥–º–µ—Ç —Å–≥–æ—Ä–µ–ª';
            document.getElementById('upgradeSelectedPrice').textContent = '‚Äî';
            
            this.showToast('–ê–ø–≥—Ä–µ–π–¥ –Ω–µ—É–¥–∞—á–µ–Ω: –ø—Ä–µ–¥–º–µ—Ç —Å–≥–æ—Ä–µ–ª', 'error');
            this.pushFakeChat(`${this.getRandomName()} –Ω–µ—É–¥–∞—á–Ω–æ –∞–ø–≥—Ä–µ–π–¥–Ω—É–ª ${item.name} - –ø—Ä–µ–¥–º–µ—Ç —Å–≥–æ—Ä–µ–ª`);
            
            setTimeout(() => {
              const itemIndex = this.state.inventory.findIndex(invItem => invItem.uid === item.uid);
              if (itemIndex !== -1) {
                this.state.inventory.splice(itemIndex, 1);
                this.saveState();
                this.renderInventory();
              }
              this.state.upgradeSelectedItem = null;
            }, 1000);
            
          } else {
            // –ó–∞—â–∏—Ç–∞ —Å—Ä–∞–±–æ—Ç–∞–ª–∞
            this.state.upgradeProtection = false;
            document.getElementById('upgradeResultSmall').textContent = 
              'üõ°Ô∏è –ó–∞—â–∏—Ç–∞ —Å–ø–∞—Å–ª–∞ –≤–∞—à –ø—Ä–µ–¥–º–µ—Ç!';
            this.showToast('–ó–∞—â–∏—Ç–∞ —Å–ø–∞—Å–ª–∞ –≤–∞—à –ø—Ä–µ–¥–º–µ—Ç –æ—Ç —Å–≥–æ—Ä–∞–Ω–∏—è!', 'info');
          }
          
          const upgradePanel = document.getElementById('upgradePanel');
          const rect = upgradePanel.getBoundingClientRect();
          this.createParticles(
            rect.left + rect.width / 2,
            rect.top + rect.height / 2,
            15,
            '#ef4444'
          );
        }
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∑–∞—â–∏—Ç—É
        this.state.upgradeProtection = false;
        
        setTimeout(() => {
          wheel.classList.remove('upgrade-success', 'upgrade-fail');
          inner.textContent = '–ê–ø–≥—Ä–µ–π–¥';
        }, 800);
        
        this.saveState();
        this.renderInventory();
        this.updateUI();
        
        document.getElementById('upgrade2xBtn').disabled = false;
        document.getElementById('upgrade3xBtn').disabled = false;
        
      }, 3100);
    }
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–∞—Ç–∞
  initChat() {
    const initialMessages = [
      '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Case Hunters! üéÆ',
      '–û—Ç–∫—Ä—ã–≤–∞–π—Ç–µ –∫–µ–π—Å—ã –∏ –≤—ã–∏–≥—Ä—ã–≤–∞–π—Ç–µ –∫—Ä—É—Ç—ã–µ –ø—Ä–µ–¥–º–µ—Ç—ã! üí∞',
      '–ü—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π –∏ –ø–æ–ª—É—á–∞–π—Ç–µ 30% –æ—Ç –∏—Ö –ø—Ä–æ–∏–≥—Ä—ã—à–µ–π! üë•',
      '–ê–ø–≥—Ä–µ–π–¥ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ —Å —Ä–∏—Å–∫–æ–º —Å–≥–æ—Ä–∞–Ω–∏—è - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–≤–æ—é —É–¥–∞—á—É! ‚ö°',
      '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–≤–∞–π–ø –≤–ª–µ–≤–æ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∫–µ–π—Å–∞! üëà',
      '–ù–µ –∑–∞–±—ã–≤–∞–π—Ç–µ –ø—Ä–æ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è! üèÜ'
    ];
    
    initialMessages.forEach((msg, i) => {
      setTimeout(() => {
        this.pushFakeChat(msg, '–°–∏—Å—Ç–µ–º–∞');
      }, 1000 * i);
    });
    
    setInterval(() => {
      const messages = [
        'P250 | Sand Dune',
        'AK-47 | Redline',
        'AWP | Asiimov',
        'Glock-18 | Fade',
        'M4A4 | Howl',
        'Sport Gloves | Pandora\'s Box'
      ];
      
      const randomItem = messages[Math.floor(Math.random() * messages.length)];
      this.pushFakeChat(
        `${this.getRandomName()} –æ—Ç–∫—Ä—ã–ª –∫–µ–π—Å –∏ –ø–æ–ª—É—á–∏–ª ${randomItem}`,
        this.getRandomName()
      );
    }, 12000);
    
    setInterval(() => {
      const amount = 500 + Math.floor(Math.random() * 1000);
      this.pushFakeChat(
        `${this.getRandomName()} –≤—ã–≤–µ–ª ${amount} ‚ÇΩ`,
        this.getRandomName()
      );
    }, 18000);
    
    setInterval(() => {
      const messages = [
        '—É—Å–ø–µ—à–Ω–æ –∞–ø–≥—Ä–µ–π–¥–Ω—É–ª –ø—Ä–µ–¥–º–µ—Ç –¥–æ 2x! üéâ',
        '–ø–æ–ø—ã—Ç–∞–ª—Å—è –∞–ø–≥—Ä–µ–π–¥–Ω—É—Ç—å –ø—Ä–µ–¥–º–µ—Ç –∏ –æ–Ω —Å–≥–æ—Ä–µ–ª üí•',
        '–ø—Ä–æ–¥–∞–ª –ø—Ä–µ–¥–º–µ—Ç –∏ –∑–∞—Ä–∞–±–æ—Ç–∞–ª –∫—Ä—É—Ç—ã–µ –¥–µ–Ω—å–≥–∏ üí∞',
        '–ø—Ä–∏–≥–ª–∞—Å–∏–ª –¥—Ä—É–≥–∞ –∏ –ø–æ–ª—É—á–∏–ª —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –±–æ–Ω—É—Å üë•',
        '–≤—ã–ø–æ–ª–Ω–∏–ª –≤—Å–µ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è! ‚úÖ',
        '–ø–æ–ª—É—á–∏–ª –Ω–æ–≤–æ–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ! üèÜ'
      ];
      
      const randomMessage = messages[Math.floor(Math.random() * messages.length)];
      this.pushFakeChat(
        `${this.getRandomName()} ${randomMessage}`,
        this.getRandomName()
      );
    }, 15000);
  }

  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
  pushFakeChat(text, user = null) {
    const chatBox = document.getElementById('chatBox');
    if (!chatBox) return;
    
    const messageElement = document.createElement('div');
    messageElement.className = 'chatMessage';
    
    const userName = user || this.getRandomName();
    const time = new Date().toLocaleTimeString([], { 
      hour: '2-digit', 
      minute: '2-digit' 
    });
    
    messageElement.innerHTML = `
      <div class="meta">
        <span>${userName}</span>
        <span>${time}</span>
      </div>
      <div>${text}</div>
    `;
    
    chatBox.appendChild(messageElement);
    
    chatBox.scrollTop = chatBox.scrollHeight;
    
    if (chatBox.children.length > 50) {
      chatBox.removeChild(chatBox.children[0]);
    }
  }

  // –°–ª—É—á–∞–π–Ω–æ–µ –∏–º—è –¥–ª—è —á–∞—Ç–∞
  getRandomName() {
    const names = [
      '–ò–≤–∞–Ω_92', 'Anna_Pro', 'GamerMax', 'Oleg_CS', 'Vlad99',
      'Katya', 'Pro_Player', 'Rus_Bot', 'Sniper', 'Hunter',
      'CaseMaster', 'Lucky_Shot', 'TradeKing', 'SkinGod', 'RoulettePro'
    ];
    return names[Math.floor(Math.random() * names.length)];
  }

  // –°—á–µ—Ç—á–∏–∫ –æ–Ω–ª–∞–π–Ω
  initOnlineCounter() {
    let onlineCount = 120 + Math.floor(Math.random() * 80);
    
    const updateOnline = () => {
      onlineCount += Math.floor(Math.random() * 7) - 3;
      onlineCount = Math.max(50, Math.min(350, onlineCount));
      
      const onlineElement = document.getElementById('fakeOnline');
      if (onlineElement) {
        onlineElement.textContent = onlineCount;
      }
    };
    
    updateOnline();
    setInterval(updateOnline, 5000);
  }

  // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –¥–æ—Ö–æ–¥–æ–≤
  getReferralEarnings() {
    try {
      const key = CONFIG.STORAGE_PREFIX + 'refearn_' + this.userId;
      return parseInt(localStorage.getItem(key) || '0');
    } catch {
      return 0;
    }
  }

  // –ó–∞—á–∏—Å–ª–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤
  claimReferralEarnings() {
    const earnings = this.getReferralEarnings();
    
    if (earnings <= 0) {
      this.showToast('–ù–µ—Ç —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –∑–∞—á–∏—Å–ª–µ–Ω–∏—è', 'warning');
      return;
    }

    this.addBalance(earnings);
    this.clearReferralEarnings();
    this.showToast(`–ó–∞—á–∏—Å–ª–µ–Ω–æ ${earnings} ‚ÇΩ –Ω–∞ –±–∞–ª–∞–Ω—Å`, 'success');
  }

  // –û—á–∏—Å—Ç–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –¥–æ—Ö–æ–¥–æ–≤
  clearReferralEarnings() {
    try {
      const key = CONFIG.STORAGE_PREFIX + 'refearn_' + this.userId;
      localStorage.setItem(key, '0');
      this.updateUI();
    } catch (error) {
      console.error('Error clearing referral earnings:', error);
    }
  }

  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã (—Ä–µ–Ω–¥–µ—Ä –∫–µ–π—Å–æ–≤, –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è, –∞–¥–º–∏–Ω–∫–∞ –∏ —Ç.–¥.)
  // ... (—ç—Ç–∏ –º–µ—Ç–æ–¥—ã –æ—Å—Ç–∞—é—Ç—Å—è –ø–æ—Ö–æ–∂–∏–º–∏ –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é –≤–µ—Ä—Å–∏—é)

  // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–æ–≤ –≤ –∞–¥–º–∏–Ω–∫–µ
  populateAdminSelects() {
    const caseSelect = document.getElementById('adminForceCase');
    const itemSelect = document.getElementById('adminForceItem');
    
    if (!caseSelect || !itemSelect) return;

    caseSelect.innerHTML = '';
    itemSelect.innerHTML = '';

    this.cases.forEach(caseItem => {
      const option = document.createElement('option');
      option.value = caseItem.id;
      option.textContent = caseItem.name;
      caseSelect.appendChild(option);
    });

    if (this.cases.length > 0) {
      this.updateAdminItems(this.cases[0].id);
    }

    caseSelect.addEventListener('change', (e) => {
      this.updateAdminItems(e.target.value);
    });
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –≤ –∞–¥–º–∏–Ω–∫–µ
  updateAdminItems(caseId) {
    const itemSelect = document.getElementById('adminForceItem');
    if (!itemSelect) return;

    itemSelect.innerHTML = '';
    
    const caseItem = this.cases.find(c => c.id === caseId);
    if (!caseItem) return;

    caseItem.items.forEach(item => {
      const option = document.createElement('option');
      option.value = item.id;
      option.textContent = item.name;
      itemSelect.appendChild(option);
    });
  }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
let app;

document.addEventListener('DOMContentLoaded', async () => {
  try {
    app = new CaseHuntersGame();
    await app.init();
    
    window.CaseHunters = app;
    
    console.log('Case Hunters —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!');
    
    // –î–æ–±–∞–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    window.openRandomCase = () => app.openRandomCase();
    window.spinBonusWheel = () => app.spinBonusWheel();
    window.showBonusWheel = () => app.showBonusWheel();
    window.toggleStats = () => app.toggleStats();
    window.toggleAchievements = () => app.toggleAchievements();
    window.toggleLeaderboard = () => app.toggleLeaderboard();
    
  } catch (error) {
    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:', error);
    
    const errorDiv = document.createElement('div');
    errorDiv.style.position = 'fixed';
    errorDiv.style.top = '50%';
    errorDiv.style.left = '50%';
    errorDiv.style.transform = 'translate(-50%, -50%)';
    errorDiv.style.background = '#ef4444';
    errorDiv.style.color = 'white';
    errorDiv.style.padding = '20px';
    errorDiv.style.borderRadius = '10px';
    errorDiv.style.zIndex = '9999';
    errorDiv.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.';
    
    document.body.appendChild(errorDiv);
  }
});
</script>
</head>
<body>

<!-- Loading Overlay -->
<div id="loadingOverlay">
  <div class="loader"></div>
  <div style="color:var(--accent);font-weight:bold;margin-top:10px;" id="loadingText">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
  <div class="loading-progress">
    <div class="loading-progress-bar" id="loadingProgress"></div>
  </div>
</div>

<!-- Top Bar -->
<div id="topBar">
  <div id="logo">CASE HUNTERS</div>
  <div class="top-controls">
    <div id="balanceBox">–ë–∞–ª–∞–Ω—Å: <span id="balance">0</span> ‚ÇΩ</div>
    <div class="top-buttons">
      <button id="bankBtn" class="smallBtn" title="–ë–∞–Ω–∫">üíº –ë–∞–Ω–∫</button>
      <button id="soundToggle" title="–ó–≤—É–∫">üîä</button>
      <button id="bonusWheelBtn" class="smallBtn" title="–ö–æ–ª–µ—Å–æ —É–¥–∞—á–∏">üé°</button>
      <button id="adminToggle" class="smallBtn" title="–ê–¥–º–∏–Ω–∫–∞">Admin</button>
    </div>
  </div>
</div>

<!-- Daily Bonus Top -->
<div style="background:#111827;padding:10px 12px;text-align:center;border-bottom:1px solid #222">
  <button id="dailyBonusBtnTop" class="smallBtn">üéÅ –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–æ–Ω—É—Å +10 ‚ÇΩ</button>
</div>

<!-- Main Container -->
<div class="container">
  <div style="display:flex;flex-direction:column;gap:14px">
    <div id="eventBanner"></div>
    
    <div>
      <!-- –°–µ–∫—Ü–∏—è –±—ã—Å—Ç—Ä—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π -->
      <div style="display:flex;gap:10px;margin-bottom:16px;flex-wrap:wrap">
        <button onclick="toggleStats()" class="smallBtn" style="flex:1">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
        <button onclick="toggleAchievements()" class="smallBtn" style="flex:1">üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</button>
        <button onclick="toggleLeaderboard()" class="smallBtn" style="flex:1">üèÖ –¢–æ–ø –∏–≥—Ä–æ–∫–æ–≤</button>
      </div>

      <!-- Daily Quests –±—É–¥—É—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω—ã –∑–¥–µ—Å—å -->
      <div id="dailyQuestsSection"></div>

      <!-- Stats Section -->
      <div class="section" id="statsSection" style="display:none;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
          <div style="font-weight:bold;font-size:17px">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
          <div style="font-size:11px;color:var(--muted)">–°–≤–∞–π–ø –≤–ø—Ä–∞–≤–æ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ üëâ</div>
        </div>
        <div class="stats-grid">
          <div class="stat-item">
            <div>–û—Ç–∫—Ä—ã—Ç–æ –∫–µ–π—Å–æ–≤</div>
            <div class="stat-value" id="statsCasesOpened">0</div>
          </div>
          <div class="stat-item">
            <div>–ü–æ—Ç—Ä–∞—á–µ–Ω–æ</div>
            <div class="stat-value" id="statsMoneySpent">0</div>
          </div>
          <div class="stat-item">
            <div>–í—ã–∏–≥—Ä–∞–Ω–æ</div>
            <div class="stat-value" id="statsMoneyWon">0</div>
          </div>
          <div class="stat-item">
            <div>–ü—Ä–æ—Ñ–∏—Ç</div>
            <div class="stat-value" id="statsProfit">0</div>
          </div>
          <div class="stat-item">
            <div>–£—Å–ø–µ—à–Ω—ã—Ö –∞–ø–≥—Ä–µ–π–¥–æ–≤</div>
            <div class="stat-value" id="statsUpgradesSuccess">0</div>
          </div>
          <div class="stat-item">
            <div>–ü—Ä–æ–¥–∞–Ω–æ –ø—Ä–µ–¥–º–µ—Ç–æ–≤</div>
            <div class="stat-value" id="statsItemsSold">0</div>
          </div>
          <div class="stat-item">
            <div>–°–∞–º—ã–π –∫—Ä—É–ø–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à</div>
            <div class="stat-value" id="statsBiggestWin">0</div>
          </div>
          <div class="stat-item">
            <div>–ö–µ–π—Å–æ–≤ —Å–µ–≥–æ–¥–Ω—è</div>
            <div class="stat-value" id="statsDailyCases">0</div>
          </div>
        </div>
      </div>

      <!-- Cases Section -->
      <div class="section">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px">
          <div style="font-weight:bold;font-size:17px">–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–µ–π—Å—ã</div>
          <div style="font-size:11px;color:var(--muted)">–°–≤–∞–π–ø –≤–ª–µ–≤–æ –¥–ª—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∫–µ–π—Å–∞ üëà</div>
        </div>
        <div id="casesList"></div>
      </div>

      <!-- Inventory Section -->
      <div class="section">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px">
          <div style="font-weight:bold;font-size:17px">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</div>
          <div style="font-size:11px;color:var(--muted)">–í–∞—à–∏ –ø—Ä–µ–¥–º–µ—Ç—ã</div>
        </div>
        <div id="inventoryList" style="margin-top:10px"></div>
      </div>

      <!-- Upgrade Panel -->
      <div id="upgradePanel">
        <div class="upgrade-container">
          <div class="upgrade-left">
            <div style="display:flex;gap:10px;align-items:center;margin-bottom:16px">
              <div id="upgradeSelectedPreview" style="width:80px;height:80px;border-radius:10px;background:#0b0f14;display:flex;align-items:center;justify-content:center;color:#cbd5e1;border:2px solid rgba(255,255,255,0.1);font-size:32px">
                ‚ö°
              </div>
              <div style="flex:1">
                <div id="upgradeSelectedName" style="font-weight:bold;font-size:16px">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç –¥–ª—è –∞–ø–≥—Ä–µ–π–¥–∞</div>
                <div id="upgradeSelectedPrice" style="font-size:14px;color:var(--muted)">‚Äî</div>
                <div style="font-size:12px;color:var(--accent);margin-top:4px">
                  –®–∞–Ω—Å —É—Å–ø–µ—Ö–∞: 2x - 50% | 3x - 20%
                </div>
              </div>
            </div>
            <div id="upgradeResultSmall" style="
              padding:12px;
              background:rgba(255,255,255,0.05);
              border-radius:8px;
              border:1px solid rgba(255,255,255,0.1);
              text-align:center;
              min-height:40px;
              display:flex;
              align-items:center;
              justify-content:center;
            ">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —É–¥–∞—á—É!</div>
          </div>

          <div class="upgrade-right">
            <div class="upgrade-wheel-container">
              <div class="wheel-pointer"></div>
              <div class="upgrade-wheel" id="upgradeWheelSmall">
                <div class="inner" id="upgradeInnerSmall">–ê–ø–≥—Ä–µ–π–¥</div>
              </div>
            </div>
            <div class="upgrade-buttons">
              <button id="upgrade2xBtn" class="upgrade-btn">–ü–æ–ø—ã—Ç–∫–∞ 2x</button>
              <button id="upgrade3xBtn" class="upgrade-btn">–ü–æ–ø—ã—Ç–∫–∞ 3x</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Referral Section -->
      <div class="section">
        <div style="font-weight:bold;font-size:17px;margin-bottom:10px">–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞</div>
        <div style="font-size:12px;color:var(--muted);margin-bottom:6px">–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:</div>
        <div style="display:flex;gap:8px;margin-bottom:14px">
          <input id="myRefLink" style="flex:1;padding:10px;border-radius:8px;border:1px solid #2b3440;background:#071018;color:#fff;font-size:13px;" readonly>
          <button id="copyRefBtn" class="copy-btn" title="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É">
            <span id="copyText">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</span>
          </button>
        </div>
        
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px">
          <div style="font-size:13px">
            –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: <b id="refEarnings" style="color:var(--accent)">0</b> ‚ÇΩ
          </div>
          <button id="claimRefBtn" class="smallBtn" style="background:linear-gradient(135deg,var(--green),#0da271)">–ó–∞—á–∏—Å–ª–∏—Ç—å</button>
        </div>
        
        <div style="font-size:12px;color:var(--muted);margin-bottom:14px;padding:10px;background:rgba(250,204,21,0.1);border-radius:8px">
          <strong>üéØ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:</strong><br>
          ‚Ä¢ –ü—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π –ø–æ —Å–≤–æ–µ–π —Å—Å—ã–ª–∫–µ<br>
          ‚Ä¢ –ü–æ–ª—É—á–∞–π—Ç–µ <strong>30%</strong> –æ—Ç –∏—Ö –ø—Ä–æ–∏–≥—Ä—ã—à–µ–π<br>
          ‚Ä¢ –ù–∞—á–∏—Å–ª–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∫ –≤–∞—à–µ–º—É –±–∞–ª–∞–Ω—Å—É
        </div>
        
        <div style="display:flex;gap:8px;margin-top:16px">
          <button id="dailyBonusBtn" class="smallBtn" style="flex:1">üéÅ –ë–æ–Ω—É—Å 10 ‚ÇΩ</button>
          <button id="extraBonusBtn" class="smallBtn" style="flex:1">‚ú® +10 ‚ÇΩ</button>
        </div>
      </div>
    </div>

    <!-- Online & Chat -->
    <div class="online-chat-container">
      <!-- Online Widget -->
      <div class="online-widget">
        <div style="font-weight:bold;font-size:15px;margin-bottom:6px">–û–Ω–ª–∞–π–Ω</div>
        <div class="online-count" id="fakeOnline">0</div>
        <div style="font-size:12px;color:var(--muted);margin-top:4px">–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–µ–π—á–∞—Å</div>
      </div>

      <!-- Chat Box -->
      <div class="chatBox" id="chatBox"></div>
    </div>
  </div>
</div>

<!-- Admin Panel -->
<div id="adminPanel">
  <h4>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h4>
  <div class="adminRow">
    <input id="adminPass" placeholder="–ü–∞—Ä–æ–ª—å" type="password" />
    <button id="adminLogin" class="adminBtn">–í–æ–π—Ç–∏</button>
  </div>
  <div id="adminControls" style="display:none">
    <div class="adminRow">
      <input id="adminAddAmount" type="number" placeholder="–°—É–º–º–∞ +–±–∞–ª–∞–Ω—Å" />
      <button id="adminAddBtn" class="adminBtn">–î–æ–±–∞–≤–∏—Ç—å</button>
    </div>
    <div class="adminRow">
      <input id="adminSetRtp" type="number" step="0.01" placeholder="RTP (0.1-0.95)" />
      <button id="adminSetRtpBtn" class="adminBtn">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å RTP</button>
    </div>
    <div class="adminRow">
      <select id="adminForceCase" style="flex:1"></select>
      <select id="adminForceItem" style="flex:1"></select>
    </div>
    <div class="adminRow">
      <button id="adminForceWin" class="adminBtn" style="width:100%">–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à</button>
    </div>
    <div class="adminRow">
      <button id="adminClearRef" class="adminBtn" style="width:100%;background:linear-gradient(135deg,#ef4444,#dc2626)">–°–±—Ä–æ—Å–∏—Ç—å —Ä–µ—Ñ. –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è</button>
    </div>
    <div style="font-size:12px;color:var(--muted);margin-top:12px;text-align:center">–ü–∞—Ä–æ–ª—å: <b>!125125Cc</b></div>
  </div>
</div>

<!-- Bank Modal -->
<div id="bankOverlay">
  <div id="bankModal">
    <div style="font-weight:bold;font-size:20px;margin-bottom:12px;text-align:center">–ë–∞–Ω–∫ (–î–µ–º–æ)</div>
    <div style="margin-bottom:16px;color:var(--muted);text-align:center;font-size:14px">
      –í –¥–µ–º–æ-—Ä–µ–∂–∏–º–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ –≤—ã–≤–æ–¥ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
    </div>
    
    <div style="display:flex;gap:10px;margin-bottom:20px;align-items:center">
      <input id="amountInput" type="number" min="100" step="50" value="500" />
    </div>
    
    <div style="display:flex;gap:10px;margin-bottom:20px">
      <button id="depositBtn" class="smallBtn" style="flex:1;background:linear-gradient(135deg,var(--green),#0da271);opacity:0.7">–ü–æ–ø–æ–ª–Ω–∏—Ç—å (–¥–µ–º–æ)</button>
      <button id="withdrawBtn" class="smallBtn" style="flex:1;background:linear-gradient(135deg,#3b82f6,#2563eb);opacity:0.7">–í—ã–≤–µ—Å—Ç–∏ (–¥–µ–º–æ)</button>
    </div>
    
    <div style="width:100%;border-top:1px solid rgba(255,255,255,0.1);padding-top:16px">
      <div style="text-align:center;color:var(--muted);font-size:13px">–í —Ä–µ–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏:<br>–ú–∏–Ω–∏–º—É–º: 100 ‚ÇΩ | –í—ã–≤–æ–¥: –æ—Ç 500 ‚ÇΩ</div>
    </div>
    
    <button id="closeBank" class="smallBtn" style="width:100%;margin-top:16px">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>

<!-- Win Overlay -->
<div id="overlay">
  <div id="modal">
    <div id="winResultBox">
      <img id="winImg" src="" alt="win">
      <div class="winTitle" id="winTitle">–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏</div>
      <div class="winPrice" id="winPrice">0 ‚ÇΩ</div>
      <div class="winNote" id="winNote">–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –ü—Ä–µ–¥–º–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å.</div>
      <div style="margin-top:24px"><button id="closeModal" class="smallBtn" style="min-width:120px">–ó–∞–∫—Ä—ã—Ç—å</button></div>
    </div>
  </div>
</div>

<script>
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
setTimeout(() => {
  if (window.CaseHunters) {
    // –í—Å—Ç–∞–≤–ª—è–µ–º –±–∞–Ω–Ω–µ—Ä —Å–æ–±—ã—Ç–∏—è
    const eventBanner = document.getElementById('eventBanner');
    if (eventBanner) {
      eventBanner.innerHTML = window.CaseHunters.seasonalEvents.renderEventBanner();
    }
    
    // –í—Å—Ç–∞–≤–ª—è–µ–º –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è
    const questsSection = document.getElementById('dailyQuestsSection');
    if (questsSection) {
      questsSection.innerHTML = window.CaseHunters.dailyQuests.renderQuests();
    }
  }
}, 1000);
</script>

</body>
</html>